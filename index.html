<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="icon" type="image/x-icon" href="assets/logos/logo.jpg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Camisetazo - Tienda Deportiva Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">        
    <link rel="stylesheet" href="styles/styles.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GS53GWE2Z0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GS53GWE2Z0');
</script>
</head>
<body>
    <div id="formStatus"></div>
    <div class="contenedor-principal">
        <header>
    <div class="brand-header">
        <img src="assets/logos/logo.jpg" alt="Logo Camisetazo" class="logo">
        <div class="brand-title">CAMISETAZO</div>
        <div class="brand-subtitle">Tienda Deportiva Premium</div>
    </div>
    <nav class="navegacion">
        <button class="boton-seccion activo" data-seccion="tienda">Catálogo</button>
        <button class="boton-seccion" data-seccion="pedidos">Tienda</button>
    <button class="boton-seccion" data-seccion="carrito">Carrito</button>
    <button class="boton-seccion" data-seccion="quienes-somos">¿Quiénes Somos?</button>
    </nav>
</header>

<!-- Sección Tienda -->
<section id="tienda" class="seccion activa">
            <div class="catalogo-header animate__animated animate__fadeInDown">
                <h2 class="catalogo-titulo">Catálogo Premium</h2>
                <p class="catalogo-descripcion">Explora nuestra selección exclusiva de productos deportivos de alta calidad. Haz clic en cada categoría para ver el catálogo completo.</p>
            </div>
            <div class="grid-catalogo">
                <!-- Tarjeta 1 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable futbol-dropdown" data-link="https://2020soccer.x.yupoo.com/albums">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/camfut.png" alt="Camisetas" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>Camisetas Fútbol</h3>
                        <p>Las mejores camisetas de clubes y selecciones, calidad premium.</p>
                        <button class="catalogo-btn futbol-dropdown-btn" type="button">
                            Ver opciones <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="futbol-dropdown-menu">
                            <a href="https://2020soccer.x.yupoo.com/albums" target="_blank">GENERAL</a>
                            <a href="https://classic-football-fhirts052.x.yupoo.com/" target="_blank">RETRO</a>
                            <a href="https://yongfa1688.x.yupoo.com/" target="_blank">NUEVA TEMPORADA</a>
                            <a href="https://aosendi.x.yupoo.com/albums" target="_blank">CONJUNTOS</a>
                            <a href="https://dongshanstore.x.yupoo.com/" target="_blank">CONJUNTOS 2</a>
                        </div>
                    </div>
                </div>
                <!-- Tarjeta 2 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.1s;" data-link="https://eu1688.x.yupoo.com/albums">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/zap.png" alt="Zapatillas" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>Zapatillas</h3>
                        <p>Modelos exclusivos y últimas tendencias en sneakers deportivas.</p>
                        <a href="https://eu1688.x.yupoo.com/albums" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 3 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.2s;" data-link="https://x.yupoo.com/photos/05941188/albums">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/nba.png" alt="NBA" class="catalogo-img nba-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>NBA</h3>
                        <p>Camisetas y productos oficiales de la mejor liga de baloncesto.</p>
                        <a href="https://x.yupoo.com/photos/05941188/albums" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 4 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.3s;" data-link="https://docs.google.com/document/d/1IXUCHDWRw8osfQltnWGwz2bUFpD_J85-0_Nnq0p55NI/edit?usp=drivesdk">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/airpods.png" alt="AirPods" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>AirPods</h3>
                        <p>Audio inalámbrico de alta calidad, compatibles con todos tus dispositivos.</p>
                        <a href="https://docs.google.com/document/d/1IXUCHDWRw8osfQltnWGwz2bUFpD_J85-0_Nnq0p55NI/edit?usp=drivesdk" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 5 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.4s;" data-link="https://zuqiuliu.x.yupoo.com">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/botfut.png" alt="Botas Fútbol" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>Botas Fútbol</h3>
                        <p>Botas de fútbol profesionales para todos los terrenos y estilos.</p>
                        <a href="https://zuqiuliu.x.yupoo.com" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 6 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.5s;" data-link="https://x.yupoo.com/photos/yiyisports2016/collections/3551571">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/f1.png" alt="F1" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>F1</h3>
                        <p>Merchandising y ropa oficial de Fórmula 1 para verdaderos fans.</p>
                        <a href="https://x.yupoo.com/photos/yiyisports2016/collections/3551571" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 7 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.6s;" data-link="https://docs.google.com/document/d/15vg3VeVf8gs3R7r6JEaG8_mdgA05hKDKg9mMsdKFVWc/edit?usp=sharing">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/ps4.png" alt="Mandos PS4" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>Mandos PS4</h3>
                        <p>Mandos y accesorios para PlayStation 4, máxima precisión y calidad.</p>
                        <a href="https://docs.google.com/document/d/15vg3VeVf8gs3R7r6JEaG8_mdgA05hKDKg9mMsdKFVWc/edit?usp=sharing" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 8 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.7s;" data-link="https://nfl-world.x.yupoo.com/">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/nfl.png" alt="NFL" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>NFL</h3>
                        <p>Jerseys y artículos oficiales de la National Football League.</p>
                        <a href="https://nfl-world.x.yupoo.com/" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                
            </div>
        </section>


<!-- Sección Quiénes Somos -->
        <section id="quienes-somos" class="seccion">
    <style>
    .quienes-somos-ui {
        max-width: 900px;
        margin: 0 auto 2.5rem auto;
        background: rgba(20,40,80,0.18);
        border-radius: 22px;
        box-shadow: 0 4px 32px rgba(42,91,168,0.10), 0 1.5px 8px rgba(0,0,0,0.08);
        padding: 2.5rem 2rem 2rem 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        border: 1.5px solid rgba(42,91,168,0.13);
        animation: aparecer 0.8s;
    }
    .quienes-somos-ui h2 {
        color: var(--azul-acento);
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 1.2rem;
        letter-spacing: 1px;
        text-shadow: 0 2px 12px rgba(42,91,168,0.10);
    }
    .quienes-somos-ui p {
        color: #e0e0e0;
        font-size: 1.15rem;
        line-height: 1.7;
        margin-bottom: 2rem;
        opacity: 0.92;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }
    .quienes-somos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 2rem;
        margin-top: 2.5rem;
    }
    .quienes-somos-card {
        background: rgba(42,91,168,0.13);
        border-radius: 16px;
        padding: 2rem 1.2rem 1.5rem 1.2rem;
        box-shadow: 0 2px 12px rgba(42,91,168,0.08);
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid rgba(42,91,168,0.10);
    }
    .quienes-somos-card:hover {
        transform: translateY(-6px) scale(1.03);
        box-shadow: 0 8px 32px rgba(42,91,168,0.13);
        background: rgba(42,91,168,0.18);
    }
    .quienes-somos-card i {
        font-size: 2.7rem;
        margin-bottom: 1rem;
        color: var(--azul-acento);
        background: #fff;
        border-radius: 50%;
        padding: 0.7rem;
        box-shadow: 0 2px 8px rgba(42,91,168,0.08);
        transition: background 0.2s;
    }
    .quienes-somos-card h3 {
        font-size: 1.25rem;
        color: #fff;
        margin-bottom: 0.7rem;
        font-weight: 700;
    }
    .quienes-somos-card p {
        color: #b8c6e0;
        font-size: 1rem;
        margin-bottom: 0;
        min-height: 40px;
    }
    .quienes-somos-card .stars {
        color: #ffd700;
        margin-top: 0.5rem;
        font-size: 1.1rem;
    }
    .quienes-somos-card .stars i {
        color: #FFD700 !important;
        font-size: 1rem !important;
        background: none !important;
        border-radius: 0 !important;
        padding: 0 !important;
        box-shadow: none !important;
        margin: 0 1px;
        vertical-align: middle;
    }
    .quienes-somos-instagram {
        background: linear-gradient(90deg, #e1306c 0%, #fdc468 100%);
        color: #fff;
        border-radius: 16px;
        padding: 1.5rem 1rem 1.2rem 1rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 12px rgba(225,48,108,0.10);
        display: flex;
        flex-direction: column;
        align-items: center;
        animation: aparecer 1s;
    }
    .quienes-somos-instagram i {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: #fff;
        background: #e1306c;
        border-radius: 50%;
        padding: 0.7rem;
        box-shadow: 0 2px 8px rgba(225,48,108,0.10);
    }
    .quienes-somos-instagram a {
        color: #fff;
        font-weight: 600;
        text-decoration: underline;
        margin: 0.5rem 0;
        font-size: 1.1rem;
    }
    .quienes-somos-instagram p {
        margin-top: 0.5rem;
        opacity: 0.95;
        font-size: 1rem;
    }
    @media (max-width: 700px) {
        .quienes-somos-ui {
            padding: 1.2rem 0.5rem;
        }
        .quienes-somos-grid {
            grid-template-columns: 1fr;
            gap: 1.2rem;
        }
    }
    .formulario-pedido {
        max-width: 900px;
        margin: 2.5rem auto;
        background: linear-gradient(135deg, rgba(10,31,61,0.92) 70%, rgba(42,91,168,0.13) 100%);
        backdrop-filter: blur(16px);
        border-radius: 28px;
        padding: 2.7rem 2.2rem 2.2rem 2.2rem;
        border: 2.5px solid var(--azul-acento);
        box-shadow: 0 8px 40px rgba(42,91,168,0.13), 0 2px 12px rgba(0,0,0,0.10);
        position: relative;
        animation: aparecer 0.7s;
    }

    .formulario-pedido h2 {
        text-align: center;
        color: var(--azul-acento);
        margin-bottom: 2.2rem;
        font-size: 2.3rem;
        font-weight: 900;
        letter-spacing: 1.5px;
        text-shadow: 0 2px 12px rgba(42,91,168,0.10);
    }

    .selector-unidades {
        display: flex;
        justify-content: center;
        gap: 1.2rem;
        margin-bottom: 2.2rem;
    }

    .boton-unidad {
        background: var(--azul-acento);
        color: #fff;
        border: 2px solid transparent;
        border-radius: 12px;
        padding: 0.9rem 2.1rem;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 2px 12px rgba(42,91,168,0.10);
        transition: background 0.2s, color 0.2s, border 0.2s, transform 0.2s, box-shadow 0.2s;
    }

    .boton-unidad.activo, .boton-unidad:focus {
        background: #163a6b;
        color: var(--azul-acento);
        border: 2.5px solid var(--azul-acento);
        outline: none;
        box-shadow: 0 6px 24px rgba(42,91,168,0.13);
        transform: translateY(-3px) scale(1.04);
    }

    .boton-unidad:not(.activo):hover {
        background: #2456a8;
        color: #fff;
        border: 2px solid #2456a8;
        transform: translateY(-1px) scale(1.02);
        box-shadow: 0 4px 16px rgba(42,91,168,0.13);
    }

    .input-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 2.2rem;
        margin: 2.2rem 0 1.5rem 0;
    }

    .input-group {
        margin-bottom: 1.2rem;
        background: rgba(255,255,255,0.04);
        border-radius: 10px;
        padding: 1.1rem 1rem 0.7rem 1rem;
        box-shadow: 0 1px 6px rgba(42,91,168,0.07);
        border: 1.5px solid rgba(42,91,168,0.10);
    }

    .input-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #e0e0e0;
        font-weight: 600;
        letter-spacing: 0.5px;
    }

    .input-group input,
    .input-group textarea {
        width: 100%;
        padding: 13px;
        border: 2px solid var(--azul-acento);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.13);
        color: white;
        font-size: 1.08rem;
        transition: all 0.3s ease;
    }

    .input-group input:focus,
    .input-group textarea:focus {
        outline: none;
        border-color: #4a90e2;
        box-shadow: 0 0 10px rgba(74, 144, 226, 0.3);
        background: rgba(255,255,255,0.18);
    }

    .calculadora-precio {
        background: rgba(255, 255, 255, 0.13);
        border-radius: 16px;
        padding: 2.2rem 1.5rem 1.5rem 1.5rem;
        margin: 2.2rem 0 1.2rem 0;
        box-shadow: 0 4px 16px rgba(42, 91, 168, 0.10);
        border: 1.5px solid var(--azul-acento);
    }

    .calculadora-precio h3 {
        color: var(--azul-acento);
        font-size: 1.4rem;
        font-weight: 800;
        margin-bottom: 1.2rem;
        letter-spacing: 1px;
    }

    .detalle-precio {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 1rem 0;
        padding: 1.1rem 1.2rem;
        background: rgba(255, 255, 255, 0.09);
        border-radius: 10px;
        font-size: 1.08rem;
        border: 1px solid rgba(42,91,168,0.10);
        box-shadow: 0 1px 4px rgba(42,91,168,0.06);
    }

    .detalle-precio span:first-child:before {
        content: '\f02b';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        color: var(--azul-acento);
        margin-right: 0.7em;
        font-size: 1.1em;
        vertical-align: middle;
    }

    .total-container {
        background: var(--azul-acento);
        padding: 1.7rem;
        border-radius: 12px;
        margin: 2.2rem 0 0.5rem 0;
        text-align: center;
        box-shadow: 0 2px 12px rgba(42,91,168,0.13);
    }

    .precio-total {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 0.5rem 0;
        color: #fff;
        text-shadow: 0 2px 12px rgba(42,91,168,0.10);
    }

    .moneda {
        font-size: 1.2rem;
        vertical-align: super;
    }

    .badge-extra {
        background: #28a745;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.9rem;
        margin-left: 1rem;
    }
    .contenedor-principal {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

.brand-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(20,40,80,0.25);
    border-radius: 24px;
    box-shadow: 0 6px 32px rgba(42,91,168,0.10), 0 1.5px 8px rgba(0,0,0,0.10);
    padding: 2.5rem 1.5rem 2rem 1.5rem;
    margin-bottom: 2rem;
    position: relative;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
}

.brand-header .logo {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 1.2rem;
    box-shadow: 0 4px 24px rgba(42,91,168,0.15);
    background: #fff;
    border: 4px solid var(--azul-acento);
    transition: transform 0.3s;
}
.brand-header .logo:hover {
    transform: scale(1.07) rotate(-2deg);
}

.brand-header .brand-title {
    font-size: 2.7em;
    font-weight: 900;
    color: var(--azul-acento);
    letter-spacing: 2px;
    text-shadow: 0 2px 12px rgba(42,91,168,0.10);
    margin-bottom: 0.2em;
    line-height: 1.1;
    background: linear-gradient(90deg, #fff 60%, var(--azul-acento) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.brand-header .brand-subtitle {
    color: #e0e0e0;
    font-size: 1.1em;
    font-weight: 400;
    opacity: 0.85;
    margin-bottom: 0;
    text-align: center;
    letter-spacing: 0.5px;
}

        header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
            padding: 20px 0;
        }

        .logo {
            width: 200px;
            filter: drop-shadow(0 0 15px rgba(42, 91, 168, 0.4));
            animation: pulse 3s 1;
            border-radius: 50%;
            margin: 20px auto;
        }

        @keyframes flotar {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        h1 {
            font-size: 2.5em;
            margin: 1rem 0 0.5rem;
            color: #e0e0e0;
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
        }

        h1::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 3px;
            background: var(--azul-acento);
            transform: scaleX(0);
            animation: subrayar-titulo 1.5s ease-in-out 1s forwards;
            box-shadow: 0 0 15px rgba(42, 91, 168, 0.5);
        }

        @keyframes subrayar-titulo {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        .selector-unidades {
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            margin-bottom: 2.2rem;
        }

        .boton-unidad {
            background: var(--azul-acento);
            color: #fff;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 0.9rem 2.1rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 2px 12px rgba(42,91,168,0.10);
            transition: background 0.2s, color 0.2s, border 0.2s, transform 0.2s, box-shadow 0.2s;
        }

        .boton-unidad.activo, .boton-unidad:focus {
            background: #163a6b;
            color: var(--azul-acento);
            border: 2.5px solid var(--azul-acento);
            outline: none;
            box-shadow: 0 6px 24px rgba(42,91,168,0.13);
            transform: translateY(-3px) scale(1.04);
        }

        .boton-unidad:not(.activo):hover {
            background: #2456a8;
            color: #fff;
            border: 2px solid #2456a8;
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 4px 16px rgba(42,91,168,0.13);
        }

        .boton-version-especial, .boton-version-jugador, .boton-camiseta-nba {
            width: 100%;
            padding: 0.85rem 0;
            font-size: 1.08rem;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--azul-acento) 60%, #1a3b6d 100%);
            color: #fff;
            box-shadow: 0 2px 12px rgba(42,91,168,0.10);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s, transform 0.18s, box-shadow 0.2s;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.7em;
            position: relative;
            outline: none;
        }
        .boton-version-especial span, .boton-version-jugador span, .boton-camiseta-nba span {
            font-size: 0.98em;
            font-weight: 600;
            margin-left: 0.5em;
            letter-spacing: 0.2px;
        }
        .boton-version-especial.activo, .boton-version-jugador.activo, .boton-camiseta-nba.activo {
            background: linear-gradient(90deg, #fff 10%, var(--azul-acento) 100%);
            color: var(--azul-acento);
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 6px 24px rgba(42,91,168,0.13);
            border: 2px solid var(--azul-acento);
        }
        .boton-version-especial:not(.activo):hover, .boton-version-jugador:not(.activo):hover, .boton-camiseta-nba:not(.activo):hover {
            background: linear-gradient(90deg, #2a5ba8 60%, #1a3b6d 100%);
            color: #fff;
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 4px 16px rgba(42,91,168,0.13);
        }
        .boton-version-jugador::before,
    .boton-version-especial:not(.boton-version-jugador):not(.boton-camiseta-nba)::before,
    .boton-camiseta-nba::before {
        content: none !important;
        display: none !important;
    }
    </style>
    <div class="quienes-somos-ui animate__animated animate__fadeIn">
        <h2>Nuestra Historia</h2>
        <p>
            En Camisetazo nos apasiona conectar a los verdaderos amantes del deporte con artículos premium de las mejores marcas. Nos especializamos en ofrecer productos de alta calidad y artículos exclusivos que permiten vivir la emoción del deporte al mejor precio. Combinamos nuestro conocimiento experto con un servicio personalizado para garantizar que cada compra supere tus expectativas.
        </p>
        <div class="quienes-somos-instagram">
            <i class="fab fa-instagram"></i>
            <h3>Síguenos en Instagram</h3>
            <a href="https://www.instagram.com/camisetazo._/" target="_blank">@camisetazo._ ➔</a>
            <p>Novedades diarias | Ofertas exclusivas</p>
        </div>
        <div class="clientes-carrusel-section">
            <h3 style="color:var(--azul-acento);margin-bottom:1rem;">Clientes Satisfechos</h3>
            <div class="clientes-carrusel">
                <button class="carrusel-btn" id="carrusel-prev" aria-label="Anterior">&#8592;</button>
                <div class="carrusel-imagenes">
                    <div class="carrusel-img-bg activa" data-img="assets/clientes/cliente1.jpg" aria-label="Cliente satisfecho 1"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente2.jpg" aria-label="Cliente satisfecho 2"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente3.jpg" aria-label="Cliente satisfecho 3"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente4.jpg" aria-label="Cliente satisfecho 4"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente5.jpg" aria-label="Cliente satisfecho 5"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente6.jpg" aria-label="Cliente satisfecho 6"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente7.jpg" aria-label="Cliente satisfecho 7"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente8.jpg" aria-label="Cliente satisfecho 8"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente9.jpg" aria-label="Cliente satisfecho 9"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente10.jpg" aria-label="Cliente satisfecho 10"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente11.jpg" aria-label="Cliente satisfecho 11"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente12.jpg" aria-label="Cliente satisfecho 12"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente13.jpg" aria-label="Cliente satisfecho 13"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente14.jpg" aria-label="Cliente satisfecho 14"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente15.jpg" aria-label="Cliente satisfecho 15"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente16.jpg" aria-label="Cliente satisfecho 16"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente17.jpg" aria-label="Cliente satisfecho 17"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente18.jpg" aria-label="Cliente satisfecho 18"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente19.jpg" aria-label="Cliente satisfecho 19"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente20.jpg" aria-label="Cliente satisfecho 20"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente21.jpg" aria-label="Cliente satisfecho 21"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente22.jpg" aria-label="Cliente satisfecho 22"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente23.jpg" aria-label="Cliente satisfecho 23"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente24.jpg" aria-label="Cliente satisfecho 24"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente25.jpg" aria-label="Cliente satisfecho 25"></div>
                    
                </div>
                <button class="carrusel-btn" id="carrusel-next" aria-label="Siguiente">&#8594;</button>
            </div>
            <p style="margin-top:0.7rem;color:#b8c6e0;font-size:1rem;">Desliza para ver más capturas de clientes reales. ¡Gracias por confiar en nosotros!</p>
        </div>
        
        <div class="reseñas-clientes">
            <h3 style="color:var(--azul-acento);margin:1.5rem 0 1rem;">Opiniones sobre nuestras camisetas</h3>
            <div class="lista-reseñas">
                <div class="reseña">
                    <p>"La calidad de la tela es increíble, se nota que es premium desde el primer uso. ¡Superó mis expectativas!"</p>
                </div>
                <div class="reseña">
                    <p>"Compré la del Barça y la verdad que los detalles están perfectamente cosidos. No se deshilacha como otras."</p>
                </div>
                <div class="reseña">
                    <p>"Llevo 3 meses usando la del Madrid y sigue como nueva después de tantos lavados. Calidad-precio imbatible."</p>
                </div>
                <div class="reseña">
                    <p>"Los logos y patrocinadores están bien pegados, no se levantan como en otras tiendas. Muy recomendable."</p>
                </div>
                <div class="reseña">
                    <p>"La transpiración es excelente, jugué un partido completo y no se pegó al cuerpo. ¡De las mejores que he tenido!"</p>
                </div>
            </div>
        </div>
        <div class="quienes-somos-grid">
            <div class="quienes-somos-card">
                <i class="fas fa-shield-alt"></i>
                <h3>Garantía de Pago</h3>
                <p>Transacciones seguras con protección al comprador</p>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-shipping-fast"></i>
                <h3>Envío Express</h3>
                <p>Entrega en 1-2 semanas con seguimiento del paquete</p>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-users"></i>
                <h3>Comunidad</h3>
                <p>+100 clientes satisfechos</p>
                <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-headset"></i>
                <h3>Atención al cliente</h3>
                <p>Obtén respuestas rápidas con nuestro servicio de atención al cliente</p>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-tshirt"></i>
                <h3>Personalización</h3>
                <p>Elige nombre, número y detalles únicos para tu camiseta</p>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-gem"></i>
                <h3>Calidad Premium</h3>
                <p>Materiales de alta gama y acabados profesionales en cada producto</p>
            </div>
        </div>
    </div>
</section>
    <section id="carrito" class="seccion">
        <div class="cart-layout" role="group" aria-label="Carrito y recomendaciones">
            <aside id="cartPanel" class="cart-panel" aria-label="Carrito de compras">
                <div class="cart-header">
                    <h3>Tu Carrito</h3>
                    <div id="cartCount" class="cart-count" aria-hidden="true">0</div>
                </div>

                <div id="cartItems" class="cart-items">
                    <div class="cart-empty">Tu carrito está vacío<br><small>Agrega productos para empezar</small></div>
                </div>

                <div class="cart-divider" aria-hidden="true"></div>

                <div class="cart-totals">
                    <div class="tot-row"><span>Subtotal</span><span><strong id="cartSubtotal">0.00</strong></span></div>
                    <div class="tot-row"><span>Gastos envío</span><span id="cartShipping">2.00</span></div>
                    <div class="tot-row total"><span>Total</span><span id="cartTotal">0.00</span></div>
                </div>

                <div class="cart-actions">
                    <button id="clearCartGallery" class="btn-secondary">Vaciar</button>
                    <button id="gotoCheckoutBtn" class="btn-primary">Pagar</button>
                </div>

                <p class="cart-note">Antes de pagar se solicitará correo de PayPal, usuario de Instagram y dirección de envío.</p>
            </aside>
            <aside id="cartRecoPanel" class="cart-reco-panel" aria-label="Recomendaciones para ti">
                <div class="reco-header">
                    <h3>Te podría gustar</h3>
                    <div class="reco-nav">
                        <button class="reco-arrow" id="recoPrev" aria-label="Desplazar recomendaciones a la izquierda">‹</button>
                        <button class="reco-arrow" id="recoNext" aria-label="Desplazar recomendaciones a la derecha">›</button>
                    </div>
                </div>
                <div id="recoScroller" class="reco-scroller" tabindex="0" role="region" aria-label="Lista de recomendaciones desplazable horizontalmente"></div>
                <p class="reco-hint">Añade productos al carrito para ver recomendaciones.</p>
            </aside>
        </div>
        <style>
            /* Estilos locales sólo para la sección Carrito */
            #carrito .cart-layout { display:grid; grid-template-columns: 1fr; gap:16px; align-items:start; grid-template-areas: 'cart' 'reco'; }
            #carrito #cartPanel { grid-area: cart; }
            #carrito #cartRecoPanel { grid-area: reco; }
            #carrito { scroll-margin-top: 16px; }
            @media (min-width: 992px) { #carrito .cart-layout { grid-template-columns: minmax(520px, 1fr) clamp(320px, 28vw, 460px); grid-template-areas: 'cart reco'; } }
            #carrito .cart-panel { max-width: none; max-height: none; }
            @media (min-width: 992px) { #carrito .cart-panel { position: sticky; top: 16px; } }
             @media (min-width: 992px) { #carrito #cartRecoPanel { position: sticky; top: 16px; } }
            #carrito .cart-panel { margin-top: 0 !important; }
            #carrito #cartRecoPanel { background: rgba(10,31,61,0.9); border:1px solid rgba(46,123,237,0.12); border-radius:14px; padding:12px 12px 16px; }
            @media (min-width: 992px) { #carrito #cartRecoPanel { margin-top:16px !important; } }
            #carrito .reco-header { display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px; }
            #carrito .reco-header h3 { color:#fff; font-size:1.02rem; margin:0; }
            #carrito .reco-nav { display:flex; gap:8px; }
            #carrito .reco-arrow { background: transparent; border: 1px solid rgba(255,255,255,0.12); color:#d6e9ff; border-radius:8px; padding:6px 10px; cursor:pointer; }
            #carrito .reco-arrow:hover { background: rgba(255,255,255,0.07); }
            #carrito .reco-scroller { display:grid; grid-auto-flow: column; grid-auto-columns: minmax(160px, 1fr); gap:10px; overflow-x:auto; overflow-y:hidden; scroll-snap-type:x mandatory; padding-bottom:4px; }
            #carrito .reco-scroller::-webkit-scrollbar { height:8px; }
            #carrito .reco-scroller::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius:6px; }
            #carrito .reco-card { scroll-snap-align:start; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); border:1px solid rgba(255,255,255,0.08); border-radius:12px; overflow:hidden; display:flex; flex-direction:column; cursor:pointer; }
            #carrito .reco-card img { width:100%; aspect-ratio:1/1; object-fit:cover; }
            #carrito .reco-meta { padding:8px 10px; color:#d6e9ff; min-height:64px; }
            #carrito .reco-name { font-weight:700; font-size:0.95rem; line-height:1.2; margin-bottom:4px; }
            #carrito .reco-price { color:#9fe0ff; font-weight:800; }
            #carrito .reco-actions { display:flex; gap:8px; padding:8px 10px 12px; }
            #carrito .reco-actions .btn-primary { flex:1; padding:8px 10px; border-radius:10px; }
            #carrito .reco-actions .btn-secondary { padding:8px 10px; border-radius:10px; }
            #carrito .reco-hint { color:#9fbfe8; font-size:0.9rem; margin-top:4px; text-align:center; }
        </style>
        <script>
            (function(){
                const scroller = document.getElementById('recoScroller');
                const prev = document.getElementById('recoPrev');
                const next = document.getElementById('recoNext');
                if (!scroller) return;
                const scrollBy = () => Math.max(220, scroller.clientWidth * 0.8);
                prev && prev.addEventListener('click', () => scroller.scrollBy({ left: -scrollBy(), behavior: 'smooth' }));
                next && next.addEventListener('click', () => scroller.scrollBy({ left: scrollBy(), behavior: 'smooth' }));
                scroller.addEventListener('wheel', (e) => {
                    if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                        scroller.scrollLeft += e.deltaY;
                        e.preventDefault();
                    }
                }, { passive: false });
            })();
        </script>
    </section>
    <!-- Sección Pedidos: Galería de productos y carrito -->
    <section id="pedidos" class="seccion">
    <!-- Hidden order form (submitted to FormSubmit) - populated programmatically before submit -->
    <form id="pedidoForm" action="https://formsubmit.co/ac88c19c0b46633676d4b3e8db41dea8" method="POST" style="display:none;">
        <input type="hidden" name="_next" value="https://compra-exitosa.vercel.app/">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_subject" value="Nuevo pedido con pago confirmado">
        <input type="hidden" name="_language" value="es">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="precio_total" id="precioTotal">
        <!-- Reserve common fields (will be filled from checkout modal) -->
        <input type="hidden" name="emailPaypal" id="form_emailPaypal">
        <input type="hidden" name="direccion" id="form_direccion">
        <input type="hidden" name="contactName" id="form_contactName">
        <input type="hidden" name="city" id="form_city">
        <input type="hidden" name="state" id="form_state">
        <input type="hidden" name="country" id="form_country">
        <input type="hidden" name="postal" id="form_postal">
        <input type="hidden" name="phone" id="form_phone">
        <input type="hidden" name="instagram" id="form_instagram">
    <!-- removed JSON payload: keep only the human-readable summary to avoid large payloads in FormSubmit -->
    <!-- Human-readable cart summary for email clarity -->
    <input type="hidden" name="cart_items_text" id="form_cart_items_text">
    </form>
    <div class="product-gallery-ui">
    <div class="gallery-header"></div>

    <div id="productGallery" class="product-gallery" aria-live="polite"></div>

    
    </div>

    <style>
    /* Galería: estilo azul, limpio y responsivo similar a Manchester City */
    /* Ocultar la UI de la galería cuando la sección pedidos no está activa */
    #pedidos:not(.activa) .product-gallery-ui { display: none; }
    /* Grid layout with named areas so header spans both columns and the product gallery
       always occupies the left column while the cart occupies the right column. This
       prevents automatic wrapping that placed the cart below the products. */
    #pedidos.activa .product-gallery-ui {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
        grid-template-areas: "header" "gallery";
        gap: 22px;
        align-items: start;
    }
    .gallery-header { grid-area: header; }
    .product-gallery { grid-area: gallery; }
    .cart-panel { grid-area: cart; }
        .gallery-header h2 { color: var(--azul-acento); font-size: 2rem; margin: 0 0 6px; }
        .gallery-header p { color: #cfdff6; margin: 0 0 16px; }
          /* Gallery: center items inside the left column by default.
              If there is only one product, align it to the left (start) so it appears at the very left edge. */
        .product-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 18px; width: 100%; }
          .product-gallery > .product-item:only-child { justify-self: start; max-width: 800px; }
    .product-item { background: rgba(255,255,255,0.03); border: 1px solid rgba(42,91,168,0.08); padding: 10px 12px; border-radius: 12px; text-align: center; transition: transform .12s, box-shadow .12s; max-width: 360px; box-sizing: border-box; cursor: pointer; align-items: stretch; display:flex; flex-direction:column; justify-content:space-between; overflow:hidden; }
        .product-item:hover { transform: translateY(-6px); box-shadow: 0 8px 30px rgba(42,91,168,0.12); }
    .product-item img { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; }
        .product-item h4 { color: #fff; margin: 8px 0 6px; font-size: 1.04rem; }
        .product-item .price { color: #9fe0ff; font-weight: 900; margin: 6px 0; font-size:1.05rem; display:inline-block; background: rgba(15,56,100,0.12); padding:6px 10px; border-radius:8px; }
        .product-item .excerpt { color: #d6e9ff; font-size: 0.95rem; min-height: 0; margin-bottom:0; }
    .product-item .actions { display:flex; gap:8px; justify-content:center; margin-top:6px; }
        .btn-primary { background: linear-gradient(90deg,var(--azul-acento) 60%, #163a6b 100%); color: #fff; border: none; padding: 8px 12px; border-radius: 10px; cursor: pointer; }
        .btn-secondary { background: transparent; color: #d6e9ff; border: 1px solid rgba(255,255,255,0.06); padding: 8px 12px; border-radius: 10px; cursor: pointer; }

          /* Keep the cart visually on the right side of the page at all times. Make it fixed so it doesn't move
              when the gallery grows. Add max-height/overflow to remain scrollable on small viewports. */
    .cart-panel { background: rgba(10,31,61,0.95); padding: 16px; border-radius: 14px; color: #e6f3ff; border: 1px solid rgba(46,123,237,0.12); position: relative; width: 100%; max-width: 420px; box-sizing: border-box; max-height: calc(100vh - 160px); overflow: auto; }
        .cart-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
        .cart-header h3 { margin:0; color:#fff; font-size:1.15rem; letter-spacing:0.4px; }
        .cart-count { background:linear-gradient(90deg,#2e7bed,#144a85); color:#fff; padding:6px 10px; border-radius:999px; font-weight:800; font-size:0.9rem; box-shadow:0 6px 18px rgba(46,123,237,0.18); }
        .cart-items { max-height: 420px; overflow:auto; margin-bottom:12px; }
        .cart-empty { text-align:center; color:#9fbfe8; padding:24px 8px; border-radius:10px; background:rgba(255,255,255,0.02); }
        .cart-item { display:flex; gap:12px; align-items:flex-start; padding:10px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); margin-bottom:10px; border:1px solid rgba(255,255,255,0.03); width:100%; box-sizing:border-box; }
        .cart-item img { width:64px; height:64px; object-fit:cover; border-radius:8px; box-shadow: 0 6px 18px rgba(0,0,0,0.35); }
        .cart-item .meta { flex:1; text-align:left; min-width:0; }
        .cart-item .meta b { display:block; color:#fff; font-size:0.98rem; margin-bottom:4px; white-space:normal; overflow-wrap:anywhere; word-break:break-word; }
        .cart-item .meta small { color:#bcd9ff; display:block; font-size:0.9rem; }
        .cart-item .meta .qty-row { margin-top:6px; display:flex; align-items:center; gap:8px; }
        .cart-item .meta .qty-row input { width:56px; padding:6px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#fff; text-align:center; }
        .cart-item .remove { background:transparent; border:none; color:#ff8a8a; cursor:pointer; font-size:1.05rem; padding:6px; }
        /* Evitar desborde: limitar columna derecha y permitir envolver controles */
        .cart-item .meta + div { flex: 0 0 auto; max-width: 52%; }
        .cart-item .meta + div > div { flex-wrap: wrap; }
        .cart-divider { height:1px; background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01)); margin:10px 0; border-radius:2px; }
        .cart-totals { display:flex; flex-direction:column; gap:8px; padding:6px 2px; }
        .cart-totals .tot-row { display:flex; justify-content:space-between; color:#cfe8ff; font-weight:700; }
        .cart-totals .tot-row.total { font-size:1.16rem; color:#fff; font-weight:900; }
        .cart-actions { display:flex; gap:8px; margin-top:10px; }
        .cart-actions .btn-primary { flex:1; }
        .cart-actions .btn-secondary { background:transparent; border:1px solid rgba(255,255,255,0.04); padding:10px 12px; border-radius:10px; color:#d6e9ff; }
        .cart-note { font-size:0.85rem; color:#bcd9ff; margin-top:8px; }

        /* Banner promocional desplegable debajo del carrito */
        .cart-promo-banner {
            position: fixed; /* se alinea al carrito con getBoundingClientRect */
            left: 0; top: 0; /* actualizados dinámicamente */
            width: auto; /* ajustado al ancho del carrito */
            box-sizing: border-box;
            padding: 10px 14px;
            border-radius: 12px;
            color: #fff;
            font-weight: 800;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 10px 30px rgba(0,0,0,0.25), 0 1px 0 rgba(255,255,255,0.06) inset;
            opacity: 0;
            transform: translateY(-8px); /* aparece deslizándose hacia abajo desde el borde inferior del carrito */
            pointer-events: none; /* no obstruye interacciones */
            z-index: 1195; /* por debajo de modales y del carrito fijo (1200) */
            border: 1px solid rgba(255,255,255,0.12);
        }
        /* Animaciones (300-500ms) */
        .cart-promo-banner.fast { transition: opacity 0.3s ease, transform 0.3s ease; }
        .cart-promo-banner.subtle { transition: opacity 0.45s ease, transform 0.45s ease; }
        .cart-promo-banner.visible { opacity: 1; transform: translateY(0); }
        /* Temas de color */
        .cart-promo-banner.theme-3 { background: linear-gradient(180deg, #ff9800 0%, #ff7a00 100%); }
        .cart-promo-banner.theme-5 { background: linear-gradient(180deg, #2ecc71 0%, #27ae60 100%); }
        .cart-promo-banner .promo-inner { display:flex; align-items:center; justify-content:center; gap:10px; font-size:0.95rem; line-height:1; }
    .cart-promo-banner .promo-badge { display:inline-flex; align-items:center; justify-content:center; background: rgba(255,255,255,0.16); padding: 6px 10px; border-radius: 999px; font-weight:900; letter-spacing:1px; text-transform:uppercase; color:#fff; font-size:0.95rem; }

        /* Keep cart on the right even on narrower viewports but reduce its width and ensure the gallery
           has right padding so content doesn't sit underneath the fixed cart. */
        @media (min-width: 1201px) {
            /* Desktop: single-column gallery; cart is not reserved here so products use full width */
            #pedidos.activa .product-gallery-ui { display: grid; grid-template-columns: 1fr; grid-template-rows: auto 1fr; grid-template-areas: "header" "gallery"; gap: 22px; }
            .gallery-header { grid-area: header; }
            .product-gallery { grid-area: gallery; }
            /* Keep four product columns, now spanning the full available width */
            .product-gallery { display: grid; grid-template-columns: repeat(4, 1fr); gap: 18px; padding-right: 0; width: 100%; }
            /* Scale product cards proportionally on desktop for the wider area */
            #pedidos .product-item { max-width: none; }
            #pedidos .product-item img { height: clamp(160px, 14vw, 240px); }
            /* Each competition's products grid shows 3 products per row */
            .competition-products { grid-template-columns: repeat(3, 1fr); }
            /* Cart panel no longer participates in this grid on desktop; increase max width for better UX in its dedicated view */
            .cart-panel { position: relative; right: 0; top: 0; width: 100%; max-width: 560px; align-self: start; transform: none; margin-top: 36px; }
            /* Header/controls align to the 4th product column because they share the same grid column */
            #pedidos.activa .product-gallery { padding-right: 0; }
        }
        @media (max-width: 1200px) {
            .product-gallery-ui { padding-right: 0; }
            .cart-panel { position: relative; width: 100%; right: 0; top: 0; z-index: auto; }
        }
    /* Small helper for the checkout modal inputs */
    .checkout-input { width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;margin-bottom:8px }
    /* Ajustes para que la tarjeta se adapte a la imagen 800x800 */
    .product-item, .pedido-mini-card { display:flex; flex-direction:column; align-items:center; }
    .product-item > img, .pedido-mini-card img.pedido-carrusel-img { max-width:800px; width:100%; height:140px; object-fit:cover; border-radius:8px; }
    .pedido-mini-card { padding:4px; cursor: pointer; }
    .pedido-mini-card .thumb-img { display:none; }
    
    /* Estilos para las secciones de competición */
    .gallery-controls {
        margin-top: 10px;
        margin-bottom: 20px;
        padding: 15px;
        background: rgba(5,25,55,0.6);
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        width: 100%;
        box-sizing: border-box;
    }
    
    .gallery-controls .league-filter,
    .gallery-controls .sort-order {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .gallery-controls select {
        padding: 8px 12px;
        border-radius: 6px;
        background: #071735;
        color: white;
        border: 1px solid #2e7bed;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 180px;
    }
    
    .gallery-controls select:hover {
        border-color: var(--azul-acento);
        box-shadow: 0 0 8px rgba(46,123,237,0.5);
    }
    
    .gallery-controls label {
        color: #9fe0ff;
        font-weight: 500;
        white-space: nowrap;
    }
    
    @media (max-width: 768px) {
        .gallery-controls {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .gallery-controls .league-filter,
        .gallery-controls .sort-order {
            width: 100%;
        }
        
        .gallery-controls select {
            width: 100%;
        }
    }
    </style>

    <style>
    /* MOBILE: mejoras específicas solo para la sección 'pedidos' (tienda)
       - layout de una columna para la galería
       - tarjetas más grandes y separadas para toque cómodo
       - carrito actúa como bottom-sheet colapsable para no tapar contenido
       Estos estilos solo afectan a #pedidos y no tocan otras secciones. */
    @media (max-width: 900px) {
        /* Rejilla de la UI: header + galería + carrito (pila vertical) */
        #pedidos.activa .product-gallery-ui {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto 1fr auto;
            grid-template-areas: "header" "gallery" "cart";
            gap: 14px;
            padding-right: 0;
        }

        /* Galería: 2 columnas táctiles por fila, imágenes más altas */
        #pedidos .product-gallery { grid-template-columns: repeat(2, minmax(140px, 1fr)); gap: 12px; }
        #pedidos .product-item { padding: 12px; border-radius: 12px; max-width: none; }
        #pedidos .product-item img { height: 180px; object-fit: cover; border-radius: 8px; }

        /* Espaciado en header/controles */
        #pedidos .gallery-header, #pedidos .gallery-controls { padding: 8px 6px; }

        /* Carrito: bottom sheet fijo, ancho completo con márgenes, altura limitada y scroll interno */
        #pedidos .cart-panel {
            position: fixed !important;
            left: 12px !important;
            right: 12px !important;
            bottom: 12px !important;
            top: auto !important;
            width: auto !important;
            max-width: none !important;
            max-height: 62vh !important;
            overflow: auto !important;
            border-radius: 12px !important;
            box-shadow: 0 12px 40px rgba(0,0,0,0.45) !important;
            transition: transform 0.22s ease, visibility 0.22s ease;
            z-index: 1300 !important;
            margin-top: 0 !important;
        }

        /* Estado colapsado: solo se deja visible la cabecera (aprox 64px) */
        #pedidos .cart-panel.collapsed { transform: translateY(calc(100% - 64px)); }

        /* Cabecera del carrito táctil */
        #pedidos .cart-header { cursor: pointer; padding: 12px 10px; }

        /* Botones grandes y full-width dentro del carrito */
        #pedidos .cart-actions { display:flex; gap:8px; }
        #pedidos .cart-actions .btn-primary, #pedidos .cart-actions .btn-secondary { padding: 12px; font-size: 1rem; border-radius: 10px; }

        /* Ajustes de elementos del carrito para facilitar la lectura */
        #pedidos .cart-item { padding:10px; gap:10px; }
        #pedidos .cart-item img { width:56px; height:56px; }
        #pedidos .cart-items { max-height: calc(62vh - 180px); overflow:auto; }

        /* Aumentar zona de pulsación en filtros/inputs */
        #pedidos .gallery-controls select, #pedidos .product-search-wrap input { padding: 12px 10px; font-size: 1rem; }
    }
    </style>

    <script>
        // Datos de ejemplos tomados de la carpeta assets/productos
        const PRODUCTS = [
    { id: 'barca1', name: 'Camiseta Local Barcelona 25/26', price: 19.90, img: 'assets/productos/La Liga/Barcelona2526L/1.jpg', images: [
        'assets/productos/La Liga/Barcelona2526L/1.jpg',
        'assets/productos/La Liga/Barcelona2526L/2.jpg',
        'assets/productos/La Liga/Barcelona2526L/3.jpg',
        'assets/productos/La Liga/Barcelona2526L/4.jpg',
        'assets/productos/La Liga/Barcelona2526L/5.jpg'
    ], excerpt: '', link: 'productos/barcelona2526L.html' },

    { id: 'realm1', name: 'Camiseta Local Real Madrid 25/26', price: 19.90, img: 'assets/productos/La Liga/RealMadrid2526L/1.jpg', images: [
        'assets/productos/La Liga/RealMadrid2526L/1.jpg',
        'assets/productos/La Liga/RealMadrid2526L/2.jpg',
        'assets/productos/La Liga/RealMadrid2526L/3.jpg',
        'assets/productos/La Liga/RealMadrid2526L/4.jpg'
    ], excerpt: '', link: 'productos/realmadrid2526L.html' },

    { id: 'athl1', name: 'Camiseta Local Athletic Club 25/26', price: 19.90, img: 'assets/productos/La Liga/Athletic2526L/1.jpg', images: [
        'assets/productos/La Liga/Athletic2526L/1.jpg',
        'assets/productos/La Liga/Athletic2526L/2.jpg',
        'assets/productos/La Liga/Athletic2526L/3.jpg',
        'assets/productos/La Liga/Athletic2526L/4.jpg'
    ], excerpt: '', link: 'productos/athletic2526L.html' },

    { id: 'atletico0203', name: 'Camiseta Retro Atlético 02/03', price: 24.90, img: 'assets/productos/La Liga/Atletico0203LR/1.jpg', images: [
        'assets/productos/La Liga/Atletico0203LR/1.jpg',
        'assets/productos/La Liga/Atletico0203LR/2.jpg',
        'assets/productos/La Liga/Atletico0203LR/3.jpg'
    ], excerpt: '', link: 'productos/atletico0203.html', versions: ['fan'], isRetro: true },

    { id: 'athl0103F', name: 'Camiseta Retro Athletic 01/03 Visitante', price: 24.90, img: 'assets/productos/La Liga/Athletic0103FR/1.jpg', images: [
        'assets/productos/La Liga/Athletic0103FR/1.jpg',
        'assets/productos/La Liga/Athletic0103FR/2.jpg',
        'assets/productos/La Liga/Athletic0103FR/3.jpg',
        'assets/productos/La Liga/Athletic0103FR/4.jpg'
    ], excerpt: '', link: 'productos/athletic0103FR.html', versions: ['fan'], isRetro: true },

    { id: 'atleticoL', name: 'Camiseta Local Atlético 25/26', price: 19.90, img: 'assets/productos/La Liga/Atletico2526L/1.jpg', images: [
        'assets/productos/La Liga/Atletico2526L/1.jpg',
        'assets/productos/La Liga/Atletico2526L/2.jpg',
        'assets/productos/La Liga/Atletico2526L/3.jpg',
        'assets/productos/La Liga/Atletico2526L/4.jpg'
    ], excerpt: '', link: 'productos/atletico2526L.html' },

    { id: 'atleticoF2', name: 'Camiseta Visitante Atlético 25/26', price: 19.90, img: 'assets/productos/La Liga/Atletico2526F/1.jpg', images: [
        'assets/productos/La Liga/Atletico2526F/1.jpg',
        'assets/productos/La Liga/Atletico2526F/2.jpg',
        'assets/productos/La Liga/Atletico2526F/3.jpg',
        'assets/productos/La Liga/Atletico2526F/4.jpg'
    ], excerpt: '', link: 'productos/atletico2526F.html' },

    { id: 'betisL', name: 'Camiseta Local Betis 25/26', price: 19.90, img: 'assets/productos/La Liga/Betis2526L/1.jpg', images: [
        'assets/productos/La Liga/Betis2526L/1.jpg',
        'assets/productos/La Liga/Betis2526L/2.jpg',
        'assets/productos/La Liga/Betis2526L/3.jpg',
        'assets/productos/La Liga/Betis2526L/4.jpg'
    ], excerpt: '', link: 'productos/betis2526L.html' },
    { id: 'Barcelona2526F', name: 'Camiseta Visitante Barcelona 25/26', price: 19.90, img: 'assets/productos/La Liga/Barcelona2526F/1.jpg', images: [
        'assets/productos/La Liga/Barcelona2526F/1.jpg',
        'assets/productos/La Liga/Barcelona2526F/2.jpg',
        'assets/productos/La Liga/Barcelona2526F/3.jpg',
        'assets/productos/La Liga/Barcelona2526F/4.jpg'
    ], excerpt: '', link: 'productos/Barcelona2526F.html' },

    { id: 'celtaL', name: 'Camiseta Local Celta 25/26', price: 19.90, img: 'assets/productos/La Liga/Celta2526L/1.jpg', images: [
        'assets/productos/La Liga/Celta2526L/1.jpg',
        'assets/productos/La Liga/Celta2526L/2.jpg',
        'assets/productos/La Liga/Celta2526L/3.jpg',
        'assets/productos/La Liga/Celta2526L/4.jpg'
    ], excerpt: '', link: 'productos/celta2526L.html' },

    { id: 'elcheF', name: 'Camiseta Visitante Elche 25/26', price: 19.90, img: 'assets/productos/La Liga/Elche2526F/1.jpg', images: [
        'assets/productos/La Liga/Elche2526F/1.jpg',
        'assets/productos/La Liga/Elche2526F/2.jpg',
        'assets/productos/La Liga/Elche2526F/3.jpg',
        'assets/productos/La Liga/Elche2526F/4.jpg'
    ], excerpt: '', link: 'productos/Elche2526F.html' },

    { id: 'elcheL', name: 'Camiseta Local Elche 25/26', price: 19.90, img: 'assets/productos/La Liga/Elche2526L/1.jpeg', images: [
        'assets/productos/La Liga/Elche2526L/1.jpeg',
        'assets/productos/La Liga/Elche2526L/2.jpeg',
        'assets/productos/La Liga/Elche2526L/3.jpeg'
    ], excerpt: '', link: 'productos/Elche2526L.html' },

    { id: 'espanyolLR', name: 'Camiseta Retro Espanyol 99/00 Local', price: 24.90, img: 'assets/productos/La Liga/Espanyol9920LR/1.jpg', images: [
        'assets/productos/La Liga/Espanyol9920LR/1.jpg',
        'assets/productos/La Liga/Espanyol9920LR/2.jpg',
        'assets/productos/La Liga/Espanyol9920LR/3.jpg',
        'assets/productos/La Liga/Espanyol9920LR/4.jpg'
    ], excerpt: '', link: 'productos/espanyol9920LR.html', versions: ['fan'], isRetro: true },

    { id: 'getafeL', name: 'Camiseta Local Getafe 25/26', price: 19.90, img: 'assets/productos/La Liga/Getafe2526L/1.png', images: [
        'assets/productos/La Liga/Getafe2526L/1.png',
        'assets/productos/La Liga/Getafe2526L/2.png'
    ], excerpt: '', link: 'productos/getafe2526L.html' },

    { id: 'gironaL', name: 'Camiseta Local Girona 25/26', price: 19.90, img: 'assets/productos/La Liga/Girona2526L/1.jpg', images: [
        'assets/productos/La Liga/Girona2526L/1.jpg',
        'assets/productos/La Liga/Girona2526L/2.jpg',
        'assets/productos/La Liga/Girona2526L/3.jpg',
        'assets/productos/La Liga/Girona2526L/4.jpg'
    ], excerpt: '', link: 'productos/girona2526L.html' },

    { id: 'granadaL', name: 'Camiseta Local Granada 25/26', price: 19.90, img: 'assets/productos/La Liga/Granada2526L/1.jpg', images: [
        'assets/productos/La Liga/Granada2526L/1.jpg',
        'assets/productos/La Liga/Granada2526L/2.jpg',
        'assets/productos/La Liga/Granada2526L/3.jpg',
        'assets/productos/La Liga/Granada2526L/4.jpg'
    ], excerpt: '', link: 'productos/granada2526L.html' },

    { id: 'laspalmasL', name: 'Camiseta Local Las Palmas 25/26', price: 19.90, img: 'assets/productos/La Liga/LasPalmas2526L/1.jpg', images: [
        'assets/productos/La Liga/LasPalmas2526L/1.jpg',
        'assets/productos/La Liga/LasPalmas2526L/2.jpg',
        'assets/productos/La Liga/LasPalmas2526L/3.jpg',
        'assets/productos/La Liga/LasPalmas2526L/4.jpg'
    ], excerpt: '', link: 'productos/laspalmas2526L.html' },

    { id: 'leganesL', name: 'Camiseta Local Leganés 25/26', price: 19.90, img: 'assets/productos/La Liga/Leganes2526L/1.jpg', images: [
        'assets/productos/La Liga/Leganes2526L/1.jpg',
        'assets/productos/La Liga/Leganes2526L/2.jpg',
        'assets/productos/La Liga/Leganes2526L/3.jpg',
        'assets/productos/La Liga/Leganes2526L/4.jpg'
    ], excerpt: '', link: 'productos/leganes2526L.html' },

    { id: 'levanteL', name: 'Camiseta Local Levante 25/26', price: 19.90, img: 'assets/productos/La Liga/Levante2526L/1.jpeg', images: [
        'assets/productos/La Liga/Levante2526L/1.jpeg',
        'assets/productos/La Liga/Levante2526L/2.jpeg',
        'assets/productos/La Liga/Levante2526L/3.jpeg',
        'assets/productos/La Liga/Levante2526L/4.jpeg'
    ], excerpt: '', link: 'productos/levante2526L.html' },

    { id: 'malagaL', name: 'Camiseta Local Málaga 25/26', price: 19.90, img: 'assets/productos/La Liga/Malaga2526L/1.jpg', images: [
        'assets/productos/La Liga/Malaga2526L/1.jpg',
        'assets/productos/La Liga/Malaga2526L/2.jpg',
        'assets/productos/La Liga/Malaga2526L/3.jpg',
        'assets/productos/La Liga/Malaga2526L/4.jpg'
    ], excerpt: '', link: 'productos/malaga2526L.html' },

    { id: 'mallorcaL', name: 'Camiseta Local Mallorca 25/26', price: 19.90, img: 'assets/productos/La Liga/Mallorca2526L/1.jpg', images: [
        'assets/productos/La Liga/Mallorca2526L/1.jpg',
        'assets/productos/La Liga/Mallorca2526L/2.jpg',
        'assets/productos/La Liga/Mallorca2526L/3.jpg',
        'assets/productos/La Liga/Mallorca2526L/4.jpg'
    ], excerpt: '', link: 'productos/mallorca2526L.html' },

    { id: 'osasunaL', name: 'Camiseta Local Osasuna 25/26', price: 19.90, img: 'assets/productos/La Liga/Osasuna2526L/1.png', images: [
        'assets/productos/La Liga/Osasuna2526L/1.png',
        'assets/productos/La Liga/Osasuna2526L/2.png'
    ], excerpt: '', link: 'productos/osasuna2526L.html' },

    { id: 'oviedoL', name: 'Camiseta Local Oviedo 25/26', price: 19.90, img: 'assets/productos/La Liga/Oviedo2526L/1.jpg', images: [
        'assets/productos/La Liga/Oviedo2526L/1.jpg',
        'assets/productos/La Liga/Oviedo2526L/2.jpg',
        'assets/productos/La Liga/Oviedo2526L/3.jpg',
        'assets/productos/La Liga/Oviedo2526L/4.jpg'
    ], excerpt: '', link: 'productos/oviedo2526L.html' },

    { id: 'rayoL', name: 'Camiseta Local Rayo Vallecano 25/26', price: 19.90, img: 'assets/productos/La Liga/Rayo2526L/1.jpg', images: [
        'assets/productos/La Liga/Rayo2526L/1.jpg',
        'assets/productos/La Liga/Rayo2526L/2.jpg'
    ], excerpt: '', link: 'productos/rayo2526L.html' },

    { id: 'realmF', name: 'Camiseta Visitante Real Madrid 25/26', price: 19.90, img: 'assets/productos/La Liga/RealMadrid2526F/1.jpg', images: [
        'assets/productos/La Liga/RealMadrid2526F/1.jpg',
        'assets/productos/La Liga/RealMadrid2526F/2.jpg',
        'assets/productos/La Liga/RealMadrid2526F/3.jpg',
        'assets/productos/La Liga/RealMadrid2526F/4.jpg'
    ], excerpt: '', link: 'productos/realmadrid2526F.html' },

    { id: 'realmT', name: 'Camiseta Tercera Real Madrid 25/26', price: 19.90, img: 'assets/productos/La Liga/RealMadrid2526T/1.jpg', images: [
        'assets/productos/La Liga/RealMadrid2526T/1.jpg',
        'assets/productos/La Liga/RealMadrid2526T/2.jpg',
        'assets/productos/La Liga/RealMadrid2526T/3.jpg',
        'assets/productos/La Liga/RealMadrid2526T/4.jpg'
    ], excerpt: '', link: 'productos/realmadrid2526T.html' },

    { id: 'realsociedadL', name: 'Camiseta Local Real Sociedad 25/26', price: 19.90, img: 'assets/productos/La Liga/RealSociedad2526L/1.jpg', images: [
        'assets/productos/La Liga/RealSociedad2526L/1.jpg',
        'assets/productos/La Liga/RealSociedad2526L/2.jpg',
        'assets/productos/La Liga/RealSociedad2526L/3.jpg',
        'assets/productos/La Liga/RealSociedad2526L/4.jpg'
    ], excerpt: '', link: 'productos/realsociedad2526L.html' },

    { id: 'sevillaF', name: 'Camiseta Visitante Sevilla 25/26', price: 19.90, img: 'assets/productos/La Liga/Sevilla2526F/1.jpg', images: [
        'assets/productos/La Liga/Sevilla2526F/1.jpg',
        'assets/productos/La Liga/Sevilla2526F/2.jpg',
        'assets/productos/La Liga/Sevilla2526F/3.jpg',
        'assets/productos/La Liga/Sevilla2526F/4.jpg'
    ], excerpt: '', link: 'productos/sevilla2526F.html' },

    { id: 'sevillaT', name: 'Camiseta Tercera Sevilla 25/26', price: 19.90, img: 'assets/productos/La Liga/Sevilla2526T/1.jpg', images: [
        'assets/productos/La Liga/Sevilla2526T/1.jpg',
        'assets/productos/La Liga/Sevilla2526T/2.jpg',
        'assets/productos/La Liga/Sevilla2526T/3.jpg',
        'assets/productos/La Liga/Sevilla2526T/4.jpg'
    ], excerpt: '', link: 'productos/sevilla2526T.html' },

    { id: 'valenciaL', name: 'Camiseta Local Valencia 25/26', price: 19.90, img: 'assets/productos/La Liga/Valencia2526L/1.jpg', images: [
        'assets/productos/La Liga/Valencia2526L/1.jpg',
        'assets/productos/La Liga/Valencia2526L/2.jpg',
        'assets/productos/La Liga/Valencia2526L/3.jpg',
        'assets/productos/La Liga/Valencia2526L/4.jpg'
    ], excerpt: '', link: 'productos/valencia2526L.html' },

    { id: 'valladolidL', name: 'Camiseta Local Valladolid 25/26', price: 19.90, img: 'assets/productos/La Liga/Valladolid2526L/1.jpg', images: [
        'assets/productos/La Liga/Valladolid2526L/1.jpg',
        'assets/productos/La Liga/Valladolid2526L/2.jpg',
        'assets/productos/La Liga/Valladolid2526L/3.jpg',
        'assets/productos/La Liga/Valladolid2526L/4.jpg'
    ], excerpt: '', link: 'productos/valladolid2526L.html' },
    
    { id: 'alavesL', name: 'Camiseta Local Alavés 25/26', price: 19.90, img: 'assets/productos/La Liga/Alaves2526L/1.jpg', images: [
        'assets/productos/La Liga/Alaves2526L/1.jpg',
        'assets/productos/La Liga/Alaves2526L/2.jpg',
    ], excerpt: '', link: 'productos/alaves2526L.html' },

    { id: 'villarrealL', name: 'Camiseta Local Villarreal 25/26', price: 19.90, img: 'assets/productos/La Liga/Villarreal2526L/1.jpg', images: [
        'assets/productos/La Liga/Villarreal2526L/1.jpg',
        'assets/productos/La Liga/Villarreal2526L/2.jpg',
        'assets/productos/La Liga/Villarreal2526L/3.jpg',
        'assets/productos/La Liga/Villarreal2526L/4.jpg'
    ], excerpt: '', link: 'productos/villarreal2526L.html' },
    { id: 'munich2526L', name: 'Camiseta Local Bayern Munich 25/26', price: 19.90, img: 'assets/productos/Bundesliga/Munich2526L/1.jpg', images: [
        'assets/productos/Bundesliga/Munich2526L/1.jpg',
        'assets/productos/Bundesliga/Munich2526L/2.jpg',
        'assets/productos/Bundesliga/Munich2526L/3.jpg',
        'assets/productos/Bundesliga/Munich2526L/4.jpg'
    ], excerpt: '', link: 'productos/munich2526L.html' },
    { id: 'Paris2526L', name: 'Camiseta Local PSG 25/26', price: 19.90, img: 'assets/productos/Ligue 1/Paris2526L/1.jpg', images: [
        'assets/productos/Ligue 1/Paris2526L/1.jpg',
        'assets/productos/Ligue 1/Paris2526L/2.jpg',
        'assets/productos/Ligue 1/Paris2526L/3.jpg',
        'assets/productos/Ligue 1/Paris2526L/4.jpg'
    ], excerpt: '', link: 'productos/Paris2526L.html' },
    { id: 'CrystalPalace2526L', name: 'Camiseta Local Crystal Palace 25/26', price: 19.90, img: 'assets/productos/Premier League/CrystalPalace2526L/1.jpg', images: [
        'assets/productos/Premier League/CrystalPalace2526L/1.jpg',
        'assets/productos/Premier League/CrystalPalace2526L/2.jpg',
        'assets/productos/Premier League/CrystalPalace2526L/3.jpg',
        'assets/productos/Premier League/CrystalPalace2526L/4.jpg'
    ], excerpt: '', link: 'productos/CrystalPalace2526L.html' },
    { id: 'Milan9798LR', name: 'Camiseta Local Milan 97/98', price: 19.90, img: 'assets/productos/Serie A/Milan9798LR/1.jpg', images: [
        'assets/productos/Serie A/Milan9798LR/1.jpg',
        'assets/productos/Serie A/Milan9798LR/2.jpg',
        'assets/productos/Serie A/Milan9798LR/3.jpg',
        'assets/productos/Serie A/Milan9798LR/4.jpg'
    ], excerpt: '', link: 'productos/Milan9798LR.html' },

    { id: 'atleticoKids2526F', name: 'Camiseta Visitante Atlético 25/26 (Kids)', price: 21.90, img: 'assets/productos/La Liga/AtleticoKids2526F/1.jpg', images: [
        'assets/productos/La Liga/AtleticoKids2526F/1.jpg',
        'assets/productos/La Liga/AtleticoKids2526F/2.jpg',
        'assets/productos/La Liga/AtleticoKids2526F/3.jpg',
        'assets/productos/La Liga/AtleticoKids2526F/4.jpg'
    ], excerpt: '', link: 'productos/AtleticoKids2526F.html' },

    { id: 'athleticKids2526T', name: 'Camiseta Tercera Athletic Club 25/26 (Kids)', price: 21.90, img: 'assets/productos/La Liga/AthelticKids2526T/1.jpg', images: [
        'assets/productos/La Liga/AthelticKids2526T/1.jpg',
        'assets/productos/La Liga/AthelticKids2526T/2.jpg',
        'assets/productos/La Liga/AthelticKids2526T/3.jpg'
    ], excerpt: '', link: 'productos/AthleticKids2526T.html' },

    { id: 'marseillaKids2526F', name: 'Camiseta Visitante Marsella 25/26 (Kids)', price: 21.90, img: 'assets/productos/Ligue 1/MarseillaKids2526F/1.jpg', images: [
        'assets/productos/Ligue 1/MarseillaKids2526F/1.jpg',
        'assets/productos/Ligue 1/MarseillaKids2526F/2.jpg',
        'assets/productos/Ligue 1/MarseillaKids2526F/3.jpg',
        'assets/productos/Ligue 1/MarseillaKids2526F/4.jpg'
    ], excerpt: '', link: 'productos/MarseillaKids2526F.html' },

    { id: 'unitedKids2526F', name: 'Camiseta Visitante Manchester United 25/26 (Kids)', price: 21.90, img: 'assets/productos/Premier League/UnitedKids2526F/1.jpg', images: [
        'assets/productos/Premier League/UnitedKids2526F/1.jpg',
        'assets/productos/Premier League/UnitedKids2526F/2.jpg',
        'assets/productos/Premier League/UnitedKids2526F/3.jpg',
        'assets/productos/Premier League/UnitedKids2526F/4.jpg'
    ], excerpt: '', link: 'productos/UnitedKids2526F.html' },

    { id: 'nbaLakers1', name: 'Camiseta NBA Lakers (Modelo 1)', price: 24.90, img: 'assets/productos/NBA/Lakers1/1.jpeg', images: [
        'assets/productos/NBA/Lakers1/1.jpeg',
        'assets/productos/NBA/Lakers1/2.jpeg'
    ], excerpt: '', link: 'productos/Lakers1.html' },

    { id: 'nbaOklahoma1', name: 'Camiseta NBA Oklahoma (Modelo 1)', price: 24.90, img: 'assets/productos/NBA/Oklahoma/1.jpeg', images: [
        'assets/productos/NBA/Oklahoma/1.jpeg',
        'assets/productos/NBA/Oklahoma/2.jpeg'
    ], excerpt: '', link: 'productos/Oklahoma.html' },

    { id: 'nbaPhila1', name: 'Camiseta NBA Philadelphia (Modelo 1)', price: 24.90, img: 'assets/productos/NBA/Phila1/1.jpeg', images: [
        'assets/productos/NBA/Phila1/1.jpeg',
        'assets/productos/NBA/Phila1/2.jpeg',
        'assets/productos/NBA/Phila1/3.jpeg'
    ], excerpt: '', link: 'productos/Phila1.html' }
];

        const EXTRAS = { parche: 1, dorsal: 2, versionJugador: 5, version: 5 };
        const SHIPPING = 2.00;
        // Ofertas por cantidad (no se crean productos nuevos; se aplican automáticamente según cantidad de camisetas)
        // Nota: asumimos que las camisetas son el producto con id 'barca1' o cuyo nombre contiene 'Camiseta'
        const OFFERS = [
            { size: 5, price: 85.90, shipping: 0, label: 'MEGAPACK 5' },
            { size: 4, price: 72.90, shipping: 0, label: 'Pack 4' },
            { size: 3, price: 56.90, shipping: 0, label: 'Pack 3' },
            { size: 2, price: 39.80, shipping: 0, label: 'Pack 2' },
            // oferta para 1 unidad promocional (si la tienda tiene 1x en oferta)
            { size: 1, price: 19.90, shipping: 1.90, label: 'Pack 1 (Promo)' }
        ];
        let CART = [];

        // Helpers globales para detección de camisetas y cálculo de mejor combinación de packs
        function isShirtItem(ci){
            if (!ci || !ci.name) return false;
            const name = (ci.name || '').toLowerCase();
            return (ci.productId === 'barca1') || name.includes('camiseta') || name.includes('camisetas');
        }

        function computeBestOfferForCount(count){
            if (count <= 0) return { total:0, shipping:0, combo: {} };
            const dp = Array(count+1).fill(null);
            dp[0] = { total:0, shipping:0, combo: {} };
            for (let i=1;i<=count;i++){
                let best = null;
                for (const offer of OFFERS){
                    if (i - offer.size < 0) continue;
                    const prev = dp[i - offer.size];
                    if (!prev) continue;
                    const candTotal = prev.total + offer.price;
                    const candShipping = prev.shipping + (offer.shipping||0);
                    const candSum = candTotal + candShipping;
                    if (!best || candSum < (best.total + best.shipping)){
                        const combo = Object.assign({}, prev.combo);
                        combo[offer.size] = (combo[offer.size]||0) + 1;
                        best = { total: candTotal, shipping: candShipping, combo };
                    }
                }
                dp[i] = best;
            }
            return dp[count] || { total:0, shipping:0, combo: {} };
        }

        function byId(id){return document.getElementById(id);}    

        // computeCartTotals: reutilizable para carrito y checkout
    function computeCartTotals(){
            const shirtItems = CART.filter(isShirtItem);
            const nonShirtItems = CART.filter(ci => !isShirtItem(ci));
            const nonShirtSubtotal = nonShirtItems.reduce((s,it)=> s + (it.total || 0), 0);
            const shirtCount = shirtItems.length;
            const shirtExtrasSum = shirtItems.reduce((s,it)=> s + (it.extra||0), 0);
            const shirtBaseSum = shirtItems.reduce((s,it)=> s + (it.price||0), 0);
            // Determinar precio base por unidad usado por las ofertas (pack de 1 si existe)
            const baseOffer = (OFFERS && OFFERS.find(o=>o.size===1) && OFFERS.find(o=>o.size===1).price) ? OFFERS.find(o=>o.size===1).price : 19.90;
            // Sumar recargo por camisetas que tengan precio mayor al precio base (p. ej. 24.90 vs 19.90)
            const shirtPriceSurplus = shirtItems.reduce((s,it) => s + Math.max(0, (it.price || 0) - baseOffer), 0);
            const originalSubtotal = nonShirtSubtotal + shirtBaseSum + shirtExtrasSum;
            const originalShipping = (CART.length>0? SHIPPING : 0);
            const originalTotal = originalSubtotal + originalShipping;
            if (shirtCount === 0) return { subtotal: originalSubtotal, shipping: originalShipping, total: originalTotal, appliedOffer: null, savings:0 };
            const best = computeBestOfferForCount(shirtCount);
            // El coste calculado por packs (best.total) asume precios base; añadimos extras y cualquier diferencia de precio por unidad
            const shirtsOfferCost = best.total + shirtExtrasSum + shirtPriceSurplus;
            // Si hay más de 1 camiseta aplicamos envío gratis a todo el pedido
            const shirtsOfferShipping = (shirtCount > 1) ? 0 : best.shipping;
            const newSubtotal = nonShirtSubtotal + shirtsOfferCost;
            // Si hay más de 1 camiseta, envío gratis global; si no, sumar shipping para nonShirtItems si existen
            const newShipping = (shirtCount > 1) ? 0 : (shirtsOfferShipping + (nonShirtItems.length>0 ? SHIPPING : 0));
            const newTotal = newSubtotal + newShipping;

            // Map user-defined estimated savings per number of camisetas (base table)
            const SAVINGS_TABLE = { 1: 2.00, 2: 5.00, 3: 13.00, 4: 15.00, 5: 25.00 };

            // Decompose count into multiples of 5 + remainder and sum the table values
            function computeSavingsByDecomposition(n){
                if (!n || n <= 0) return 0;
                let remaining = n;
                let totalSavings = 0;
                // use as many 5-packs as possible
                const pack5 = Math.floor(remaining / 5);
                if (pack5 > 0 && SAVINGS_TABLE[5]) {
                    totalSavings += pack5 * SAVINGS_TABLE[5];
                    remaining = remaining - pack5 * 5;
                }
                // handle remainder using table if available, otherwise fallback to original diff for remainder
                if (remaining > 0) {
                    if (SAVINGS_TABLE[remaining] !== undefined) {
                        totalSavings += SAVINGS_TABLE[remaining];
                    } else {
                        // fallback: estimate proportional part of fallback savings
                        const fallback = Math.max(0, originalTotal - newTotal);
                        // distribute fallback proportionally by remaining/count
                        totalSavings += Math.round((fallback * (remaining / n)) * 100) / 100;
                    }
                }
                return totalSavings;
            }

            const fallbackSavings = Math.max(0, originalTotal - newTotal);
            const savings = (shirtCount > 0) ? computeSavingsByDecomposition(shirtCount) : 0;

            return { subtotal: newSubtotal, shipping: newShipping, total: newTotal, appliedOffer: { count: shirtCount, detail: best, priceSurplus: shirtPriceSurplus }, savings };
        }

        // simple debounce helper
        function debounce(fn, wait){ let t = null; return function(){ clearTimeout(t); t = setTimeout(()=> fn.apply(this, arguments), wait); }; }

        // Banner promocional: helpers de creación, posicionamiento y visibilidad
        const __PROMO = { el: null, type: null, visible: false };
        function ensurePromoEl(){
            if (__PROMO.el && document.body.contains(__PROMO.el)) return __PROMO.el;
            const el = document.createElement('div');
            el.id = 'cartPromoBanner';
            el.className = 'cart-promo-banner fast';
            // Contenido mínimo: el óvalo (.promo-badge) recibirá el texto dinámicamente
            el.innerHTML = '<div class="promo-inner"><span class="promo-badge"></span></div>';
            document.body.appendChild(el);
            __PROMO.el = el; return el;
        }
        function positionPromoBanner(){
            const el = ensurePromoEl();
            if (!__PROMO.visible) return; // solo si visible
            const cart = document.getElementById('cartPanel');
            const secCarrito = document.getElementById('carrito');
            const secPedidos = document.getElementById('pedidos');
            const sectionActive = (secCarrito && secCarrito.classList.contains('activa')) || (secPedidos && secPedidos.classList.contains('activa'));
            if (!cart || !sectionActive) { el.style.opacity = '0'; return; }
            const r = cart.getBoundingClientRect();
            const left = Math.round(r.left);
            const width = Math.round(r.width);
            // Colocar el banner por encima del borde superior del carrito
            const gap = 8;
            const bannerH = el.offsetHeight || 0;
            const topPos = Math.round(r.top) - bannerH - gap;
            el.style.left = left + 'px';
            el.style.top = topPos + 'px';
            el.style.width = width + 'px';
        }
        function hidePromoBanner(){
            const el = ensurePromoEl();
            __PROMO.visible = false;
            el.classList.remove('visible');
        }
        function showPromoBanner(type){
            const el = ensurePromoEl();
            const newType = (type === 5 ? 5 : 3);
            if (__PROMO.visible && __PROMO.type === newType) { positionPromoBanner(); return; }
            __PROMO.type = newType;
            el.classList.remove('theme-3','theme-5','fast','subtle');
            const badge = el.querySelector('.promo-badge');
            if (newType === 3){
                el.classList.add('theme-3','fast');
                if (badge) badge.textContent = 'PACK POPULAR';
            } else {
                el.classList.add('theme-5','subtle');
                if (badge) badge.textContent = 'MEJOR OFERTA';
            }
            __PROMO.visible = true;
            positionPromoBanner();
            void el.offsetWidth; // reflow para animación
            el.classList.add('visible');
        }
        function updateCartPromoBanner(){
            try {
                const secCarrito = document.getElementById('carrito');
                const secPedidos = document.getElementById('pedidos');
                const sectionActive = (secCarrito && secCarrito.classList.contains('activa')) || (secPedidos && secPedidos.classList.contains('activa'));
                if (!sectionActive) { hidePromoBanner(); return; }
                const shirtCount = (Array.isArray(CART)? CART : []).filter(isShirtItem).length;
                if (shirtCount === 5) showPromoBanner(5);
                else if (shirtCount === 3) showPromoBanner(3);
                else hidePromoBanner();
                setTimeout(positionPromoBanner, 30);
                setTimeout(positionPromoBanner, 160);
            } catch(e) {}
        }
        window.addEventListener('resize', debounce(positionPromoBanner, 60));
        window.addEventListener('scroll', debounce(positionPromoBanner, 60));
        document.addEventListener('DOMContentLoaded', ()=> setTimeout(positionPromoBanner, 140));
        // Ajustar tras cambiar sección
        document.querySelectorAll('.boton-seccion').forEach(b => b.addEventListener('click', ()=> setTimeout(()=> { updateCartPromoBanner(); positionPromoBanner(); }, 240)));

        // Variable global para almacenar el estado de ordenamiento y filtrado
        let currentSortOrder = 'default'; // 'default', 'price-asc', 'price-desc'
        let currentLeagueFilter = 'all'; // 'all', 'La Liga', 'Premier League', etc.
        
        // Función para crear los controles de filtrado y ordenamiento
        function createGalleryControls(container) {
            // Obtener todas las ligas disponibles
            const leagues = [];
            PRODUCTS.forEach(p => {
                const imgPath = p.img || (p.images && p.images.length > 0 ? p.images[0] : '');
                const match = imgPath.match(/assets\/productos\/([^/]+)\//i);
                const league = match ? match[1] : 'Otros';
                if (!leagues.includes(league)) {
                    leagues.push(league);
                }
            });
            
            // Crear el contenedor de controles
            const controlsContainer = document.createElement('div');
            controlsContainer.id = 'galleryControls';
            controlsContainer.className = 'gallery-controls';
            
            // Crear el selector de ligas
            const leagueFilter = document.createElement('div');
            leagueFilter.className = 'league-filter';
            leagueFilter.innerHTML = `
                <label for="leagueSelect">Filtrar por liga:</label>
                <select id="leagueSelect">
                    <option value="all">Todas las ligas</option>
                    ${leagues.sort().map(league => `<option value="${league}">${league}</option>`).join('')}
                </select>
            `;
            
            // Crear el selector de ordenamiento
            const sortOrder = document.createElement('div');
            sortOrder.className = 'sort-order';
            sortOrder.innerHTML = `
                <label for="sortSelect">Ordenar por:</label>
                <select id="sortSelect">
                    <option value="default">Por defecto</option>
                    <option value="price-asc">Precio: menor a mayor</option>
                    <option value="price-desc">Precio: mayor a menor</option>
                </select>
            `;
            
            // Agregar los controles al contenedor
            controlsContainer.appendChild(leagueFilter);
            controlsContainer.appendChild(sortOrder);
            
            // Buscar el contenedor del buscador para insertar los controles debajo
            const searchWrap = document.querySelector('.product-search-wrap');
            if (searchWrap) {
                // Insertar después del buscador
                searchWrap.parentNode.insertBefore(controlsContainer, searchWrap.nextSibling);
            } else {
                // Si no hay buscador, insertar al principio del contenedor
                container.insertBefore(controlsContainer, container.firstChild);
            }
            
            // Agregar event listeners
            document.getElementById('leagueSelect').addEventListener('change', function(e) {
                currentLeagueFilter = e.target.value;
                renderGallery(document.getElementById('productSearch')?.value || '');
            });
            
            document.getElementById('sortSelect').addEventListener('change', function(e) {
                currentSortOrder = e.target.value;
                renderGallery(document.getElementById('productSearch')?.value || '');
            });
        }
        
        function renderGallery(filterText){
            const container = byId('productGallery');
            container.innerHTML = '';
            
            // Crear controles de filtrado y ordenamiento si no existen
            if (!document.getElementById('galleryControls')) {
                createGalleryControls(container);
            } else {
                // Asegurarse de que los controles estén debajo del buscador
                const controls = document.getElementById('galleryControls');
                const searchWrap = document.querySelector('.product-search-wrap');
                
                if (controls && searchWrap) {
                    // Mover los controles debajo del buscador
                    searchWrap.parentNode.insertBefore(controls, searchWrap.nextSibling);
                }
            }
            
            // Normalizar y eliminar tildes tanto en la consulta como en los nombres de productos
            const normalizeNoAccents = (s)=> (s||'').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            const q = normalizeNoAccents(filterText || '');
            // Base aleatoria por carga: se calcula una vez y se reutiliza en renderizados posteriores
            const base = (function(){
                if (Array.isArray(window._PRODUCTS_SHUFFLED)) return window._PRODUCTS_SHUFFLED;
                const copy = Array.isArray(PRODUCTS) ? PRODUCTS.slice() : [];
                for (let i = copy.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    const tmp = copy[i]; copy[i] = copy[j]; copy[j] = tmp;
                }
                window._PRODUCTS_SHUFFLED = copy;
                return copy;
            })();
            let list = base.filter(p => { 
                if (!q) return true; 
                const nameNoAccents = normalizeNoAccents(p.name || '');
                return nameNoAccents.indexOf(q) !== -1; 
            });
            
            // Aplicar filtro por liga
            if (currentLeagueFilter !== 'all') {
                list = list.filter(p => {
                    const imgPath = p.img || (p.images && p.images.length > 0 ? p.images[0] : '');
                    const match = imgPath.match(/assets\/productos\/([^/]+)\//i);
                    const league = match ? match[1] : 'Otros';
                    return league === currentLeagueFilter;
                });
            }
            
            // Aplicar ordenamiento
            if (currentSortOrder === 'price-asc') {
                list.sort((a, b) => a.price - b.price);
            } else if (currentSortOrder === 'price-desc') {
                list.sort((a, b) => b.price - a.price);
            }
            
            // Mostrar todos los productos juntos
            list.forEach(p => {
                    const el = document.createElement('article');
                    el.className = 'product-item';
                    // Make the entire card clickable: attach data attributes to the article
                    el.setAttribute('data-id', p.id);
                    el.setAttribute('data-action', 'add');
                    // If the product has an images array render a mini carousel; otherwise render the simple card
                    if (p.images && p.images.length) {
                        const imgsJson = JSON.stringify(p.images);
                        el.innerHTML = `
                            <div class="pedido-mini-card" data-images='${imgsJson}'>
                                <div style="display:flex;justify-content:center;">
                                    <div style="max-width:800px;width:100%;">
                                        <img class="pedido-carrusel-img" src="${p.images[0]}" alt="${p.name}" style="width:100%;height:auto;display:block;border-radius:8px;">
                                    </div>
                                </div>
                                <h4 style="margin-top:6px">${p.name}</h4>
                                <div class="price">€${p.price.toFixed(2)}</div>
                                <div class="excerpt">${p.excerpt}</div>
                                <!-- boton eliminado: la tarjeta completa es clicable -->
                            </div>
                        `;
                    } else {
                        el.innerHTML = `
                                <img src="${p.img}" alt="${p.name}">
                                <h4>${p.name}</h4>
                                <div class="price">€${p.price.toFixed(2)}</div>
                                <div class="excerpt">${p.excerpt}</div>
                                <!-- boton eliminado: la tarjeta completa es clicable -->
                            `;
                    }
                    container.appendChild(el);
                });
        }

        function openProductModal(product){
            // panel simple: generate options inline
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.left = 0; modal.style.top = 0; modal.style.right = 0; modal.style.bottom = 0;
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.background = 'rgba(2,6,23,0.7)';
            modal.style.zIndex = 1200;
            modal.style.padding = '24px';
            modal.style.overflow = 'auto';
            modal.innerHTML = `
                <div style="width:100%;max-width:780px;background:#071735;padding:16px;border-radius:12px;color:#dbeeff;max-height:86vh;overflow:visible;">
                    <div style="display:flex;gap:14px;align-items:flex-start;">
                        <img src="${product.img}" alt="${product.name}" style="width:280px;height:280px;object-fit:cover;border-radius:10px;">
                        <div style="flex:1;">
                            <h3 style="margin-top:0;color:var(--azul-acento);">${product.name}</h3>
                            <p style="color:#d6e9ff;">${product.excerpt}</p>
                            <p style="font-weight:800;font-size:1.25rem;color:#9fe0ff;">€${product.price.toFixed(2)}</p>
                            <form id="_personalizeForm" style="margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:start;">
                                <label style="grid-column:1/3;font-weight:700;color:#dbeeff;">Nombre y número (+2€)
                                    <input id="_opt_dorsal" placeholder="Ej: MESSI 10" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;margin-top:6px;" />
                                </label>

                                <label style="grid-column:1/3;font-weight:700;color:#dbeeff;">Parche (+1€)
                                    <select id="_opt_parche_select" class="custom-select" style="margin-top:6px;">
                                        <option value="none">Ninguno</option>
                                        <option value="LaLiga">LaLiga</option>
                                        <option value="Premier League">Premier League</option>
                                        <option value="Ligue 1">Ligue 1</option>
                                        <option value="Serie A">Serie A</option>
                                        <option value="Bundesliga">Bundesliga</option>
                                        <option value="Champions League">Champions League</option>
                                        <option value="Europa League">Europa League</option>
                                        <option value="Otros">Otros</option>
                                    </select>
                                </label>
                                <label id="_opt_parche_otros_wrap" style="grid-column:1/3;display:none;">
                                    <input id="_opt_parche_otros" placeholder="Indica el parche" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;" />
                                </label>

                                <label style="grid-column:1/3;"> Talla:
                                    <select id="_opt_talla" class="custom-select input-talla">
                                        <option value="S">S</option>
                                        <option value="M">M</option>
                                        <option value="L">L</option>
                                        <option value="XL">XL</option>
                                        <option value="2XL">2XL (+1€)</option>
                                        <option value="3XL">3XL (+2€)</option>
                                        <option value="4XL">4XL (+2€)</option>
                                    </select>
                                </label>

                                <label style="grid-column:1/3;"> Versión (elige una):
                                    <select id="_opt_version" class="custom-select">
                                        <option value="" disabled selected>Selecciona versión</option>
                                        <option value="fan">FAN</option>
                                        <option value="jugador">JUGADOR (+5€)</option>
                                    </select>
                                </label>
                                <div style="grid-column:1/3;margin-top:4px;">
                                    <button id="_sizeGuideBasic" type="button" style="background:transparent;color:var(--azul-acento);border:none;padding:0;cursor:pointer;font-family:inherit;font-size:0.95rem;font-weight:600;transition:all 0.2s ease;position:relative;padding-bottom:2px;display:inline-block;transform:translateX(4px);border-bottom:2px solid var(--azul-acento);">Guía de tallas</button>
                                </div>
                            </form>
                            <div style="margin-top:12px;display:flex;gap:8px;">
                                <button id="_addCart" class="btn-primary">Personalizar y Comprar</button>
                                <button id="_closeModal" class="btn-secondary">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            // Cerrar al hacer click fuera del panel y restaurar scroll del body
            modal.addEventListener('click', (e)=>{ if (e.target === modal) { modal.remove(); document.body.style.overflow = ''; } });
            document.body.style.overflow = 'hidden';

                // Visor ampliado: click en la imagen principal para abrir a pantalla completa
                try {
                    const imgsForViewer = (Array.isArray(product.images) && product.images.length) ? product.images : [product.img];
                    const mainImgEl = modal.querySelector('img');
                    if (mainImgEl) {
                        mainImgEl.style.cursor = 'zoom-in';
                        mainImgEl.addEventListener('click', (e)=>{ e.stopPropagation(); openImageViewer(imgsForViewer, 0); });
                    }
                } catch(e) {}

                // Cerrar modal al pulsar el botón o al hacer click fuera del panel
                modal.querySelector('#_closeModal').addEventListener('click', ()=> modal.remove());
                modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });

                // Guía de tallas overlay
                const _sizeGuideBtn = modal.querySelector('#_sizeGuideBasic');
                if (_sizeGuideBtn) {
                    _sizeGuideBtn.addEventListener('click', ()=>{
                        const overlay = document.createElement('div');
                        overlay.style.position='fixed'; overlay.style.left=0; overlay.style.top=0; overlay.style.right=0; overlay.style.bottom=0;
                        overlay.style.background='rgba(0,0,0,0.85)'; overlay.style.zIndex=5000; overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center';
                        const isNBA = /^nba/i.test(product.id) || /\bNBA\b/i.test(product.name);
                        const guideSrc = isNBA ? 'assets/images/guias tallas nba.png' : 'assets/images/guia tallas camisetas futbol.png';
                        const guideAlt = isNBA ? 'Guía de tallas NBA' : 'Guía de tallas Fútbol';
                        overlay.innerHTML = `
                            <div style="position:relative;width:auto;max-width:98vw;max-height:98vh;background:transparent;border-radius:12px;padding:0;box-shadow:0 12px 40px rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;overflow:auto;">
                                <button aria-label="Cerrar" style="position:absolute;top:8px;right:8px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;font-weight:500;transition:all 0.2s ease;font-size:0.9rem;">✕ Cerrar</button>
                                <img src="${guideSrc}" alt="${guideAlt}" style="height:80vh;max-height:80vh;max-width:98vw;width:auto;object-fit:contain;border-radius:6px;display:block;">
                            </div>
                        `;
                        document.body.appendChild(overlay);
                        const panel = overlay.firstElementChild;
                        const closeBtn = panel.querySelector('button');
                        const close = ()=> overlay.remove();
                        closeBtn.addEventListener('click', (e)=>{ e.stopPropagation(); close(); });
                        overlay.addEventListener('click', (e)=>{ if (e.target === overlay) close(); });
                    });
                }
                try {
                    const __isKids = /kids/i.test(product.id) || /\((kids|niños)\)/i.test(product.name);
                    if (__isKids) {
                        const tallaSel = modal.querySelector('#_opt_talla');
                        if (tallaSel) {
                            tallaSel.innerHTML = `
                                <option value="16">16</option>
                                <option value="18">18</option>
                                <option value="20">20</option>
                                <option value="22">22</option>
                                <option value="24">24</option>
                                <option value="26">26</option>
                                <option value="28">28</option>
                            `;
                        }
                        const verSel = modal.querySelector('#_opt_version');
                        const verLabel = verSel ? verSel.parentElement : null;
                        if (verSel) verSel.value = 'none';
                        if (verLabel) verLabel.style.display = 'none';
                    }
                    const __isNBA = /^nba/i.test(product.id) || /\bNBA\b/i.test(product.name);
                    if (__isNBA) {
                        const verSel = modal.querySelector('#_opt_version');
                        const verLabel = verSel ? verSel.parentElement : null;
                        if (verLabel) verLabel.style.display = 'none';
                        const parcheSel = modal.querySelector('#_opt_parche_select');
                        const parcheLabel = parcheSel ? parcheSel.parentElement : null;
                        if (parcheLabel) parcheLabel.style.display = 'none';
                        const otrosWrap = modal.querySelector('#_opt_parche_otros_wrap');
                        if (otrosWrap) otrosWrap.style.display = 'none';
                        }
                } catch(e) {}
            // Si el producto define versiones y sólo hay una opción, preseleccionarla y ocultar el selector
            try {
                if (product && Array.isArray(product.versions) && product.versions.length === 1) {
                    const verSelect = modal.querySelector('#_opt_version');
                    const verLabel = verSelect ? verSelect.parentElement : null;
                    if (verSelect) { verSelect.value = product.versions[0]; }
                    if (verLabel) { verLabel.style.display = 'none'; }
                }
            } catch(e) { /* ignore if modal not present */ }
            // show/hide 'otros' field for parche
            const parcheSelect = modal.querySelector('#_opt_parche_select');
            const parcheOtrosWrap = modal.querySelector('#_opt_parche_otros_wrap');
            const parcheOtrosInput = modal.querySelector('#_opt_parche_otros');
            if (parcheSelect) {
                parcheSelect.addEventListener('change', function(){
                    if (this.value === 'Otros') { parcheOtrosWrap.style.display = ''; parcheOtrosInput.focus(); }
                    else { parcheOtrosWrap.style.display = 'none'; parcheOtrosInput.value = ''; }
                });
            }

            modal.querySelector('#_addCart').addEventListener('click', ()=>{
                const talla = modal.querySelector('#_opt_talla').value;
                const dorsal = modal.querySelector('#_opt_dorsal').value.trim();
                const __isNBA = /^nba/i.test(product.id) || /\bNBA\b/i.test(product.name);
                // En NBA: dorsal obligatorio y sin parches ni versión
                let parcheFinal = '';
                let version = 'none';
                if (!__isNBA) {
                    const parcheSel = modal.querySelector('#_opt_parche_select').value;
                    if (parcheSel === 'Otros') {
                        const otros = modal.querySelector('#_opt_parche_otros').value.trim();
                        if (!otros) { alert('Indica el parche en el campo "Otros".'); modal.querySelector('#_opt_parche_otros').focus(); return; }
                        parcheFinal = otros;
                    } else {
                        parcheFinal = (parcheSel === 'none' ? '' : parcheSel);
                    }
                    version = modal.querySelector('#_opt_version').value;
                    if (!version) { alert('Selecciona una versión antes de añadir al carrito.'); return; }
                }
                if (__isNBA && !dorsal) { alert('Debes introducir un dorsal para camisetas NBA.'); return; }
                addToCart({ productId: product.id, name: product.name, price: product.price, img: product.img, talla, dorsal, parche: parcheFinal, version });
                modal.remove();
                document.body.style.overflow = '';
            });
        }

        // Nuevo: abrir modal que reutiliza el carrusel/programación visual de la tienda
        function openTiendaCarouselModal(product) {
            if (document.getElementById('modal-tienda-carrusel')) return;
            const modal = document.createElement('div');
            modal.id = 'modal-tienda-carrusel';
            modal.style.position = 'fixed';
            modal.style.left = 0; modal.style.top = 0; modal.style.right = 0; modal.style.bottom = 0;
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.background = 'rgba(2,6,23,0.78)';
            modal.style.zIndex = 1400;
            modal.style.padding = '24px';
            modal.style.overflow = 'auto';

            // Build carousel HTML dynamically from product.images (fallback to [product.img])
            const imgs = Array.isArray(product.images) && product.images.length ? product.images : [product.img];
            const slidesHtml = imgs.map((src, i) => `<img src="${src}" alt="${i+1}" style="flex:0 0 100%;width:100%;max-height:440px;object-fit:cover;border-radius:6px;">`).join('');
            const thumbsHtml = imgs.map((src, i) => `<img data-index="${i}" src="${src}" style="width:56px;height:56px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid rgba(255,255,255,0.06);">`).join('');

            modal.innerHTML = `
                <div style="width:100%;max-width:960px;background:#071735;padding:12px;border-radius:12px;color:#dbeeff;display:grid;grid-template-columns:1fr 320px;gap:14px;max-height:88vh;overflow:visible;">
                    <div style="background:rgba(10,31,61,0.6);padding:10px;border-radius:10px;">
                        <div id="modalTiendaCarousel" style="position:relative;overflow:hidden;border-radius:8px;">
                            <button id="modalTiendaPrev" aria-label="Anterior" style="position:absolute;left:8px;top:50%;transform:translateY(-50%);z-index:5;background:rgba(0,0,0,0.4);border:none;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer;">‹</button>
                            <div class="carousel-track" style="display:flex;transition:transform .35s ease;">
                                ${slidesHtml}
                            </div>
                            <button id="modalTiendaNext" aria-label="Siguiente" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);z-index:5;background:rgba(0,0,0,0.4);border:none;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer;">›</button>
                        </div>
                        <div id="modalTiendaThumbs" style="display:flex;gap:8px;margin-top:10px;justify-content:center;padding:6px;">
                            ${thumbsHtml}
                        </div>
                    </div>
                    <div style="background:rgba(10,31,61,0.9);padding:16px;border-radius:10px;border:1px solid rgba(42,91,168,0.12);overflow:visible;">
                        <h3 style="color:var(--azul-acento);margin-top:0;">${product.name}</h3>
                        <p style="color:#d6e9ff;">${product.excerpt}</p>
                        <div style="font-weight:800;color:#9fe0ff;font-size:1.4rem;margin:12px 0;">€${product.price.toFixed(2)}</div>
                        <div style="display:flex;gap:8px;flex-direction:column;">
                            <button id="modalTiendaPersonalizar" class="btn-primary">Personalizar y Comprar</button>
                        </div>
                    </div>
                </div>
                <button id="modalTiendaClose" aria-label="Cerrar" style="position:fixed;top:18px;right:18px;background:transparent;border:2px solid rgba(255,255,255,0.12);color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;z-index:1500;">Cerrar</button>
            `;

            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
                document.getElementById('modalTiendaClose').addEventListener('click', ()=> { modal.remove(); document.body.style.overflow = ''; });
                // Cerrar modal al hacer click fuera del panel principal
                modal.addEventListener('click', (e) => { if (e.target === modal) { modal.remove(); document.body.style.overflow = ''; } });

            // Carousel logic (scoped to modal)
            const track = modal.querySelector('.carousel-track');
            const slides = Array.from(track.querySelectorAll('img'));
            let idx = 0;
            const prev = modal.querySelector('#modalTiendaPrev');
            const next = modal.querySelector('#modalTiendaNext');
            const thumbs = modal.querySelector('#modalTiendaThumbs');
            // Visor ampliado: click en el carrusel para abrir a pantalla completa en el índice actual
            try { track.style.cursor = 'zoom-in'; track.addEventListener('click', (e)=>{ e.stopPropagation(); openImageViewer(imgs, idx); }); } catch(e) {}
            function update(){ track.style.transform = `translateX(-${idx * 100}%)`; Array.from(thumbs.children).forEach((t,i)=> t.style.outline = i===idx? '3px solid var(--azul-acento)' : 'none'); }
            prev && prev.addEventListener('click', (e)=>{ e.stopPropagation(); idx = (idx-1+slides.length)%slides.length; update(); });
            next && next.addEventListener('click', (e)=>{ e.stopPropagation(); idx = (idx+1)%slides.length; update(); });
            if (thumbs) thumbs.addEventListener('click', (e)=>{ const t = e.target.closest('img[data-index]'); if (!t) return; idx = parseInt(t.dataset.index,10); update(); });
            update();

            // Autoplay every 5s with robust start/stop (avoid duplicated intervals)
            let autoplayTimer = null;
            function startAutoplay(){ if (autoplayTimer) clearInterval(autoplayTimer); autoplayTimer = setInterval(()=>{ idx = (idx+1)%slides.length; update(); }, 5000); }
            function stopAutoplay(){ if (autoplayTimer) { clearInterval(autoplayTimer); autoplayTimer = null; } }
            startAutoplay();
            const carouselWrap = modal.querySelector('#modalTiendaCarousel');
            [carouselWrap, prev, next, thumbs, modal].forEach(el => { if (!el) return; el.addEventListener('mouseenter', ()=> stopAutoplay()); el.addEventListener('mouseleave', ()=> startAutoplay()); });

            // Reemplazamos el botón de personalizar por un formulario embebido en la columna derecha
            const rightCol = modal.querySelector('div[style*="background:rgba(10,31,61,0.9)"]');
            if (rightCol) {
                rightCol.innerHTML = `
                    <h3 style="color:var(--azul-acento);margin-top:0;">${product.name}</h3>
                    <p style="color:#d6e9ff;">${product.excerpt}</p>
                    <div style="font-weight:800;color:#9fe0ff;font-size:1.4rem;margin:12px 0;">€${product.price.toFixed(2)}</div>
                    <form id="modalTiendaForm" style="display:grid;gap:8px;overflow:visible;">
                        <label style="font-weight:700;color:#dbeeff;">Nombre y número (+2€)
                            <input id="_opt_dorsal_modal" placeholder="Ej: JAMES 6" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;margin-top:6px;" />
                        </label>
                        <label>Talla:
                            <select id="_opt_talla_modal" class="custom-select input-talla">
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="2XL">2XL (+1€)</option>
                                <option value="3XL">3XL (+2€)</option>
                                <option value="4XL">4XL (+2€)</option>
                            </select>
                        </label>
                        <div style="margin:4px 0 0 0;">
                            <button id="_sizeGuideCarousel" type="button" style="background:transparent;color:var(--azul-acento);border:none;padding:0;cursor:pointer;font-family:inherit;font-size:0.95rem;font-weight:600;transition:all 0.2s ease;position:relative;padding-bottom:2px;display:inline-block;transform:translateX(4px);border-bottom:2px solid var(--azul-acento);">Guía de tallas</button>
                        </div>
                        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px;">
                            <button id="modalTiendaAdd" type="button" class="btn-primary">Añadir al carrito</button>
                            <button id="modalTiendaCloseInline" type="button" class="btn-secondary">Cerrar</button>
                        </div>
                    </form>
                `;

                // Inserción dinámica de campos según tipo de producto (NBA/Kids)
                try {
                    const isNBA = /^nba/i.test(product.id) || /\bNBA\b/i.test(product.name);
                    const isKids = /kids/i.test(product.id) || /\((kids|niños)\)/i.test(product.name);
                    const form = rightCol.querySelector('#modalTiendaForm');
                    if (form && !isNBA) {
                        // Insertar Parche (no NBA)
                        if (!rightCol.querySelector('#_opt_parche_select_modal')) {
                            const parcheHTML = `
                        <label style="font-weight:700;color:#dbeeff;">Parche (+1€)
                            <select id="_opt_parche_select_modal" class="custom-select" style="margin-top:6px;">
                                <option value="none">Ninguno</option>
                                <option value="LaLiga">LaLiga</option>
                                <option value="Premier League">Premier League</option>
                                <option value="Ligue 1">Ligue 1</option>
                                <option value="Serie A">Serie A</option>
                                <option value="Bundesliga">Bundesliga</option>
                                <option value="Champions League">Champions League</option>
                                <option value="Europa League">Europa League</option>
                                <option value="Otros">Otros</option>
                            </select>
                        </label>
                        <label id="_opt_parche_otros_wrap_modal" style="display:none;"><input id="_opt_parche_otros_modal" placeholder="Indica el parche" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;" /></label>`;
                            const tallaLabel = rightCol.querySelector('#_opt_talla_modal')?.parentElement;
                            if (tallaLabel) tallaLabel.insertAdjacentHTML('beforebegin', parcheHTML);
                            else form.insertAdjacentHTML('beforeend', parcheHTML);
                        }
                        // Insertar Versión si NO es Kids
                        if (!isKids && !rightCol.querySelector('#_opt_version_modal')) {
                            const versionHTML = `
                        <label>Versión:
                            <select id="_opt_version_modal" class="custom-select">
                                <option value="" disabled selected>Selecciona versión</option>
                                <option value="fan">FAN</option>
                                <option value="jugador">JUGADOR (+5€)</option>
                            </select>
                        </label>`;
                            // Insertar la versión por encima del botón "Guía de tallas" para mejorar la jerarquía visual
                            const sizeGuideRow = form.querySelector('#_sizeGuideCarousel')?.closest('div');
                            if (sizeGuideRow) {
                                sizeGuideRow.insertAdjacentHTML('beforebegin', versionHTML);
                            } else {
                                const buttonsRow = form.querySelector('div[style*="justify-content:flex-end"]');
                                if (buttonsRow) buttonsRow.insertAdjacentHTML('beforebegin', versionHTML);
                                else form.insertAdjacentHTML('beforeend', versionHTML);
                            }
                        }
                        // Reemplazar tallas por numéricas si es Kids (16-28)
                        if (isKids) {
                            const tSel = rightCol.querySelector('#_opt_talla_modal');
                            if (tSel) {
                                tSel.innerHTML = ['16','18','20','22','24','26','28'].map(s=>`<option value="${s}">${s}</option>`).join('');
                            }
                        }
                    } else if (form && isNBA) {
                        // Si es NBA pero es Kids, aún así tallas pueden ser numéricas si el nombre lo indica
                        const isKidsNBA = isKids;
                        const tSel = rightCol.querySelector('#_opt_talla_modal');
                        if (isKidsNBA) {
                            if (tSel) tSel.innerHTML = ['16','18','20','22','24','26','28'].map(s=>`<option value="${s}">${s}</option>`).join('');
                        } else {
                            // Quitar tallas 3XL, 4XL y duplicado XXL en NBA (adulto). Mantener 2XL
                            if (tSel) {
                                ['3XL','4XL'].forEach(val => {
                                    const opt = tSel.querySelector(`option[value="${val}"]`);
                                    if (opt) opt.remove();
                                });
                                if (['3XL','4XL'].includes(tSel.value)) tSel.value = '2XL';
                            }
                        }
                    }
                } catch(e) {}

                // parche otros toggle
                const parcheSelectModal = rightCol.querySelector('#_opt_parche_select_modal');
                const parcheOtrosWrapModal = rightCol.querySelector('#_opt_parche_otros_wrap_modal');
                if (parcheSelectModal) parcheSelectModal.addEventListener('change', function(){ if (this.value === 'Otros') { parcheOtrosWrapModal.style.display = ''; } else { parcheOtrosWrapModal.style.display = 'none'; const inp = rightCol.querySelector('#_opt_parche_otros_modal'); if (inp) inp.value=''; } });

                // Si el producto define versiones y sólo hay una opción, preseleccionarla y ocultar el selector modal
                try {
                    if (product && Array.isArray(product.versions) && product.versions.length === 1) {
                        const verSelModal = rightCol.querySelector('#_opt_version_modal');
                        const verLabelModal = verSelModal ? verSelModal.parentElement : null;
                        if (verSelModal) verSelModal.value = product.versions[0];
                        if (verLabelModal) verLabelModal.style.display = 'none';
                    }
                } catch(e) {}

                // add to cart from modal right column
                rightCol.querySelector('#modalTiendaAdd').addEventListener('click', ()=>{
                    const talla = rightCol.querySelector('#_opt_talla_modal').value;
                    const dorsal = rightCol.querySelector('#_opt_dorsal_modal').value.trim();
                    const isNBA = /^nba/i.test(product.id) || /\bNBA\b/i.test(product.name);

                    let parcheFinal = '';
                    let version = 'none';
                    if (isNBA) {
                        // En NBA el dorsal es obligatorio y no hay parches ni versión
                        if (!dorsal) { alert('Debes introducir un dorsal para camisetas NBA.'); return; }
                    } else {
                        // No NBA: permitir parches y versión
                        const parcheSelectEl = rightCol.querySelector('#_opt_parche_select_modal');
                        if (parcheSelectEl) {
                            const parcheSel = parcheSelectEl.value;
                            if (parcheSel === 'Otros') {
                                const otros = rightCol.querySelector('#_opt_parche_otros_modal').value.trim();
                                if (!otros) { alert('Indica el parche en el campo "Otros".'); rightCol.querySelector('#_opt_parche_otros_modal').focus(); return; }
                                parcheFinal = otros;
                            } else {
                                parcheFinal = (parcheSel === 'none' ? '' : parcheSel);
                            }
                        }
                        const versionEl = rightCol.querySelector('#_opt_version_modal');
                        version = versionEl ? versionEl.value : 'fan';
                        if (versionEl && !version) { alert('Selecciona una versión antes de añadir al carrito.'); return; }
                    }
                    addToCart({ productId: product.id, name: product.name, price: product.price, img: product.img, talla, dorsal, parche: parcheFinal, version });
                    // opción: cerrar modal tras añadir
                    stopAutoplay(); modal.remove(); document.body.style.overflow = '';
                });
                rightCol.querySelector('#modalTiendaCloseInline').addEventListener('click', ()=> { stopAutoplay(); modal.remove(); document.body.style.overflow = ''; });

                const sizeGuideBtn2 = rightCol.querySelector('#_sizeGuideCarousel');
                if (sizeGuideBtn2){
                    sizeGuideBtn2.addEventListener('click', ()=>{
                        const overlay = document.createElement('div');
                        overlay.style.position='fixed'; overlay.style.left=0; overlay.style.top=0; overlay.style.right=0; overlay.style.bottom=0;
                        overlay.style.background='rgba(0,0,0,0.85)'; overlay.style.zIndex=5000; overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center';
                        const isNBA2 = /^nba/i.test(product.id) || /\bNBA\b/i.test(product.name);
                        const guideSrc2 = isNBA2 ? 'assets/images/guias tallas nba.png' : 'assets/images/guia tallas camisetas futbol.png';
                        const guideAlt2 = isNBA2 ? 'Guía de tallas NBA' : 'Guía de tallas Fútbol';
                        overlay.innerHTML = `
                            <div style="position:relative;width:auto;max-width:98vw;max-height:98vh;background:transparent;border-radius:12px;padding:0;box-shadow:0 12px 40px rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;overflow:auto;">
                                <button aria-label=\"Cerrar\" style=\"position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.2);color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;\">Cerrar</button>
                                <img src=\"${guideSrc2}\" alt=\"${guideAlt2}\" style=\"height:80vh;max-height:80vh;max-width:98vw;width:auto;object-fit:contain;border-radius:6px;display:block;\">
                            </div>
                        `;
                        document.body.appendChild(overlay);
                        const panel = overlay.firstElementChild;
                        const closeBtn = panel.querySelector('button');
                        const close = ()=> overlay.remove();
                        closeBtn.addEventListener('click', (e)=>{ e.stopPropagation(); close(); });
                        overlay.addEventListener('click', (e)=>{ if (e.target === overlay) close(); });
                    });
                }
            }
        }

        function openImageViewer(images, startIndex) {
            if (!Array.isArray(images) || images.length === 0) return;
            let idx = Math.max(0, Math.min(startIndex || 0, images.length - 1));

            const overlay = document.createElement('div');
            overlay.id = 'image-viewer-overlay';
            overlay.style.position = 'fixed';
            overlay.style.left = 0; overlay.style.top = 0; overlay.style.right = 0; overlay.style.bottom = 0;
            overlay.style.background = 'rgba(0,0,0,0.88)';
            overlay.style.zIndex = 6000;
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';

            overlay.innerHTML = `
                <div id="iv-panel" style="position:relative;width:92vw;max-width:1200px;height:86vh;max-height:900px;display:flex;align-items:center;justify-content:center;overflow:hidden;border-radius:12px;background:rgba(0,0,0,0.1);border:1px solid rgba(255,255,255,0.12);">
                    <img id="iv-img" src="${images[idx]}" alt="Imagen ${idx+1}" style="max-width:100%;max-height:100%;object-fit:contain;will-change:transform;touch-action:none;user-select:none;cursor:zoom-in;" />
                    <button id="iv-prev" aria-label="Anterior" style="position:absolute;left:12px;top:50%;transform:translateY(-50%);z-index:2;background:rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.2);color:#fff;padding:10px 12px;border-radius:10px;cursor:pointer;font-size:20px;">‹</button>
                    <button id="iv-next" aria-label="Siguiente" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);z-index:2;background:rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.2);color:#fff;padding:10px 12px;border-radius:10px;cursor:pointer;font-size:20px;">›</button>
                    <div id="iv-controls" style="position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:8px;background:rgba(0,0,0,0.45);padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.15);align-items:center;">
                        <button id="iv-toggle" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;">Alternar zoom</button>
                        <button id="iv-reset" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;">Restablecer</button>
                        <span id="iv-index" style="color:#fff;opacity:.8;font-size:.9rem;">${idx+1}/${images.length}</span>
                    </div>
                    <button id="iv-close" aria-label="Cerrar" style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.2);color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;">✕ Cerrar</button>
                </div>
            `;

            document.body.appendChild(overlay);

            // Bloquear scroll de fondo mientras el visor está abierto
            const __prevScrollY = window.scrollY;
            const __prevOverflow = document.body.style.overflow;
            const __prevPosition = document.body.style.position;
            const __prevTop = document.body.style.top;
            const __prevWidth = document.body.style.width;
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.top = `-${__prevScrollY}px`;
            document.body.style.width = '100%';

            const panel = overlay.querySelector('#iv-panel');
            const img = overlay.querySelector('#iv-img');
            const btnPrev = overlay.querySelector('#iv-prev');
            const btnNext = overlay.querySelector('#iv-next');
            const btnClose = overlay.querySelector('#iv-close');
            const btnToggle = overlay.querySelector('#iv-toggle');
            const btnReset = overlay.querySelector('#iv-reset');
            const idxLabel = overlay.querySelector('#iv-index');

            let scale = 1, tx = 0, ty = 0;
            const minScale = 1, maxScale = 5;
            let isPanning = false, startX = 0, startY = 0, lastX = 0, lastY = 0;
            let lastTapTime = 0;
            let pinchStartDist = 0, pinchStartScale = 1;
            let panMovedMouse = false, movedDuringPanTouch = false;

            function applyTransform(){ img.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`; }
            function resetTransform(){
                scale = 1; tx = 0; ty = 0;
                isPanning = false;
                panMovedMouse = false;
                movedDuringPanTouch = false;
                lastPanEnd = 0;
                lastTapTime = 0;
                img.style.cursor = 'zoom-in';
                applyTransform();
            }
            function updateIndex(){ if (idxLabel) idxLabel.textContent = `${idx+1}/${images.length}`; }
            function showImage(newIdx){ idx = (newIdx + images.length) % images.length; img.src = images[idx]; resetTransform(); updateIndex(); }

            // Navegación
            btnPrev.addEventListener('click', (e)=>{ e.stopPropagation(); showImage(idx - 1); });
            btnNext.addEventListener('click', (e)=>{ e.stopPropagation(); showImage(idx + 1); });

            // Cerrar
            function close(){
                document.removeEventListener('keydown', onKey);
                overlay.remove();
                // Restaurar scroll de fondo
                document.body.style.overflow = __prevOverflow;
                document.body.style.position = __prevPosition;
                document.body.style.top = __prevTop;
                document.body.style.width = __prevWidth;
                window.scrollTo(0, __prevScrollY);
            }
            btnClose.addEventListener('click', (e)=>{ e.stopPropagation(); close(); });
            // Evitar cierre accidental al hacer pan: sólo cerrar si no hubo pan reciente
            let lastPanEnd = 0;
            overlay.addEventListener('click', (e)=>{ if (e.target === overlay && Date.now() - lastPanEnd > 200) close(); });
            function onKey(e){ if (e.key === 'Escape') close(); else if (e.key === 'ArrowLeft') showImage(idx-1); else if (e.key === 'ArrowRight') showImage(idx+1); }
            document.addEventListener('keydown', onKey);

            // Alternar zoom con botón
            btnToggle.addEventListener('click', (e)=>{ e.stopPropagation(); if (scale === 1) { scale = 2; img.style.cursor = 'grab'; } else { resetTransform(); } applyTransform(); });
            btnReset.addEventListener('click', (e)=>{ e.stopPropagation(); resetTransform(); });

            // Rueda para zoom (desktop)
            panel.addEventListener('wheel', (e)=>{
                e.preventDefault();
                const delta = -e.deltaY; // up -> zoom in
                const factor = Math.exp(delta * 0.0015);
                const newScale = Math.min(maxScale, Math.max(minScale, scale * factor));
                if (newScale !== scale) {
                    scale = newScale;
                    img.style.cursor = scale > 1 ? 'grab' : 'zoom-in';
                    applyTransform();
                }
            }, { passive: false });

            // Pan con mouse
            img.addEventListener('mousedown', (e)=>{
                if (scale <= 1) return;
                isPanning = true;
                img.style.cursor = 'grabbing';
                startX = e.clientX; startY = e.clientY; lastX = tx; lastY = ty;
                panMovedMouse = false;
                e.preventDefault();
            });
            window.addEventListener('mousemove', (e)=>{
                if (!isPanning) return;
                tx = lastX + (e.clientX - startX);
                ty = lastY + (e.clientY - startY);
                if (!panMovedMouse) {
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    if (Math.hypot(dx, dy) > 3) panMovedMouse = true;
                }
                applyTransform();
            });
            window.addEventListener('mouseup', ()=>{ if (isPanning) { isPanning = false; img.style.cursor = 'grab'; lastPanEnd = Date.now(); } });

            // Click simple para alternar zoom
            img.addEventListener('click', (e)=>{
                if (Date.now() - lastPanEnd < 250 || panMovedMouse) { e.stopPropagation(); e.preventDefault(); return; }
                e.preventDefault();
                if (scale === 1) { scale = 2; img.style.cursor = 'grab'; } else { resetTransform(); }
                applyTransform();
            });

            // Doble click para alternar zoom (se mantiene)
            img.addEventListener('dblclick', (e)=>{
                if (Date.now() - lastPanEnd < 250 || panMovedMouse) { e.stopPropagation(); e.preventDefault(); return; }
                e.preventDefault();
                if (scale === 1) { scale = 2; img.style.cursor = 'grab'; } else { resetTransform(); }
                applyTransform();
            });

            // Toque: doble tap y pan, pinch to zoom y swipe para cambiar imagen
            let swipeStartX = 0, swipeStartY = 0, swipeActive = false;
            panel.addEventListener('touchstart', (e)=>{
                if (e.touches.length === 2) {
                    const dx = e.touches[0].clientX - e.touches[1].clientX;
                    const dy = e.touches[0].clientY - e.touches[1].clientY;
                    pinchStartDist = Math.hypot(dx, dy);
                    pinchStartScale = scale;
                    swipeActive = false;
                } else if (e.touches.length === 1) {
                    swipeStartX = e.touches[0].clientX; swipeStartY = e.touches[0].clientY;
                    if (scale > 1) {
                        isPanning = true;
                        startX = swipeStartX; startY = swipeStartY; lastX = tx; lastY = ty;
                        movedDuringPanTouch = false;
                        swipeActive = false;
                    } else {
                        // sin zoom: activar swipe
                        swipeActive = true;
                    }
                }
            }, { passive: false });
            panel.addEventListener('touchmove', (e)=>{
                if (e.touches.length === 2) {
                    e.preventDefault();
                    const dx = e.touches[0].clientX - e.touches[1].clientX;
                    const dy = e.touches[0].clientY - e.touches[1].clientY;
                    const dist = Math.hypot(dx, dy);
                    const newScale = Math.min(maxScale, Math.max(minScale, (dist / pinchStartDist) * pinchStartScale));
                    if (newScale !== scale) { scale = newScale; img.style.cursor = scale > 1 ? 'grab' : 'zoom-in'; applyTransform(); }
                } else if (e.touches.length === 1) {
                    if (isPanning) {
                        e.preventDefault();
                        const curX = e.touches[0].clientX;
                        const curY = e.touches[0].clientY;
                        tx = lastX + (curX - startX);
                        ty = lastY + (curY - startY);
                        if (!movedDuringPanTouch) {
                            const dx = curX - startX; const dy = curY - startY;
                            if (Math.hypot(dx, dy) > 3) movedDuringPanTouch = true;
                        }
                        applyTransform();
                    } else if (swipeActive) {
                        const dxSwipe = e.touches[0].clientX - swipeStartX;
                        const dySwipe = e.touches[0].clientY - swipeStartY;
                        // iniciar navegación si gesto horizontal predominante
                        if (Math.abs(dxSwipe) > 24 && Math.abs(dxSwipe) > Math.abs(dySwipe)) {
                            e.preventDefault();
                            swipeActive = false;
                            if (dxSwipe < 0) showImage(idx + 1); else showImage(idx - 1);
                        }
                    }
                }
            }, { passive: false });
            panel.addEventListener('touchend', (e)=>{
                if (e.touches.length === 0) {
                    const wasPanning = isPanning;
                    if (isPanning) { isPanning = false; lastPanEnd = Date.now(); }
                    // Si hubo desplazamiento durante el pan, no tratar como tap
                    if (movedDuringPanTouch) { movedDuringPanTouch = false; return; }
                    const now = Date.now();
                    if (!wasPanning && (now - lastTapTime < 300)) { // doble tap
                        if (scale === 1) { scale = 2; img.style.cursor = 'grab'; } else { resetTransform(); }
                        applyTransform();
                        lastTapTime = 0;
                    } else {
                        lastTapTime = now;
                    }
                }
            });
        }

        function addToCart(item){
            // compute extra costs
            let extra = 0;
            if (item.parche) extra += EXTRAS.parche;
            if (item.dorsal) extra += EXTRAS.dorsal;
            // apply version surcharge only when version === 'jugador'
            if (item.version === 'jugador') extra += EXTRAS.versionJugador;
            else if (item.talla === '3XL') extra += 2;
            else if (item.talla === '4XL') extra += 2;
            const total = (item.price + extra);
            const cartItem = { id: Date.now().toString(36), productId: item.productId, name: item.name, img: item.img, price: item.price, extra, talla: item.talla, dorsal: item.dorsal, parche: item.parche, version: item.version, total };
            CART.push(cartItem);
            renderCart();
            try {
                const totalTxt = byId('cartTotal') ? byId('cartTotal').textContent : '';
                const totalNum = parseFloat(totalTxt);
                if (!isNaN(totalNum) && typeof window.showCartTotalToast === 'function') {
                    window.showCartTotalToast(totalNum);
                }
                // Notificación interna de pestaña carrito deshabilitada
            } catch (e) {}
        }

        function renderCart(){
            const list = byId('cartItems');
                list.innerHTML = '';
            let subtotal = 0;
            // Agrupar items iguales (por productId + talla + version + dorsal + parche) para manejar cantidades sin perder personalizaciones
            const grouped = {};
            CART.forEach(ci => {
                subtotal += ci.total;
                const key = `${ci.productId}::${ci.talla}::${ci.version || 'none'}::${ci.dorsal || 'none'}::${ci.parche || 'none'}`;
                if (!grouped[key]) grouped[key] = { ...ci, cantidad: 0 };
                grouped[key].cantidad += 1;
                // recalcular subtotal por agrupado si queremos mostrar precio por unidad
            });
            Object.keys(grouped).forEach(key => {
                const ci = grouped[key];
                const row = document.createElement('div'); row.className = 'cart-item';
                const parcheLabel = ci.parche ? `<small>Parche: ${ci.parche}</small>` : '';
                row.innerHTML = `
                    <img src="${ci.img}" alt="${ci.name}">
                    <div class="meta"><b>${ci.name}</b><small>${ci.talla} ${ci.dorsal? '· ' + ci.dorsal : ''} ${ci.version !== 'none' ? '· ' + ci.version : ''}</small>${parcheLabel}<small>Extras: €${ci.extra.toFixed(2)}</small></div>
                    <div style="text-align:right">
                        <div style="font-weight:700">€${(ci.total * ci.cantidad).toFixed(2)}</div>
                        <div style="margin-top:10px;display:flex;gap:8px;align-items:center;justify-content:flex-end;">
                            <button class="decrease" data-key="${key}" aria-label="Disminuir" style="width:32px;height:32px;border-radius:8px;background:linear-gradient(180deg, var(--azul-acento) 0%, #1a3b6d 100%);color:#fff;border:1px solid rgba(255,255,255,0.12);box-shadow:0 2px 8px rgba(0,0,0,0.15);font-size:18px;font-weight:bold;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;">−</button>
                            <input class="cart-qty-input" data-key="${key}" value="${ci.cantidad}" style="width:48px;height:32px;text-align:center;border-radius:8px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.08);color:#fff;font-weight:600;" />
                            <button class="increase" data-key="${key}" aria-label="Aumentar" style="width:32px;height:32px;border-radius:8px;background:linear-gradient(180deg, var(--azul-acento) 0%, #1a3b6d 100%);color:#fff;border:1px solid rgba(255,255,255,0.12);box-shadow:0 2px 8px rgba(0,0,0,0.15);font-size:18px;font-weight:bold;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;">+</button>
                            <button class="remove" data-key="${key}" style="margin-left:8px;height:32px;padding:0 12px;border-radius:8px;background:rgba(255,50,50,0.2);color:#ff5050;border:1px solid rgba(255,80,80,0.3);font-weight:600;transition:all 0.2s ease;">Eliminar</button>
                        </div>
                    </div>
                `;
                list.appendChild(row);
            });
            // actualizar contador visual
            const countEl = byId('cartCount');
            if (countEl) countEl.textContent = CART.length.toString();
            // actualizar badge permanente del botón Carrito (cantidad total)
            (function(){
                const cartBtn = document.querySelector('.boton-seccion[data-seccion="carrito"]');
                if (!cartBtn) return;
                let badge = cartBtn.querySelector('.cart-tab-badge');
                if (!badge) {
                    badge = document.createElement('span');
                    badge.className = 'cart-tab-badge';
                    cartBtn.appendChild(badge);
                }
                const totalQty = Array.isArray(CART) ? CART.length : 0;
                if (totalQty > 0) {
                    badge.textContent = String(totalQty);
                    badge.classList.remove('hidden');
                } else {
                    badge.textContent = '0';
                    badge.classList.add('hidden');
                }
            })();
            // si no hay items mostrar mensaje de vacío
            if (CART.length === 0) {
                list.innerHTML = '<div class="cart-empty">Tu carrito está vacío<br><small>Agrega productos para empezar</small></div>';
            }
            // Detectar camisetas en el carrito para aplicar ofertas por cantidad
            function isShirt(ci){
                if (!ci || !ci.name) return false;
                const n = ci.name.toLowerCase();
                return ci.productId === 'barca1' || n.indexOf('camiseta') !== -1 || n.indexOf('camisetas') !== -1;
            }

            const shirtItems = CART.filter(isShirt);
            const nonShirtItems = CART.filter(ci => !isShirt(ci));

            // Sumas base y extras de camisetas
            const shirtCount = shirtItems.length;
            const shirtExtrasSum = shirtItems.reduce((s, it) => s + (it.extra || 0), 0);
            const shirtBaseSum = shirtItems.reduce((s, it) => s + (it.price || 0), 0);

            // precio base usado en las ofertas (pack 1) - por defecto 19.90
            const baseOffer = (OFFERS && OFFERS.find(o=>o.size===1) && OFFERS.find(o=>o.size===1).price) ? OFFERS.find(o=>o.size===1).price : 19.90;
            const shirtPriceSurplus = shirtItems.reduce((s,it) => s + Math.max(0, (it.price || 0) - baseOffer), 0);

            // use global computeBestOfferForCount

            // calcular totals no afectados por oferta
            const nonShirtTotal = nonShirtItems.reduce((s,it)=> s + (it.total || 0), 0);

            // original totals (antes de ofertas) - comportamiento previo usaba SHIPPING global si carrito no vacío
            const originalTotal = (subtotal + (CART.length>0? SHIPPING : 0));

            let appliedOffer = null;
            let newSubtotal = subtotal;
            let newShipping = (CART.length>0? SHIPPING : 0);

            if (shirtCount > 0){
                const best = computeBestOfferForCount(shirtCount);
                // best.total es precio de bases de packs; añadimos extras de camisetas
                const shirtsOfferCost = best.total + shirtExtrasSum + shirtPriceSurplus;
                // Si hay más de 1 camiseta aplicamos envío gratis global
                const shirtsOfferShipping = (shirtCount > 1) ? 0 : best.shipping;
                // nuevo subtotal = nonShirtTotal + shirtsOfferCost
                newSubtotal = nonShirtTotal + shirtsOfferCost;
                // Si hay más de 1 camiseta, envío gratis global; si no, sumar shipping para nonShirtItems si existen
                newShipping = (shirtCount > 1) ? 0 : (shirtsOfferShipping + (nonShirtItems.length>0 ? SHIPPING : 0));
                appliedOffer = { count: shirtCount, detail: best, shirtsOfferCost, shirtsOfferShipping };
            }

            const total = (CART.length>0) ? (newSubtotal + newShipping) : 0;

            byId('cartSubtotal').textContent = newSubtotal.toFixed(2) + '€';
            byId('cartShipping').textContent = newShipping.toFixed(2) + '€';
            byId('cartTotal').textContent = total.toFixed(2) + '€';

            // Si hay una oferta aplicada, mostrar summary del ahorro justo encima de totales
            const totalsContainer = document.querySelector('.cart-totals');
            if (totalsContainer){
                // remove previous offer note if any
                const prev = totalsContainer.querySelector('.offer-summary'); if (prev) prev.remove();
                    if (appliedOffer){
                        // Prefer centralized computed savings when available
                        let savings = 0;
                        try { const computed = computeCartTotals(); if (computed && computed.savings !== undefined) savings = Number(computed.savings); else savings = (originalTotal - total); } catch(e){ savings = (originalTotal - total); }
                        // UI rule: display the computed 'savings' value directly
                        const displayedSavings = Number(savings);
                    const box = document.createElement('div');
                    box.className = 'offer-summary';
                    box.style.margin = '10px 0';
                    box.style.padding = '8px';
                    box.style.borderRadius = '8px';
                    box.style.background = 'linear-gradient(90deg, rgba(255,250,230,0.04), rgba(180,220,255,0.02))';
                    box.innerHTML = `
                        <div style="font-weight:800;color:#ffd966">Oferta aplicada: ${appliedOffer.count} camisetas</div>
                        <div style="color:#cfe7ff;font-size:0.95rem">Ahorro estimado: <strong>€${displayedSavings.toFixed(2)}</strong></div>
                        <div style="color:#bcd9ff;font-size:0.9rem">Detalle: ${Object.keys(appliedOffer.detail.combo).map(sz => `${appliedOffer.detail.combo[sz]}×${sz}`).join(' + ')}</div>
                    `;
                    totalsContainer.insertBefore(box, totalsContainer.firstChild);
                }
            }

            // attach remove (remove whole grouped item regardless of quantity)
            list.querySelectorAll('.remove').forEach(btn => btn.addEventListener('click', ()=>{
                const key = btn.dataset.key;
                if (!key) return;
                const [productId, talla, version, dorsal, parche] = key.split('::');
                CART = CART.filter(i => !(i.productId === productId && i.talla === talla && (i.version || 'none') === version && (i.dorsal || 'none') === dorsal && (i.parche || 'none') === parche));
                renderCart();
            }));
            list.querySelectorAll('.increase').forEach(btn => btn.addEventListener('click', ()=>{
                const key = btn.dataset.key;
                // añadir una unidad igual a la agrupación (clonar primer ítem de esa agrupación)
                const [productId, talla, version, dorsal, parche] = key.split('::');
                const item = CART.find(i=> i.productId === productId && i.talla === talla && (i.version || 'none') === version && (i.dorsal || 'none') === dorsal && (i.parche || 'none') === parche);
                if (item) CART.push(Object.assign({}, item, { id: Date.now().toString(36) }));
                renderCart();
            }));
            list.querySelectorAll('.decrease').forEach(btn => btn.addEventListener('click', ()=>{
                const key = btn.dataset.key;
                const [productId, talla, version, dorsal, parche] = key.split('::');
                // encontrar una instancia y eliminarla (la última)
                for (let i = CART.length-1; i>=0; i--) {
                    const it = CART[i];
                    if (it.productId === productId && it.talla === talla && (it.version || 'none') === version && (it.dorsal || 'none') === dorsal && (it.parche || 'none') === parche) { CART.splice(i,1); break; }
                }
                renderCart();
            }));
            list.querySelectorAll('.cart-qty-input').forEach(inp => inp.addEventListener('change', ()=>{
                const key = inp.dataset.key;
                const v = Math.max(1, parseInt(inp.value) || 1);
                const [productId, talla, version, dorsal, parche] = key.split('::');
                // contar actuales
                const current = CART.filter(i=> i.productId === productId && i.talla === talla && (i.version || 'none') === version && (i.dorsal || 'none') === dorsal && (i.parche || 'none') === parche).length;
                if (v > current) {
                    const item = CART.find(i=> i.productId === productId && i.talla === talla && (i.version || 'none') === version && (i.dorsal || 'none') === dorsal && (i.parche || 'none') === parche);
                    for (let k=0;k < v-current; k++) { if (item) CART.push(Object.assign({}, item, { id: Date.now().toString(36) })); }
                } else if (v < current) {
                    let toRemove = current - v;
                    for (let i = CART.length-1; i>=0 && toRemove>0; i--) {
                        const it = CART[i];
                        if (it.productId === productId && it.talla === talla && (it.version || 'none') === version && (it.dorsal || 'none') === dorsal && (it.parche || 'none') === parche) { CART.splice(i,1); toRemove--; }
                    }
                }
                renderCart();
            }));
            // actualizar banner promocional tras renderizar carrito
            try { updateCartPromoBanner(); } catch(e) {}
            // actualizar recomendaciones junto al carrito
            try { if (typeof updateRecommendations === 'function') updateRecommendations(); } catch(e) {}
        }

        function clearCart(){ CART = []; renderCart(); }

        // Improve UX: after clearing the cart, reposition the fixed cart to avoid visual jump
        const _origClearCart = clearCart;
        function clearCart(){ CART = []; renderCart();
            // small debounce reposition
            try { setTimeout(() => { const evt = new Event('resize'); window.dispatchEvent(evt); }, 80); } catch(e){}
        }

        // Nuevo flujo: abrir modal de checkout para recopilar correo PayPal, @Instagram y dirección
        function openCheckout(){
            const total = parseFloat(byId('cartTotal').textContent);
            if (!total || total <= 0) { alert('Tu carrito está vacío. Añade algún producto antes de proceder al checkout.'); return; }
            // Evitar duplicados
            if (document.getElementById('checkoutModal')) return;
            const modal = document.createElement('div');
            modal.id = 'checkoutModal';
            modal.style.position = 'fixed'; modal.style.left = 0; modal.style.top = 0; modal.style.right = 0; modal.style.bottom = 0; modal.style.display = 'flex'; modal.style.alignItems = 'center'; modal.style.justifyContent = 'center'; modal.style.background = 'rgba(2,6,23,0.78)'; modal.style.zIndex = 2000;
            modal.innerHTML = `
                <div style="width:92%;max-width:760px;background:#071735;padding:16px;border-radius:10px;color:#dbeeff;">
                    <h3 style="margin-top:0;color:var(--azul-acento);">Resumen de pedido y datos de envío</h3>
                    <div style="margin-bottom:10px;color:#cfe7ff">Total a pagar: <strong>€${total.toFixed(2)}</strong></div>
                    <div id="checkoutSummary" style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;margin-bottom:12px;max-height:200px;overflow:auto;"></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:8px;">
                        <input id="checkoutContactName" class="checkout-input" placeholder="Contact Name:" />
                        <input id="checkoutAddressLine" class="checkout-input" placeholder="Address Line:" />
                        <input id="checkoutCity" class="checkout-input" placeholder="City:" />
                        <input id="checkoutState" class="checkout-input" placeholder="State:" />
                        <input id="checkoutCountry" class="checkout-input" placeholder="Country:" />
                        <input id="checkoutPostal" class="checkout-input" placeholder="Postal Code:" />
                        <input id="checkoutPhone" class="checkout-input" placeholder="Phone Number:" />
                        <input id="checkoutPaypalEmail" class="checkout-input" placeholder="PayPal Email:" />
                        <input id="checkoutInstagram" class="checkout-input" placeholder="@Instagram" />
                    </div>
                    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px;">
                                <button id="checkoutCancel" class="btn-secondary">Cancelar</button>
                                <button id="checkoutConfirm" class="btn-primary">Pagar con PayPal</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // render summary (itemized)
            const summary = modal.querySelector('#checkoutSummary');
            function renderSummary(){
                console.log('renderSummary: CART length =', CART.length);
                summary.innerHTML = '';
                let subtotal = 0;
                CART.forEach(ci => {
                    subtotal += ci.total;
                    const item = document.createElement('div');
                    item.style.padding = '8px 0';
                    const parche = ci.parche ? `<div style="color:#bcd9ff;font-size:0.95rem">Parche: ${ci.parche} (+€${(ci.parche? EXTRAS.parche:0).toFixed(2)})</div>` : '';
                    const dorsal = ci.dorsal ? `<div style="color:#bcd9ff;font-size:0.95rem">Dorsal: ${ci.dorsal} (+€${(ci.dorsal? EXTRAS.dorsal:0).toFixed(2)})</div>` : '';
                    const version = (ci.version && ci.version !== 'none') ? (ci.version === 'jugador' ? `<div style="color:#bcd9ff;font-size:0.95rem">Versión: ${ci.version} (+€${EXTRAS.versionJugador.toFixed(2)})</div>` : `<div style=\"color:#bcd9ff;font-size:0.95rem\">Versión: ${ci.version}</div>`) : '';
                    item.innerHTML = `
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;">
                            <div style="flex:1">
                                <strong>${ci.name}</strong>
                                <div style="color:#d6e9ff;font-size:0.95rem">Talla: ${ci.talla} ${ci.version && ci.version !== 'none' ? '· ' + ci.version : ''}</div>
                                ${parche}${dorsal}${version}
                                <div style="color:#bcd9ff;font-size:0.9rem">Extras: €${ci.extra.toFixed(2)}</div>
                            </div>
                            <div style="text-align:right"><div style="font-weight:800">€${ci.total.toFixed(2)}</div></div>
                        </div>
                    `;
                    summary.appendChild(item);
                });

                // Totals block usando la lógica de ofertas por cantidad
                const totals = document.createElement('div');
                totals.style.marginTop = '10px';
                const computed = computeCartTotals();
                // Display the computed.savings in the UI
                const displayedSavingsModal = computed.savings ? Number(computed.savings) : 0;
                totals.innerHTML = `
                        <div style="display:flex;justify-content:space-between;color:#cfe7ff"><div>Subtotal</div><div>€${computed.subtotal.toFixed(2)}</div></div>
                        <div style="display:flex;justify-content:space-between;color:#cfe7ff"><div>Gastos envío</div><div>€${computed.shipping.toFixed(2)}</div></div>
                        ${displayedSavingsModal>0? `<div style="display:flex;justify-content:space-between;color:#ffd966;font-weight:800"><div>Ahorro total</div><div>€${displayedSavingsModal.toFixed(2)}</div></div>`: ''}
                        <div style="display:flex;justify-content:space-between;font-weight:800;margin-top:6px"><div>Total</div><div>€${computed.total.toFixed(2)}</div></div>
                        <div style="margin-top:8px;color:#9aaed9;font-size:0.9rem">ENVIO EXPRESS 5-15 DIAS</div>
                    `;
                summary.appendChild(totals);
            }
            renderSummary();

            modal.querySelector('#checkoutCancel').addEventListener('click', ()=> { modal.remove(); document.body.style.overflow = ''; });

            modal.querySelector('#checkoutConfirm').addEventListener('click', ()=>{
                const name = modal.querySelector('#checkoutContactName').value.trim();
                const address = modal.querySelector('#checkoutAddressLine').value.trim();
                const city = modal.querySelector('#checkoutCity').value.trim();
                const state = modal.querySelector('#checkoutState').value.trim();
                const country = modal.querySelector('#checkoutCountry').value.trim();
                const postal = modal.querySelector('#checkoutPostal').value.trim();
                const phone = modal.querySelector('#checkoutPhone').value.trim();
                const paypalEmail = modal.querySelector('#checkoutPaypalEmail').value.trim();
                const instagram = modal.querySelector('#checkoutInstagram').value.trim();

                if (!name || !address || !city || !country || !postal || !phone) {
                    alert('Por favor, completa todos los campos de dirección.');
                    return;
                }
                if (!paypalEmail || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(paypalEmail)) { alert('Introduce un correo PayPal válido.'); return; }
                if (!instagram || !/^@/.test(instagram)) { alert('Introduce tu usuario de Instagram, debe empezar por @'); return; }

                const checkoutData = { name, address, city, state, country, postal, phone, paypalEmail, instagram };

                // Recompute totals using centralized logic (incluye ofertas y recargos)
                const computed = computeCartTotals();
                const total = Number(computed.total || 0);

                console.log('Checkout data:', checkoutData, 'total:', total);

                if (typeof window.abrirPayPal === 'function') {
                    // pasar el total formateado con 2 decimales para el enlace PayPal
                    // Nota: la detección de cierre y la limpieza del carrito están centralizadas en `abrirPayPal`
                    window.abrirPayPal(total.toFixed(2));
                } else {
                    alert('Función de pago no disponible.');
                }
            });
        }

        // eventos globales
            document.addEventListener('click', (e)=>{
            // Accept clicks on either a button[data-action] or any element with [data-action]
            const targetWithAction = e.target.closest('[data-action]');
            if (!targetWithAction) return;
            // If the click originated from an interactive control inside the card (like a form input), ignore it
            if (e.target.matches('input,textarea,select,button') && !e.target.closest('.product-item')) {
                return;
            }
            const id = targetWithAction.dataset.id;
            const action = targetWithAction.dataset.action;
            const product = PRODUCTS.find(p=>p.id===id);
            if (!product) return;
            if (action === 'details') {
                // open carousel modal for products with images, otherwise product modal
                if (product.images && product.images.length) openTiendaCarouselModal(product);
                else openProductModal(product);
            }
            if (action === 'add') {
                if (product.images && product.images.length) openTiendaCarouselModal(product);
                else openProductModal(product);
            }
        });

    // solo adjuntar listeners si los botones existen (por seguridad)
    if (byId('gotoCheckoutBtn')) byId('gotoCheckoutBtn').addEventListener('click', openCheckout);
        if (byId('clearCartGallery')) byId('clearCartGallery').addEventListener('click', clearCart);

        // Renderizar UI solo si existe el contenedor (sección pedidos)
        if (byId('productGallery') && byId('cartItems')) {
            // render with a prominent search control inside the gallery header
            const galleryWrap = document.getElementById('productGallery');
            const galleryHeaderEl = document.querySelector('.gallery-header') || galleryWrap.parentElement;
            if (!document.getElementById('productSearch')) {
                const wrap = document.createElement('div');
                wrap.className = 'product-search-wrap';
                wrap.style.display = 'flex';
                wrap.style.justifyContent = 'space-between';
                wrap.style.alignItems = 'center';
                wrap.style.margin = '0 0 12px 0';
                wrap.style.width = '100%';
                wrap.style.boxSizing = 'border-box';
                wrap.innerHTML = `
                    <div style="display:flex;align-items:center;gap:10px;width:100%;">
                            <div style="background:linear-gradient(90deg, rgba(5,25,55,0.6), rgba(10,31,61,0.6));padding:8px 12px;border-radius:12px;display:flex;align-items:center;gap:10px;width:100%;box-shadow:0 8px 30px rgba(10,31,61,0.25);border:1px solid rgba(255,255,255,0.04);">
                            <i class="fas fa-search" style="color:#9fe0ff;font-size:1.05rem;"></i>
                            <input id="productSearch" placeholder="Buscar camiseta por nombre..." style="flex:1;padding:12px 8px;border-radius:8px;border:none;background:transparent;color:#fff;font-size:1.05rem;outline:none;" />
                            <button id="productSearchClear" title="Limpiar" style="background:transparent;border:none;color:#bcd9ff;cursor:pointer;font-weight:700;padding:6px 8px;border-radius:8px;">Limpiar</button>
                        </div>
                    </div>
                `;
                galleryHeaderEl.appendChild(wrap);

                const input = document.getElementById('productSearch');
                const clearBtn = document.getElementById('productSearchClear');
                if (input) input.addEventListener('input', debounce(function(e){ renderGallery(e.target.value.trim()); }, 180));
                if (clearBtn) clearBtn.addEventListener('click', function(){ if (input) { input.value = ''; renderGallery(''); input.focus(); } });
            }
            renderGallery(); renderCart();
            if (window.updateCartTabBadge) window.updateCartTabBadge();
            try { updateRecommendations(); } catch(e) {}
        }
    </script>
</section>
<section id="reco-helpers" style="display:none">
    <script>
        // recomendaciones simples a partir de PRODUCTS
        function updateRecommendations(){
            const scroller = document.getElementById('recoScroller');
            if (!scroller) return;
            scroller.innerHTML = '';
            const inCartIds = new Set(CART.map(ci => ci.productId));
            const recos = (Array.isArray(PRODUCTS) ? PRODUCTS : []).filter(p => !inCartIds.has(p.id)).slice(0, 12);
            if (!recos.length) {
                const hint = document.createElement('div');
                hint.className = 'reco-empty';
                hint.style.color = '#bcd9ff';
                hint.style.padding = '8px 0';
                hint.textContent = 'Añade productos al carrito para ver recomendaciones personalizadas';
                scroller.appendChild(hint);
                return;
            }
            recos.forEach(p => {
                const card = document.createElement('div');
                card.className = 'reco-card';
                // Hacer la tarjeta completa clickeable como en Tienda
                card.setAttribute('data-id', p.id);
                card.setAttribute('data-action', 'add');
                const imgSrc = Array.isArray(p.images) && p.images.length ? p.images[0] : p.img || '';
                const price = (typeof p.price === 'number') ? `€${p.price.toFixed(2)}` : '';
                card.innerHTML = `
                    <img src="${imgSrc}" alt="${p.name}" loading="lazy" />
                    <div class="reco-meta">
                        <div class="reco-name">${p.name}</div>
                        <div class="reco-price">${price}</div>
                    </div>
                    <!-- botones eliminados: la tarjeta completa es clickeable -->
                `;
                scroller.appendChild(card);
            });
            // Usamos el delegado global de clics ([data-action]) igual que en Tienda
            scroller.onclick = null;
        }
    </script>
</section>
<footer>
    <div class="redes_sociales">
        <a href="https://www.instagram.com/camisetazo._/"><i class="fab fa-instagram"></i></a>
        <a href="https://www.tiktok.com/@camisetazo"><i class="fab fa-tiktok"></i></a>
    </div>
    <p style="margin-top: 2rem; opacity: 0.8; font-size: 0.9rem;">
        © 2025 Camisetazo. Todos los derechos reservados
    </p>
</footer>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {

        const PRECIOS_BASE = {
          1: 25.00,
          2: 24.00,
          3: 23.00,
          4: 22.00,
          5: 21.00,
          6: 20.00,
          7: 19.00,
          8: 18.00,
          9: 17.00,
          10: 16.00,
          11: 15.50,
          12: 15.00,
          13: 14.50,
          14: 14.00,
          15: 13.50,
          16: 13.00,
          17: 12.50,
          18: 12.00,
          19: 11.50,
          20: 11.00
        };
        const EXTRAS = {
          parche: 3.00,
          dorsal: 4.00,
          versionJugador: 5.00
        };
        const GASTOS_ENVIO = 5.00;
        // Simplified: all section buttons behave the same. No automatic scrolling or
        // special handling for the 'pedidos' tab — just toggle the active class and
        // refresh cart positioning.

        document.querySelectorAll('.boton-seccion').forEach(boton => {
            boton.addEventListener('click', function() {
                document.querySelectorAll('.boton-seccion').forEach(b => b.classList.remove('activo'));
                document.querySelectorAll('.seccion').forEach(s => s.classList.remove('activa'));
                const seccionId = this.dataset.seccion;
                this.classList.add('activo');
                const target = document.getElementById(seccionId);
                if (target) target.classList.add('activa');
                // Reposition cart after layout settles to avoid visual jumps (delays are small)
                try {
                    if (typeof positionCartBelowHeader === 'function') {
                        setTimeout(positionCartBelowHeader, 120);
                        setTimeout(positionCartBelowHeader, 420);
                    }
                } catch(e){}
            });
        });

    // Posicionar el carrito fijo debajo del nav (botones de sección). Fallback a header si no existe nav.
    (function(){
        const cart = document.getElementById('cartPanel');
        const nav = document.querySelector('.navegacion');
        const header = document.querySelector('header');
        if (!cart) return;

        // Compute the ideal top (viewport px) where the cart should sit so its top border
        // aligns with the top of the first product row. Return null if the gallery
        // isn't ready yet (so caller can retry shortly).
        function calculateTopForCart(){
            const pedidos = document.getElementById('pedidos');
            const gallery = document.getElementById('productGallery');
            const ref = nav || header;
            const refBottom = ref ? Math.round((ref.getBoundingClientRect().bottom || 0) + 8) : 8;
            // top of the pedidos section (we will not allow the cart to be placed above this)
            const pedidosTop = pedidos ? Math.round(pedidos.getBoundingClientRect().top || 8) : 8;
            const minTop = Math.max(refBottom, pedidosTop);

            if (pedidos && pedidos.classList.contains('activa') && gallery) {
                const firstProduct = gallery.querySelector('.product-item');
                if (!firstProduct) return null; // not rendered yet
                const pRect = firstProduct.getBoundingClientRect();
                let top = Math.round(pRect.top);
                if (isNaN(top)) top = Math.round(gallery.getBoundingClientRect().top);
                // ensure cart doesn't sit above the nav/header or above the pedidos top
                top = Math.max(top, minTop);
                return top;
            }

            if (ref) return Math.max(minTop, refBottom);
            return minTop || 8;
        }

        function positionCartBelowHeader(){
            // Avoid fixed positioning inside the dedicated Cart section to respect its grid layout
            try {
                const secCarrito = document.getElementById('carrito');
                if (secCarrito && secCarrito.classList.contains('activa')) {
                    cart.style.position = 'relative';
                    cart.style.top = '';
                    cart.style.right = '';
                    cart.style.zIndex = '';
                    cart.style.transition = '';
                    return;
                }
            } catch(e){}
            // Only use fixed cart on smaller viewports to avoid complex layout shifts on wide desktop
            // On wide desktop the grid already positions the cart in the right column.
            if (window.innerWidth > 1200) {
                cart.style.position = 'relative';
                cart.style.top = '';
                cart.style.right = '';
                cart.style.zIndex = '';
                try { positionPromoBanner(); } catch(e) {}
                return;
            }

            let top = calculateTopForCart();
            if (top === null) {
                // gallery or images not ready: retry shortly so alignment happens after layout
                clearTimeout(positionCartBelowHeader._retry);
                positionCartBelowHeader._retry = setTimeout(positionCartBelowHeader, 120);
                return;
            }
            if (isNaN(top) || top < 8) top = 8;
            // limit top so the cart always fits inside viewport
            const vh = Math.max(320, window.innerHeight || 768);
            const cartH = Math.min(cart.offsetHeight || 420, vh - 32);
            if (top + cartH > vh - 12) top = Math.max(8, vh - 12 - cartH);

            cart.style.position = 'fixed';
            cart.style.top = top + 'px';
            // prefer a comfortable right offset on narrow screens
            cart.style.right = '12px';
            cart.style.zIndex = 1200;
            // ensure smooth visibility: add small transition only when changing from relative
            cart.style.transition = 'top 0.12s ease, right 0.12s ease';
            try { positionPromoBanner(); } catch(e) {}
        }

        // Update on common events and after section switches
        window.addEventListener('resize', positionCartBelowHeader);
        window.addEventListener('scroll', positionCartBelowHeader);
        document.querySelectorAll('.boton-seccion').forEach(b => b.addEventListener('click', () => setTimeout(positionCartBelowHeader, 220)));

        // Retry positioning after images in the gallery load (helps avoid jumps when images change layout)
        const gallery = document.getElementById('productGallery');
        if (gallery) {
            const imgs = gallery.querySelectorAll('img');
            imgs.forEach(img => {
                if (!img.complete) {
                    img.addEventListener('load', () => setTimeout(positionCartBelowHeader, 120));
                    img.addEventListener('error', () => setTimeout(positionCartBelowHeader, 120));
                }
            });
        }

        // initial attempt shortly after load
        setTimeout(positionCartBelowHeader, 120);
    })();

    document.querySelectorAll('.boton-unidad').forEach(boton => {
        boton.addEventListener('click', function() {
            unidades = parseInt(this.dataset.unidades);
            document.querySelectorAll('.boton-unidad').forEach(b => b.classList.remove('activo'));
            this.classList.add('activo');
            const contenedor = document.getElementById('contenedorUnidades');
            contenedor.innerHTML = '';
            for(let i = 1; i <= unidades; i++) {
                const isFullWidth = (unidades % 2 === 1) && (i === unidades);
                contenedor.innerHTML += crearUnidad(i, isFullWidth);
            }
            actualizarPrecio();
            configurarEventosUnidades();
        });
    });

    

    function actualizarPrecio() {
    if (typeof unidades === 'undefined' || isNaN(unidades) || unidades < 1) { unidades = 1; }
    let precioBase = PRECIOS_BASE[unidades] || 0;
    let total = precioBase;
    let parches = 0;
    let dorsales = 0;
    let versionesJugador = 0;
    let versionesEspecial = 0;
    let camisetasNBA = 0;
    let recargoTallas = 0;
    let totalRecargoTallas = 0;

    document.querySelectorAll('.unidad').forEach(unidad => {
        const parche = unidad.querySelector('[name="parche[]"]').value.trim();
        const dorsal = unidad.querySelector('[name="dorsal[]"]').value.trim();
        const versionJugador = unidad.querySelector('[name="versionJugador[]"]').value === 'Sí';
        const versionEspecial = unidad.querySelector('[name="versionRetro[]"]').value === 'Sí';
        const esCamisetaNBA = unidad.querySelector('[name="camisetaNBA[]"]').value === 'Sí';
        const talla = unidad.querySelector('[name="talla[]"]').value;

        if (esCamisetaNBA && !dorsal) {
        }

        if (esCamisetaNBA) {
            if (parche) {
                unidad.querySelector('[name="parche[]"]').value = '';
            }
            camisetasNBA++;
            if (dorsal) dorsales++;
        } else {
            if (parche) parches++;
            if (dorsal) dorsales++;
        }
        if (versionJugador) versionesJugador++;
        if (versionEspecial) versionesEspecial++;
        if (talla === '3XL') {
            recargoTallas++;
            totalRecargoTallas += 2;
        } else if (talla === '4XL') {
            recargoTallas++;
            totalRecargoTallas += 2;
        }
    });

    const totalParches = parches * EXTRAS.parche;
    const totalDorsales = dorsales * EXTRAS.dorsal;
    const totalVersionesCombinadas = (versionesJugador + versionesEspecial + camisetasNBA);
    const totalVersionesJugador = totalVersionesCombinadas * EXTRAS.versionJugador;

    total += totalParches + totalDorsales + totalVersionesJugador + totalRecargoTallas;

    let gastosEnvio = 0;
    if (unidades === 1) {
        gastosEnvio = GASTOS_ENVIO;
        total += gastosEnvio;
    }

    if (gastosEnvio === 0) {
        const ge = document.getElementById('gastos-envio'); if (ge) { ge.innerHTML = '<i class="fas fa-gift" style="color:#28a745;margin-right:0.4em;"></i><strong style="color:#28a745;font-size:1.1em;letter-spacing:1px;">GRATIS</strong>'; }
    } else {
        const ge = document.getElementById('gastos-envio'); if (ge) { ge.innerHTML = gastosEnvio.toFixed(2) + '€'; }
    }

    const setText = (id, value) => { const el = document.getElementById(id); if (el) el.textContent = value; };
    const setVal = (id, value) => { const el = document.getElementById(id); if (el) el.value = value; };

    setText('cantidad-unidades', unidades);
    setText('plural-unidades', unidades > 1 ? 'es' : '');
    setText('precio-base-detalle', (PRECIOS_BASE[unidades] || 0).toFixed(2));

    setText('cantidad-unidades-sin-desc', unidades);
    setText('plural-unidades-sin-desc', unidades > 1 ? 'es' : '');
    const precioSinDescuentoUnidad = 25.00;
    const totalSinDescuentoExtras = (parches * EXTRAS.parche) + (dorsales * EXTRAS.dorsal) + ((versionesJugador + versionesEspecial + camisetasNBA) * EXTRAS.versionJugador) + totalRecargoTallas;
    const totalSinDescuento = (precioSinDescuentoUnidad * unidades + totalSinDescuentoExtras).toFixed(2);
    setText('precio-sin-descuento', totalSinDescuento);
    setText('precioSinDescuentoTotal', totalSinDescuento);

    setText('cantidad-parches', parches);
    setText('total-parches', totalParches.toFixed(2));

    setText('cantidad-dorsales', dorsales);
    setText('total-dorsales', totalDorsales.toFixed(2));

    setText('cantidad-versiones', totalVersionesCombinadas);
    setText('total-versiones', totalVersionesJugador.toFixed(2));

    setText('cantidad-tallas-extra', recargoTallas);
    setText('total-tallas-extra', totalRecargoTallas.toFixed(2));

    setText('precioDisplay', total.toFixed(2));
    setVal('precioTotal', total.toFixed(2));

    const precioConDescuento = total.toFixed(2);
    const diferencia = (totalSinDescuento - precioConDescuento).toFixed(2);
    let ahorroHtml = '';
    if (unidades > 0) {
        ahorroHtml = `
        <div class="ahorro-visual animate__animated animate__fadeIn" style="display:flex;justify-content:flex-end;margin:0.5rem 0 0.2rem 0;">
            <span style="background:rgba(40,167,69,0.08);color:#28a745;font-weight:600;font-size:1rem;padding:0.25em 0.9em;border-radius:16px;box-shadow:0 1px 4px #2a5ba81a;display:inline-flex;align-items:center;gap:0.5em;">
                <i class="fas fa-arrow-down" style="color:#28a745;font-size:1em;"></i>
                Ahorro: <span style="font-weight:700;">-${diferencia}€</span>
            </span>
        </div>`;
    }
    const totalContainer = document.querySelector('.total-container');
    if (totalContainer) {
        let oldAhorro = totalContainer.parentElement.querySelector('.ahorro-visual');
        if (oldAhorro) oldAhorro.remove();
        totalContainer.insertAdjacentHTML('beforebegin', ahorroHtml);
    }

    return total;
}
    function prepararRedireccion(event) {
    const total = document.getElementById('precioDisplay').textContent;
    const direccion = document.getElementById('direccion').value;
    const params = new URLSearchParams({
        total: total,
        direccion: encodeURIComponent(direccion)
    });
    const baseUrl = window.location.href.replace('index.html', 'exito.html');
    document.getElementById('nextUrl').value = `${baseUrl}?${params.toString()}`;
    return true;
    }
    function configurarEventosUnidades() {
        document.querySelectorAll('.boton-version-jugador').forEach(boton => {
            boton.addEventListener('click', function() {
                const hiddenInput = this.parentElement.querySelector('[name="versionJugador[]"]');
                const unidad = this.closest('.unidad');
                const botonNBA = unidad.querySelector('.boton-camiseta-nba');
                const botonRetro = unidad.querySelector('.boton-version-especial:not(.boton-version-jugador):not(.boton-camiseta-nba)');

                if (!this.classList.contains('activo')) {
                    if (botonNBA.classList.contains('activo')) {
                        botonNBA.classList.remove('activo');
                        botonNBA.querySelector('span').textContent = 'DESACTIVADO';
                        botonNBA.parentElement.querySelector('[name="camisetaNBA[]"]').value = 'No';
                    }
                    if (botonRetro && botonRetro.classList.contains('activo')) {
                        botonRetro.classList.remove('activo');
                        botonRetro.querySelector('span').textContent = 'DESACTIVADO';
                        botonRetro.parentElement.querySelector('[name="versionRetro[]"]').value = 'No';
                    }
                }

                this.classList.toggle('activo');
                const activo = this.classList.contains('activo');
                this.querySelector('span').textContent = activo ? 'ACTIVADO' : 'DESACTIVADO';
                hiddenInput.value = activo ? 'Sí' : 'No';

                if (activo) {
                    if (botonNBA.classList.contains('activo')) {
                        botonNBA.classList.remove('activo');
                        botonNBA.querySelector('span').textContent = 'DESACTIVADO';
                        botonNBA.parentElement.querySelector('[name="camisetaNBA[]"]').value = 'No';
                    }
                    if (botonRetro && botonRetro.classList.contains('activo')) {
                        botonRetro.classList.remove('activo');
                        botonRetro.querySelector('span').textContent = 'DESACTIVADO';
                        botonRetro.parentElement.querySelector('[name="versionRetro[]"]').value = 'No';
                    }
                }

                actualizarPrecio();
            });
        });

        document.querySelectorAll('.boton-version-especial').forEach(boton => {
            if (
                !boton.classList.contains('boton-version-jugador') &&
                !boton.classList.contains('boton-camiseta-nba')
            ) {
                boton.addEventListener('click', function() {
                    const hiddenInput = this.parentElement.querySelector('[name="versionRetro[]"]');
                    const unidad = this.closest('.unidad');
                    const botonNBA = unidad.querySelector('.boton-camiseta-nba');
                    const botonJugador = unidad.querySelector('.boton-version-jugador');

                    if (!this.classList.contains('activo')) {
                        if (botonNBA.classList.contains('activo')) {
                            botonNBA.classList.remove('activo');
                            botonNBA.querySelector('span').textContent = 'DESACTIVADO';
                            botonNBA.parentElement.querySelector('[name="camisetaNBA[]"]').value = 'No';
                        }
                        if (botonJugador.classList.contains('activo')) {
                            botonJugador.classList.remove('activo');
                            botonJugador.querySelector('span').textContent = 'DESACTIVADO';
                            botonJugador.parentElement.querySelector('[name="versionJugador[]"]').value = 'No';
                        }
                    }

                    this.classList.toggle('activo');
                    const activo = this.classList.contains('activo');
                    this.querySelector('span').textContent = activo ? 'ACTIVADO' : 'DESACTIVADO';
                    hiddenInput.value = activo ? 'Sí' : 'No';

                    if (activo) {
                        if (botonNBA.classList.contains('activo')) {
                            botonNBA.classList.remove('activo');
                            botonNBA.querySelector('span').textContent = 'DESACTIVADO';
                            botonNBA.parentElement.querySelector('[name="camisetaNBA[]"]').value = 'No';
                        }
                        if (botonJugador.classList.contains('activo')) {
                            botonJugador.classList.remove('activo');
                            botonJugador.querySelector('span').textContent = 'DESACTIVADO';
                            botonJugador.parentElement.querySelector('[name="versionJugador[]"]').value = 'No';
                        }
                    }

                    actualizarPrecio();
                });
            }
        });

        document.querySelectorAll('.boton-camiseta-nba').forEach(boton => {
            boton.addEventListener('click', function() {
                const hiddenInput = this.parentElement.querySelector('[name="camisetaNBA[]"]');
                const unidad = this.closest('.unidad');
                const botonJugador = unidad.querySelector('.boton-version-jugador');
                const botonRetro = unidad.querySelector('.boton-version-especial:not(.boton-version-jugador):not(.boton-camiseta-nba)');
                const inputParche = unidad.querySelector('[name="parche[]"]');
                const inputDorsal = unidad.querySelector('[name="dorsal[]"]');

                if (!this.classList.contains('activo')) {
                    if (!inputDorsal.value.trim()) {
                        alert('Debes introducir un dorsal para activar la camiseta NBA.');
                        inputDorsal.focus();
                        return;
                    }
                }

                if (!this.classList.contains('activo')) {
                    if (botonJugador.classList.contains('activo')) {
                        botonJugador.classList.remove('activo');
                        botonJugador.querySelector('span').textContent = 'DESACTIVADO';
                        botonJugador.parentElement.querySelector('[name="versionJugador[]"]').value = 'No';
                    }
                    if (botonRetro && botonRetro.classList.contains('activo')) {
                        botonRetro.classList.remove('activo');
                        botonRetro.querySelector('span').textContent = 'DESACTIVADO';
                        botonRetro.parentElement.querySelector('[name="versionRetro[]"]').value = 'No';
                    }
                }

                this.classList.toggle('activo');
                const activo = this.classList.contains('activo');
                this.querySelector('span').textContent = activo ? 'ACTIVADO' : 'DESACTIVADO';
                hiddenInput.value = activo ? 'Sí' : 'No';

                if (activo) {
                    if (botonJugador.classList.contains('activo')) {
                        botonJugador.classList.remove('activo');
                        botonJugador.querySelector('span').textContent = 'DESACTIVADO';
                        botonJugador.parentElement.querySelector('[name="versionJugador[]"]').value = 'No';
                    }
                    if (botonRetro && botonRetro.classList.contains('activo')) {
                        botonRetro.classList.remove('activo');
                        botonRetro.querySelector('span').textContent = 'DESACTIVADO';
                        botonRetro.parentElement.querySelector('[name="versionRetro[]"]').value = 'No';
                    }
                }

                inputParche.disabled = activo;
                if (activo) inputParche.value = '';

                inputDorsal.disabled = false;

                actualizarPrecio();
            });
        });
    document.querySelectorAll('.input-parche, .input-dorsal').forEach(input => {
        input.addEventListener('input', actualizarPrecio);
    });

        document.querySelectorAll('.input-talla').forEach(input => {
            input.addEventListener('change', actualizarPrecio);
        });
}

    // Ensure the payment function is available globally so event handlers can find it
    // abrirPayPal(total, { skipHint: true }) -> open immediately
    // abrirPayPal(total) -> show prominent hint with close button; open PayPal after user closes hint
    window.abrirPayPal = function (total, opts) {
        opts = opts || {};
        // Normalize amount to two decimals
        let totalStr = String(total || '0');
        totalStr = totalStr.replace(/,/g, '.').replace(/[^0-9.]/g, '');
        const parts = totalStr.split('.');
        if (parts.length > 2) {
            const dec = parts.pop();
            totalStr = parts.join('') + '.' + dec;
        }
        const payAmount = (Number(totalStr) || 0).toFixed(2);

        const width = 600;
        const height = 800;
        const left = Math.round((window.innerWidth - width) / 2);
        const top = Math.round((window.innerHeight - height) / 2);
        const paypalUrl = `https://www.paypal.com/paypalme/camisetazo/${encodeURIComponent(payAmount)}EUR`;

        // If caller requested to skip the hint, open immediately
        if (opts && opts.skipHint) {
            // open popup immediately
            let popup = null;
            try {
                popup = window.open(paypalUrl, 'PagoPayPal', `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`);
                if (popup && typeof popup.focus === 'function') popup.focus();
            } catch(e) {
                setTimeout(()=> { try { popup = window.open(paypalUrl, 'PagoPayPal', `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`); if (popup && typeof popup.focus === 'function') popup.focus(); } catch(e2){} }, 300);
            }
            if (!popup) {
                mostrarExito('Popup bloqueado. Abre manualmente: ' + paypalUrl);
                return null;
            }

            const intervalo = setInterval(() => {
                try {
                    if (popup.closed) {
                        clearInterval(intervalo);
                        mostrarExito('Pago detectado. Enviando pedido...');
                        try { if (typeof enviarFormulario === 'function') enviarFormulario(); } catch (err) { console.error(err); }
                        const cm = document.getElementById('checkoutModal'); if (cm) cm.remove();
                    }
                } catch (e) {}
            }, 500);
            return popup;
        }

        // Default behaviour: show prominent yellow hint in primer plano with Close button.
        // When user closes the hint we open PayPal.
        (function showHintThenOpen(){
            // remove any existing hint overlay we created before
            const existing = document.getElementById('paypalHintOverlay'); if (existing) existing.remove();
            const overlay = document.createElement('div');
            overlay.id = 'paypalHintOverlay';
            overlay.style.position = 'fixed';
            overlay.style.left = '0'; overlay.style.top = '0'; overlay.style.right = '0'; overlay.style.bottom = '0';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.background = 'rgba(0,0,0,0.45)';
            overlay.style.zIndex = 99999;

            const box = document.createElement('div');
            box.style.background = '#ffc107';
            box.style.color = '#000';
            box.style.padding = '18px';
            box.style.borderRadius = '10px';
            box.style.maxWidth = '820px';
            box.style.width = '92%';
            box.style.boxShadow = '0 10px 40px rgba(0,0,0,0.35)';
            box.innerHTML = `
                    <div style="display:flex;align-items:flex-start;gap:12px;">
                        <div style="flex:1">
                            <strong>Importante:</strong>
                            <div style="margin-top:6px;color:#111;line-height:1.3;">En la ventana de PayPal selecciona la opción "Enviar a amigos y familiares". Cuando cierres la ventana de PayPal se enviará el pedido automáticamente. Si quieres revisar o modificar tu pedido pulsa "Revisar pedido". Para proceder, pulsa "Abrir PayPal" IMPORTANTE: El pedido se enviará simepre y cuando se reciba el pago correctamente.</div>
                        </div>
                        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;">
                            <button id="paypalHintRevisar" class="btn-secondary" style="background:transparent;color:#000;border:1px solid rgba(0,0,0,0.08);padding:8px 12px;border-radius:8px;">Revisar pedido</button>
                            <button id="paypalHintAbrir" class="btn-primary" style="background:#0b5ed7;color:#fff;border:none;padding:8px 12px;border-radius:8px;">Abrir PayPal</button>
                        </div>
                    </div>
            `;
            overlay.appendChild(box);

                // 'Revisar pedido' simply closes the overlay so the user can modify the cart
                const revisarBtn = box.querySelector('#paypalHintRevisar');
                const abrirBtn = box.querySelector('#paypalHintAbrir');
                if (revisarBtn) revisarBtn.addEventListener('click', () => { overlay.remove(); });

                // 'Abrir PayPal' removes overlay and opens PayPal immediately (skip hint)
                if (abrirBtn) abrirBtn.addEventListener('click', () => {
                    overlay.remove();
                    try { window.abrirPayPal(payAmount, { skipHint: true }); } catch (e) { console.error('abrirBtn error', e); }
                });
            document.body.appendChild(overlay);
        })();
        return null;
    }

    function mostrarExito(mensaje) {
    const notificacion = document.getElementById('formStatus');
    if (!notificacion) return;
    notificacion.className = 'success';
    // Make it a fixed, high z-index floating notification so it's always visible in primer plano
    notificacion.style.position = 'fixed';
    notificacion.style.top = '20px';
    notificacion.style.left = '50%';
    notificacion.style.transform = 'translateX(-50%)';
    notificacion.style.zIndex = '200000';
    notificacion.style.background = '#1e7e34';
    notificacion.style.color = '#fff';
    notificacion.style.padding = '12px 16px';
    notificacion.style.borderRadius = '8px';
    notificacion.style.display = 'block';
    notificacion.style.width = 'auto';
    notificacion.style.maxWidth = '94%';
    notificacion.style.boxShadow = '0 8px 30px rgba(30,126,52,0.22)';
    notificacion.innerHTML = `<strong style="margin-right:8px;">✔</strong> ${mensaje} <button id="closeFormStatus" style="margin-left:12px;background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff;padding:6px 10px;border-radius:6px;cursor:pointer;">Cerrar</button>`;
    const closeBtn = document.getElementById('closeFormStatus');
    if (closeBtn) closeBtn.addEventListener('click', ()=> { notificacion.style.display = 'none'; });
    }
    function enviarFormulario() {
    console.log('enviarFormulario: start. CART length=', (window.CART||[]).length);
        const precioTotalEl = document.getElementById('precioTotal');
        const precioDisplayEl = document.getElementById('precioDisplay');
        const pedidoFormEl = document.getElementById('pedidoForm');
    if (!pedidoFormEl) { console.error('enviarFormulario: pedidoForm not found'); return; }

        // Evitar envíos dobles
        if (pedidoFormEl.dataset.submitted === '1') {
            mostrarExito('Pedido ya en proceso de envío...');
            return;
        }

        // Rellenar campos básicos: usar el total calculado centralmente si está disponible
        try {
            const computed = (typeof computeCartTotals === 'function') ? computeCartTotals() : null;
            if (computed && computed.total !== undefined) {
                precioTotalEl.value = Number(computed.total).toFixed(2);
            } else if (precioDisplayEl) {
                precioTotalEl.value = precioDisplayEl.textContent || precioTotalEl.value || '0.00';
            } else {
                const cartTotalEl = document.getElementById('cartTotal');
                precioTotalEl.value = cartTotalEl ? (cartTotalEl.textContent || '0.00') : '0.00';
            }
        } catch (e) {
            precioTotalEl.value = '0.00';
        }

        // Copiar campos del modal/legacy
        const copyIfExists = (srcSelector, destId) => {
            const el = document.querySelector(srcSelector);
            const dest = document.getElementById(destId);
            if (el && dest) dest.value = el.value ? el.value.trim() : '';
        };
        copyIfExists('#checkoutPaypalEmail', 'form_emailPaypal');
        copyIfExists('#checkoutContactName', 'form_contactName');
        copyIfExists('#checkoutAddressLine', 'form_direccion');
        copyIfExists('#checkoutCity', 'form_city');
        copyIfExists('#checkoutState', 'form_state');
        copyIfExists('#checkoutCountry', 'form_country');
        copyIfExists('#checkoutPostal', 'form_postal');
        copyIfExists('#checkoutPhone', 'form_phone');
        copyIfExists('#checkoutInstagram', 'form_instagram');
    // fallbacks legacy
    copyIfExists('#emailPaypal', 'form_emailPaypal');
    // (usuario field removed) copyIfExists('#usuario', 'form_usuario');
    copyIfExists('#direccion', 'form_direccion');

                // Serialize cart items into a human-readable text field (no JSON): include talla, parche, dorsal y versión
        try {
            let itemsToProcess = (window.CART || []);
            if ((!itemsToProcess || itemsToProcess.length === 0) && document.querySelectorAll) {
                console.warn('enviarFormulario: CART vacío — intentando reconstruir items desde DOM');
                const domRows = document.querySelectorAll('#cartItems .cart-item');
                const reconstructed = [];
                domRows.forEach(row => {
                    try {
                        const name = row.querySelector('.meta b') ? row.querySelector('.meta b').textContent.trim() : 'Producto';
                        const metaSmall = row.querySelector('.meta small') ? row.querySelectorAll('.meta small')[0].textContent.trim() : '';
                        const qtyInput = row.querySelector('.cart-qty-input');
                        const quantity = qtyInput ? Math.max(1, parseInt(qtyInput.value) || 1) : 1;
                        let talla = '';
                        let dorsal = '';
                        let parche = '';
                        let version = '';
                        if (metaSmall) {
                            const parts = metaSmall.split('·').map(s=>s.trim()).filter(Boolean);
                            parts.forEach(p => {
                                if (!talla && /^(S|M|L|XL|2XL|3XL|4XL|[0-9]{1,2})$/i.test(p)) { talla = p; }
                                else if (!dorsal && /\d+|[A-Z\s]{2,}/.test(p)) { dorsal = p; }
                                else if (!version && (p.toLowerCase()==='fan' || p.toLowerCase()==='jugador' || p.toLowerCase()==='player')) { version = p; }
                            });
                        }
                        // Extraer "Parche: ..." desde otros <small> dentro de .meta
                        try {
                            const smEls = row.querySelectorAll('.meta small');
                            Array.from(smEls).forEach(sm => {
                                const txt = (sm.textContent||'').trim();
                                const m = txt.match(/^Parche:\s*(.+)$/i);
                                if (m && !parche) parche = m[1].trim();
                            });
                        } catch(e){}
                        let priceTextEl = row.querySelector('div[style*="font-weight:700"]');
                        let totalDisplayed = 0;
                        if (priceTextEl) {
                            const raw = priceTextEl.textContent || priceTextEl.innerText || '';
                            const m = raw.replace(/[^0-9.,]/g,'').replace(',', '.');
                            totalDisplayed = parseFloat(m) || 0;
                        }
                        // Reconstruir múltiples ítems si la cantidad es > 1
                        for (let k = 0; k < quantity; k++) {
                            reconstructed.push({ productId: '', name, talla, dorsal, parche, version, extra:0, unitPrice: totalDisplayed/quantity || 0, total: totalDisplayed/quantity, quantity: 1 });
                        }
                    } catch (e) { console.error('reconstruct row error', e); }
                });
                if (reconstructed.length) itemsToProcess = reconstructed;
            }

            // Agrupar ítems para mostrar la cantidad
            const groupedItems = {};
            itemsToProcess.forEach(item => {
                const key = `${item.productId || ''}-${item.name || ''}-${item.talla || ''}-${item.dorsal || ''}-${item.parche || ''}-${item.version || ''}`;
                if (!groupedItems[key]) {
                    groupedItems[key] = { ...item, quantity: 0, total: 0 };
                }
                groupedItems[key].quantity += 1;
                groupedItems[key].total += item.total; // Sumar el total de cada unidad
            });

            const finalItems = Object.values(groupedItems);

            // human-friendly version mapping
            const mapVersion = v => { if (!v) return ''; if (v.toLowerCase() === 'jugador') return 'player'; return v; };
            const textEl = document.getElementById('form_cart_items_text');
            if (textEl) { 
                const lines = finalItems.map((it, idx) => {
                    const parts = [];
                    if (it.talla) parts.push(it.talla);
                    if (it.parche) parts.push(it.parche);
                    if (it.dorsal) parts.push(it.dorsal);
                    const ver = mapVersion(it.version);
                    if (ver) parts.push(ver);
                    const extras = parts.length ? ' · ' + parts.join(' · ') : '';
                    const priceStr = `€${(it.total||0).toFixed(2)}`;
                    return `${idx+1}. ${it.quantity}x ${it.name}${extras} — ${priceStr}`;
                });
                textEl.value = lines.join('\n');
                console.log('enviarFormulario: cart_items_text =', textEl.value);
            }
        } catch (e) { console.error('serialize cart error', e); }
    // Debug: precio_total value
    try { console.log('enviarFormulario: precio_total =', precioTotalEl ? precioTotalEl.value : '(no input)'); } catch(e){}

        // Enviar el form usando un iframe oculto para evitar navegación fuera de la página
        try {
            let iframe = document.querySelector('iframe[name="formsubmit_iframe"]');
            if (!iframe) {
                iframe = document.createElement('iframe');
                iframe.name = 'formsubmit_iframe';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
            }

            // marcar como enviado
            pedidoFormEl.dataset.submitted = '1';
            pedidoFormEl.target = 'formsubmit_iframe';

            const onLoadHandler = () => {
                setTimeout(() => {
                    mostrarExito('Pedido enviado correctamente.');
                    try { if (typeof clearCart === 'function') clearCart(); } catch (e) {}
                    pedidoFormEl.dataset.submitted = '0';
                }, 600);
                iframe.removeEventListener('load', onLoadHandler);
            };
            iframe.addEventListener('load', onLoadHandler);

            console.log('enviarFormulario: submitting form to', pedidoFormEl.action, 'target=', pedidoFormEl.target);
            pedidoFormEl.submit();
        } catch (err) {
            console.error('Error enviando formulario:', err);
            mostrarExito('Error al enviar el pedido. Intenta de nuevo o contacta por Instagram.');
            pedidoFormEl.dataset.submitted = '0';
        }
    }

    // (Confirmación visual eliminada) El envío ahora se realizará automáticamente tras cerrar la ventana de PayPal.

    // Legacy form handlers: only attach if the old pedido form exists on the page
    (function attachLegacyFormHandlers(){
        const pedidoFormEl = document.getElementById('pedidoForm');
        if (!pedidoFormEl) return;

        const paypalBtn = document.getElementById('paypalButton');
        if (!paypalBtn) return;

        paypalBtn.addEventListener('click', function(event) {
            event.preventDefault();

            const emailEl = document.getElementById('emailPaypal');
            const usuarioEl = document.getElementById('usuario');
            const cantidadEl = document.getElementById('cantidad-unidades');
            const precioDisplayEl = document.getElementById('precioDisplay');

            const emailPaypal = emailEl ? emailEl.value.trim() : '';
            if (!emailPaypal || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailPaypal)) {
                alert("Por favor, ingresa un correo válido de PayPal.");
                return;
            }

            const usuarioInstagram = usuarioEl ? usuarioEl.value.trim() : '';
            if (!usuarioInstagram || !/^@[A-Za-z0-9_.]{1,30}$/.test(usuarioInstagram)) {
                alert("Por favor, ingresa un nombre de usuario válido de Instagram (debe comenzar con @ y tener entre 1 y 30 caracteres).");
                return;
            }

            const cantidadUnidades = cantidadEl ? cantidadEl.textContent : '0';
            if (parseInt(cantidadUnidades) === 0) {
                alert("Debes seleccionar al menos una unidad.");
                return;
            }

            const total = precioDisplayEl ? parseFloat(precioDisplayEl.textContent) : NaN;
            if (isNaN(total) || total <= 0) {
                alert("El total a pagar no es válido.");
                return;
            }

            if (typeof window.abrirPayPal === 'function') window.abrirPayPal(total);
        });
    })();

document.querySelectorAll('.catalogo-card-clickable').forEach(card => {
    card.addEventListener('click', function(e) {
        if (
            e.target.closest('.futbol-dropdown-menu a') ||
            e.target.closest('.futbol-dropdown-btn')
        ) {
            return;
        }
        const link = card.getAttribute('data-link');
        if (link) {
            window.open(link, '_blank');
        }
    });
});

    actualizarPrecio();

});
</script>
<script src="scripts/scripts.js"></script>
<script defer src="https://analytics.vercel.com/script.js"></script>
</body>
</html>
