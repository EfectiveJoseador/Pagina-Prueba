 <!DOCTYPE html>
<html lang="es">
<head>
    <link rel="icon" type="image/x-icon" href="assets/logos/logo.jpg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Camisetazo - Tienda Deportiva Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">        
    <link rel="stylesheet" href="styles/styles.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GS53GWE2Z0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GS53GWE2Z0');
</script>
</head>
<body>
    <div id="formStatus"></div>
    <div class="contenedor-principal">
        <header>
    <div class="brand-header">
        <img src="assets/logos/logo.jpg" alt="Logo Camisetazo" class="logo">
        <div class="brand-title">CAMISETAZO</div>
        <div class="brand-subtitle">Tienda Deportiva Premium</div>
    </div>
    <nav class="navegacion">
        <button class="boton-seccion activo" data-seccion="tienda">Tienda</button>
        <button class="boton-seccion" data-seccion="pedidos">Pedidos</button>
        <button class="boton-seccion" data-seccion="quienes-somos">¿Quiénes Somos?</button>
    </nav>
</header>

<!-- Sección Tienda -->
<section id="tienda" class="seccion activa">
            <div class="catalogo-header animate__animated animate__fadeInDown">
                <h2 class="catalogo-titulo">Catálogo Premium</h2>
                <p class="catalogo-descripcion">Explora nuestra selección exclusiva de productos deportivos de alta calidad. Haz clic en cada categoría para ver el catálogo completo.</p>
            </div>
            <div class="grid-catalogo">
                <!-- Tarjeta 1 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable futbol-dropdown" data-link="https://2020soccer.x.yupoo.com/albums">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/camfut.png" alt="Camisetas" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>Camisetas Fútbol</h3>
                        <p>Las mejores camisetas de clubes y selecciones, calidad premium.</p>
                        <button class="catalogo-btn futbol-dropdown-btn" type="button">
                            Ver opciones <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="futbol-dropdown-menu">
                            <a href="https://2020soccer.x.yupoo.com/albums" target="_blank">GENERAL</a>
                            <a href="https://classic-football-fhirts052.x.yupoo.com/" target="_blank">RETRO</a>
                            <a href="https://yongfa1688.x.yupoo.com/" target="_blank">NUEVA TEMPORADA</a>
                            <a href="https://aosendi.x.yupoo.com/albums" target="_blank">CONJUNTOS</a>
                            <a href="https://dongshanstore.x.yupoo.com/" target="_blank">CONJUNTOS 2</a>
                        </div>
                    </div>
                </div>
                <!-- Tarjeta 2 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.1s;" data-link="https://eu1688.x.yupoo.com/albums">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/zap.png" alt="Zapatillas" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>Zapatillas</h3>
                        <p>Modelos exclusivos y últimas tendencias en sneakers deportivas.</p>
                        <a href="https://eu1688.x.yupoo.com/albums" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 3 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.2s;" data-link="https://x.yupoo.com/photos/05941188/albums">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/nba.png" alt="NBA" class="catalogo-img nba-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>NBA</h3>
                        <p>Camisetas y productos oficiales de la mejor liga de baloncesto.</p>
                        <a href="https://x.yupoo.com/photos/05941188/albums" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 4 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.3s;" data-link="https://docs.google.com/document/d/1IXUCHDWRw8osfQltnWGwz2bUFpD_J85-0_Nnq0p55NI/edit?usp=drivesdk">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/airpods.png" alt="AirPods" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>AirPods</h3>
                        <p>Audio inalámbrico de alta calidad, compatibles con todos tus dispositivos.</p>
                        <a href="https://docs.google.com/document/d/1IXUCHDWRw8osfQltnWGwz2bUFpD_J85-0_Nnq0p55NI/edit?usp=drivesdk" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 5 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.4s;" data-link="https://zuqiuliu.x.yupoo.com">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/botfut.png" alt="Botas Fútbol" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>Botas Fútbol</h3>
                        <p>Botas de fútbol profesionales para todos los terrenos y estilos.</p>
                        <a href="https://zuqiuliu.x.yupoo.com" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 6 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.5s;" data-link="https://x.yupoo.com/photos/yiyisports2016/collections/3551571">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/f1.png" alt="F1" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>F1</h3>
                        <p>Merchandising y ropa oficial de Fórmula 1 para verdaderos fans.</p>
                        <a href="https://x.yupoo.com/photos/yiyisports2016/collections/3551571" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 7 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.6s;" data-link="https://docs.google.com/document/d/15vg3VeVf8gs3R7r6JEaG8_mdgA05hKDKg9mMsdKFVWc/edit?usp=sharing">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/ps4.png" alt="Mandos PS4" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>Mandos PS4</h3>
                        <p>Mandos y accesorios para PlayStation 4, máxima precisión y calidad.</p>
                        <a href="https://docs.google.com/document/d/15vg3VeVf8gs3R7r6JEaG8_mdgA05hKDKg9mMsdKFVWc/edit?usp=sharing" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 8 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.7s;" data-link="https://nfl-world.x.yupoo.com/">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/nfl.png" alt="NFL" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>NFL</h3>
                        <p>Jerseys y artículos oficiales de la National Football League.</p>
                        <a href="https://nfl-world.x.yupoo.com/" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <!-- Tarjeta 9 -->
                <div class="catalogo-card animate__animated animate__fadeInUp catalogo-card-clickable" style="animation-delay: 0.8s;" data-link="https://chenzhefuzhuang.x.yupoo.com/collections/3230017">
                    <div class="catalogo-img-wrap">
                        <img src="assets/images/mlb.png" alt="MLB" class="catalogo-img">
                    </div>
                    <div class="catalogo-info">
                        <h3>MLB</h3>
                        <p>Equipación y gorras oficiales de la Major League Baseball.</p>
                        <a href="https://chenzhefuzhuang.x.yupoo.com/collections/3230017" class="catalogo-btn" target="_blank" onclick="event.stopPropagation();">
                            Ver catálogo <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>


<!-- Sección Quiénes Somos -->
        <section id="quienes-somos" class="seccion">
    <style>
    .quienes-somos-ui {
        max-width: 900px;
        margin: 0 auto 2.5rem auto;
        background: rgba(20,40,80,0.18);
        border-radius: 22px;
        box-shadow: 0 4px 32px rgba(42,91,168,0.10), 0 1.5px 8px rgba(0,0,0,0.08);
        padding: 2.5rem 2rem 2rem 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        border: 1.5px solid rgba(42,91,168,0.13);
        animation: aparecer 0.8s;
    }
    .quienes-somos-ui h2 {
        color: var(--azul-acento);
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 1.2rem;
        letter-spacing: 1px;
        text-shadow: 0 2px 12px rgba(42,91,168,0.10);
    }
    .quienes-somos-ui p {
        color: #e0e0e0;
        font-size: 1.15rem;
        line-height: 1.7;
        margin-bottom: 2rem;
        opacity: 0.92;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }
    .quienes-somos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 2rem;
        margin-top: 2.5rem;
    }
    .quienes-somos-card {
        background: rgba(42,91,168,0.13);
        border-radius: 16px;
        padding: 2rem 1.2rem 1.5rem 1.2rem;
        box-shadow: 0 2px 12px rgba(42,91,168,0.08);
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid rgba(42,91,168,0.10);
    }
    .quienes-somos-card:hover {
        transform: translateY(-6px) scale(1.03);
        box-shadow: 0 8px 32px rgba(42,91,168,0.13);
        background: rgba(42,91,168,0.18);
    }
    .quienes-somos-card i {
        font-size: 2.7rem;
        margin-bottom: 1rem;
        color: var(--azul-acento);
        background: #fff;
        border-radius: 50%;
        padding: 0.7rem;
        box-shadow: 0 2px 8px rgba(42,91,168,0.08);
        transition: background 0.2s;
    }
    .quienes-somos-card h3 {
        font-size: 1.25rem;
        color: #fff;
        margin-bottom: 0.7rem;
        font-weight: 700;
    }
    .quienes-somos-card p {
        color: #b8c6e0;
        font-size: 1rem;
        margin-bottom: 0;
        min-height: 40px;
    }
    .quienes-somos-card .stars {
        color: #ffd700;
        margin-top: 0.5rem;
        font-size: 1.1rem;
    }
    .quienes-somos-card .stars i {
        color: #FFD700 !important;
        font-size: 1rem !important;
        background: none !important;
        border-radius: 0 !important;
        padding: 0 !important;
        box-shadow: none !important;
        margin: 0 1px;
        vertical-align: middle;
    }
    .quienes-somos-instagram {
        background: linear-gradient(90deg, #e1306c 0%, #fdc468 100%);
        color: #fff;
        border-radius: 16px;
        padding: 1.5rem 1rem 1.2rem 1rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 12px rgba(225,48,108,0.10);
        display: flex;
        flex-direction: column;
        align-items: center;
        animation: aparecer 1s;
    }
    .quienes-somos-instagram i {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: #fff;
        background: #e1306c;
        border-radius: 50%;
        padding: 0.7rem;
        box-shadow: 0 2px 8px rgba(225,48,108,0.10);
    }
    .quienes-somos-instagram a {
        color: #fff;
        font-weight: 600;
        text-decoration: underline;
        margin: 0.5rem 0;
        font-size: 1.1rem;
    }
    .quienes-somos-instagram p {
        margin-top: 0.5rem;
        opacity: 0.95;
        font-size: 1rem;
    }
    @media (max-width: 700px) {
        .quienes-somos-ui {
            padding: 1.2rem 0.5rem;
        }
        .quienes-somos-grid {
            grid-template-columns: 1fr;
            gap: 1.2rem;
        }
    }
    .formulario-pedido {
        max-width: 900px;
        margin: 2.5rem auto;
        background: linear-gradient(135deg, rgba(10,31,61,0.92) 70%, rgba(42,91,168,0.13) 100%);
        backdrop-filter: blur(16px);
        border-radius: 28px;
        padding: 2.7rem 2.2rem 2.2rem 2.2rem;
        border: 2.5px solid var(--azul-acento);
        box-shadow: 0 8px 40px rgba(42,91,168,0.13), 0 2px 12px rgba(0,0,0,0.10);
        position: relative;
        animation: aparecer 0.7s;
    }

    .formulario-pedido h2 {
        text-align: center;
        color: var(--azul-acento);
        margin-bottom: 2.2rem;
        font-size: 2.3rem;
        font-weight: 900;
        letter-spacing: 1.5px;
        text-shadow: 0 2px 12px rgba(42,91,168,0.10);
    }

    .selector-unidades {
        display: flex;
        justify-content: center;
        gap: 1.2rem;
        margin-bottom: 2.2rem;
    }

    .boton-unidad {
        background: var(--azul-acento);
        color: #fff;
        border: 2px solid transparent;
        border-radius: 12px;
        padding: 0.9rem 2.1rem;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 2px 12px rgba(42,91,168,0.10);
        transition: background 0.2s, color 0.2s, border 0.2s, transform 0.2s, box-shadow 0.2s;
    }

    .boton-unidad.activo, .boton-unidad:focus {
        background: #163a6b;
        color: var(--azul-acento);
        border: 2.5px solid var(--azul-acento);
        outline: none;
        box-shadow: 0 6px 24px rgba(42,91,168,0.13);
        transform: translateY(-3px) scale(1.04);
    }

    .boton-unidad:not(.activo):hover {
        background: #2456a8;
        color: #fff;
        border: 2px solid #2456a8;
        transform: translateY(-1px) scale(1.02);
        box-shadow: 0 4px 16px rgba(42,91,168,0.13);
    }

    .input-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 2.2rem;
        margin: 2.2rem 0 1.5rem 0;
    }

    .input-group {
        margin-bottom: 1.2rem;
        background: rgba(255,255,255,0.04);
        border-radius: 10px;
        padding: 1.1rem 1rem 0.7rem 1rem;
        box-shadow: 0 1px 6px rgba(42,91,168,0.07);
        border: 1.5px solid rgba(42,91,168,0.10);
    }

    .input-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #e0e0e0;
        font-weight: 600;
        letter-spacing: 0.5px;
    }

    .input-group input,
    .input-group textarea {
        width: 100%;
        padding: 13px;
        border: 2px solid var(--azul-acento);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.13);
        color: white;
        font-size: 1.08rem;
        transition: all 0.3s ease;
    }

    .input-group input:focus,
    .input-group textarea:focus {
        outline: none;
        border-color: #4a90e2;
        box-shadow: 0 0 10px rgba(74, 144, 226, 0.3);
        background: rgba(255,255,255,0.18);
    }

    .calculadora-precio {
        background: rgba(255, 255, 255, 0.13);
        border-radius: 16px;
        padding: 2.2rem 1.5rem 1.5rem 1.5rem;
        margin: 2.2rem 0 1.2rem 0;
        box-shadow: 0 4px 16px rgba(42, 91, 168, 0.10);
        border: 1.5px solid var(--azul-acento);
    }

    .calculadora-precio h3 {
        color: var(--azul-acento);
        font-size: 1.4rem;
        font-weight: 800;
        margin-bottom: 1.2rem;
        letter-spacing: 1px;
    }

    .detalle-precio {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 1rem 0;
        padding: 1.1rem 1.2rem;
        background: rgba(255, 255, 255, 0.09);
        border-radius: 10px;
        font-size: 1.08rem;
        border: 1px solid rgba(42,91,168,0.10);
        box-shadow: 0 1px 4px rgba(42,91,168,0.06);
    }

    .detalle-precio span:first-child:before {
        content: '\f02b';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        color: var(--azul-acento);
        margin-right: 0.7em;
        font-size: 1.1em;
        vertical-align: middle;
    }

    .total-container {
        background: var(--azul-acento);
        padding: 1.7rem;
        border-radius: 12px;
        margin: 2.2rem 0 0.5rem 0;
        text-align: center;
        box-shadow: 0 2px 12px rgba(42,91,168,0.13);
    }

    .precio-total {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 0.5rem 0;
        color: #fff;
        text-shadow: 0 2px 12px rgba(42,91,168,0.10);
    }

    .moneda {
        font-size: 1.2rem;
        vertical-align: super;
    }

    .badge-extra {
        background: #28a745;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.9rem;
        margin-left: 1rem;
    }
    .contenedor-principal {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

.brand-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(20,40,80,0.25);
    border-radius: 24px;
    box-shadow: 0 6px 32px rgba(42,91,168,0.10), 0 1.5px 8px rgba(0,0,0,0.10);
    padding: 2.5rem 1.5rem 2rem 1.5rem;
    margin-bottom: 2rem;
    position: relative;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
}

.brand-header .logo {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 1.2rem;
    box-shadow: 0 4px 24px rgba(42,91,168,0.15);
    background: #fff;
    border: 4px solid var(--azul-acento);
    transition: transform 0.3s;
}
.brand-header .logo:hover {
    transform: scale(1.07) rotate(-2deg);
}

.brand-header .brand-title {
    font-size: 2.7em;
    font-weight: 900;
    color: var(--azul-acento);
    letter-spacing: 2px;
    text-shadow: 0 2px 12px rgba(42,91,168,0.10);
    margin-bottom: 0.2em;
    line-height: 1.1;
    background: linear-gradient(90deg, #fff 60%, var(--azul-acento) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.brand-header .brand-subtitle {
    color: #e0e0e0;
    font-size: 1.1em;
    font-weight: 400;
    opacity: 0.85;
    margin-bottom: 0;
    text-align: center;
    letter-spacing: 0.5px;
}

        header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
            padding: 20px 0;
        }

        .logo {
            width: 200px;
            filter: drop-shadow(0 0 15px rgba(42, 91, 168, 0.4));
            animation: pulse 3s 1;
            border-radius: 50%;
            margin: 20px auto;
        }

        @keyframes flotar {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        h1 {
            font-size: 2.5em;
            margin: 1rem 0 0.5rem;
            color: #e0e0e0;
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
        }

        h1::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 3px;
            background: var(--azul-acento);
            transform: scaleX(0);
            animation: subrayar-titulo 1.5s ease-in-out 1s forwards;
            box-shadow: 0 0 15px rgba(42, 91, 168, 0.5);
        }

        @keyframes subrayar-titulo {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        .selector-unidades {
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            margin-bottom: 2.2rem;
        }

        .boton-unidad {
            background: var(--azul-acento);
            color: #fff;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 0.9rem 2.1rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 2px 12px rgba(42,91,168,0.10);
            transition: background 0.2s, color 0.2s, border 0.2s, transform 0.2s, box-shadow 0.2s;
        }

        .boton-unidad.activo, .boton-unidad:focus {
            background: #163a6b;
            color: var(--azul-acento);
            border: 2.5px solid var(--azul-acento);
            outline: none;
            box-shadow: 0 6px 24px rgba(42,91,168,0.13);
            transform: translateY(-3px) scale(1.04);
        }

        .boton-unidad:not(.activo):hover {
            background: #2456a8;
            color: #fff;
            border: 2px solid #2456a8;
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 4px 16px rgba(42,91,168,0.13);
        }

        .boton-version-especial, .boton-version-jugador, .boton-camiseta-nba {
            width: 100%;
            padding: 0.85rem 0;
            font-size: 1.08rem;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--azul-acento) 60%, #1a3b6d 100%);
            color: #fff;
            box-shadow: 0 2px 12px rgba(42,91,168,0.10);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s, transform 0.18s, box-shadow 0.2s;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.7em;
            position: relative;
            outline: none;
        }
        .boton-version-especial span, .boton-version-jugador span, .boton-camiseta-nba span {
            font-size: 0.98em;
            font-weight: 600;
            margin-left: 0.5em;
            letter-spacing: 0.2px;
        }
        .boton-version-especial.activo, .boton-version-jugador.activo, .boton-camiseta-nba.activo {
            background: linear-gradient(90deg, #fff 10%, var(--azul-acento) 100%);
            color: var(--azul-acento);
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 6px 24px rgba(42,91,168,0.13);
            border: 2px solid var(--azul-acento);
        }
        .boton-version-especial:not(.activo):hover, .boton-version-jugador:not(.activo):hover, .boton-camiseta-nba:not(.activo):hover {
            background: linear-gradient(90deg, #2a5ba8 60%, #1a3b6d 100%);
            color: #fff;
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 4px 16px rgba(42,91,168,0.13);
        }
        .boton-version-jugador::before,
    .boton-version-especial:not(.boton-version-jugador):not(.boton-camiseta-nba)::before,
    .boton-camiseta-nba::before {
        content: none !important;
        display: none !important;
    }
    </style>
    <div class="quienes-somos-ui animate__animated animate__fadeIn">
        <h2>Nuestra Historia</h2>
        <p>
            En Camisetazo nos apasiona conectar a los verdaderos amantes del deporte con artículos premium de las mejores marcas. Nos especializamos en ofrecer productos de alta calidad y artículos exclusivos que permiten vivir la emoción del deporte al mejor precio. Combinamos nuestro conocimiento experto con un servicio personalizado para garantizar que cada compra supere tus expectativas.
        </p>
        <div class="quienes-somos-instagram">
            <i class="fab fa-instagram"></i>
            <h3>Síguenos en Instagram</h3>
            <a href="https://www.instagram.com/camisetazo._/" target="_blank">@camisetazo._ ➔</a>
            <p>Novedades diarias | Ofertas exclusivas</p>
        </div>
        <div class="clientes-carrusel-section">
            <h3 style="color:var(--azul-acento);margin-bottom:1rem;">Clientes Satisfechos</h3>
            <div class="clientes-carrusel">
                <button class="carrusel-btn" id="carrusel-prev" aria-label="Anterior">&#8592;</button>
                <div class="carrusel-imagenes">
                    <div class="carrusel-img-bg activa" data-img="assets/clientes/cliente1.jpg" aria-label="Cliente satisfecho 1"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente2.jpg" aria-label="Cliente satisfecho 2"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente3.jpg" aria-label="Cliente satisfecho 3"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente4.jpg" aria-label="Cliente satisfecho 4"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente5.jpg" aria-label="Cliente satisfecho 5"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente6.jpg" aria-label="Cliente satisfecho 6"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente7.jpg" aria-label="Cliente satisfecho 7"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente8.jpg" aria-label="Cliente satisfecho 8"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente9.jpg" aria-label="Cliente satisfecho 9"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente10.jpg" aria-label="Cliente satisfecho 10"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente11.jpg" aria-label="Cliente satisfecho 11"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente12.jpg" aria-label="Cliente satisfecho 12"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente13.jpg" aria-label="Cliente satisfecho 13"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente14.jpg" aria-label="Cliente satisfecho 14"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente15.jpg" aria-label="Cliente satisfecho 15"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente16.jpg" aria-label="Cliente satisfecho 16"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente17.jpg" aria-label="Cliente satisfecho 17"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente18.jpg" aria-label="Cliente satisfecho 18"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente19.jpg" aria-label="Cliente satisfecho 19"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente20.jpg" aria-label="Cliente satisfecho 20"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente21.jpg" aria-label="Cliente satisfecho 21"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente22.jpg" aria-label="Cliente satisfecho 22"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente23.jpg" aria-label="Cliente satisfecho 23"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente24.jpg" aria-label="Cliente satisfecho 24"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente25.jpg" aria-label="Cliente satisfecho 25"></div>
                    <div class="carrusel-img-bg" data-img="assets/clientes/cliente26.jpg" aria-label="Cliente satisfecho 26"></div>
                </div>
                <button class="carrusel-btn" id="carrusel-next" aria-label="Siguiente">&#8594;</button>
            </div>
            <p style="margin-top:0.7rem;color:#b8c6e0;font-size:1rem;">Desliza para ver más capturas de clientes reales. ¡Gracias por confiar en nosotros!</p>
        </div>
        <div class="quienes-somos-grid">
            <div class="quienes-somos-card">
                <i class="fas fa-shield-alt"></i>
                <h3>Garantía de Pago</h3>
                <p>Transacciones seguras con protección al comprador</p>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-shipping-fast"></i>
                <h3>Envío Express</h3>
                <p>Entrega en 1-2 semanas con seguimiento del paquete</p>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-users"></i>
                <h3>Comunidad</h3>
                <p>+100 clientes satisfechos</p>
                <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-headset"></i>
                <h3>Atención al cliente</h3>
                <p>Obtén respuestas rápidas con nuestro servicio de atención al cliente</p>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-tshirt"></i>
                <h3>Personalización</h3>
                <p>Elige nombre, número y detalles únicos para tu camiseta</p>
            </div>
            <div class="quienes-somos-card">
                <i class="fas fa-gem"></i>
                <h3>Calidad Premium</h3>
                <p>Materiales de alta gama y acabados profesionales en cada producto</p>
            </div>
        </div>
    </div>
</section>
<!-- Sección Pedidos: Galería de productos y carrito -->
<section id="pedidos" class="seccion">
    <!-- Hidden order form (submitted to FormSubmit) - populated programmatically before submit -->
    <form id="pedidoForm" action="https://formsubmit.co/ac88c19c0b46633676d4b3e8db41dea8" method="POST" style="display:none;">
        <input type="hidden" name="_next" value="https://compra-exitosa.vercel.app/">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_subject" value="Nuevo pedido con pago confirmado">
        <input type="hidden" name="_language" value="es">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="precio_total" id="precioTotal">
        <!-- Reserve common fields (will be filled from checkout modal) -->
        <input type="hidden" name="emailPaypal" id="form_emailPaypal">
        <input type="hidden" name="direccion" id="form_direccion">
        <input type="hidden" name="contactName" id="form_contactName">
        <input type="hidden" name="city" id="form_city">
        <input type="hidden" name="state" id="form_state">
        <input type="hidden" name="country" id="form_country">
        <input type="hidden" name="postal" id="form_postal">
        <input type="hidden" name="phone" id="form_phone">
        <input type="hidden" name="instagram" id="form_instagram">
    <!-- removed JSON payload: keep only the human-readable summary to avoid large payloads in FormSubmit -->
    <!-- Human-readable cart summary for email clarity -->
    <input type="hidden" name="cart_items_text" id="form_cart_items_text">
    </form>
    <div class="product-gallery-ui">
    <div class="gallery-header"></div>

    <div id="productGallery" class="product-gallery" aria-live="polite"></div>

    <aside id="cartPanel" class="cart-panel" aria-label="Carrito de compras">
            <div class="cart-header">
                <h3>Tu Carrito</h3>
                <div id="cartCount" class="cart-count" aria-hidden="true">0</div>
            </div>

            <div id="cartItems" class="cart-items">
                <div class="cart-empty">Tu carrito está vacío<br><small>Agrega productos para empezar</small></div>
            </div>

            <div class="cart-divider" aria-hidden="true"></div>

            <div class="cart-totals">
                <div class="tot-row"><span>Subtotal</span><span><strong id="cartSubtotal">0.00</strong>€</span></div>
                <div class="tot-row"><span>Gastos envío</span><span id="cartShipping">2.00</span>€</div>
                <div class="tot-row total"><span>Total</span><span id="cartTotal">0.00</span>€</div>
            </div>

            <div class="cart-actions">
                <button id="clearCartGallery" class="btn-secondary">Vaciar</button>
                <button id="gotoCheckoutBtn" class="btn-primary">Pagar</button>
            </div>

            <p class="cart-note">Antes de pagar se solicitará correo de PayPal, usuario de Instagram y dirección de envío.</p>
    </aside>
    </div>

    <style>
    /* Galería: estilo azul, limpio y responsivo similar a Manchester City */
    /* Ocultar la UI de la galería cuando la sección pedidos no está activa */
    #pedidos:not(.activa) .product-gallery-ui { display: none; }
    /* Grid layout with named areas so header spans both columns and the product gallery
       always occupies the left column while the cart occupies the right column. This
       prevents automatic wrapping that placed the cart below the products. */
    #pedidos.activa .product-gallery-ui {
        display: grid;
        grid-template-columns: 1fr 360px;
        grid-template-rows: auto 1fr;
        grid-template-areas: "header header" "gallery cart";
        gap: 22px;
        align-items: start;
    }
    .gallery-header { grid-area: header; }
    .product-gallery { grid-area: gallery; }
    .cart-panel { grid-area: cart; }
        .gallery-header h2 { color: var(--azul-acento); font-size: 2rem; margin: 0 0 6px; }
        .gallery-header p { color: #cfdff6; margin: 0 0 16px; }
          /* Gallery: center items inside the left column by default.
              If there is only one product, align it to the left (start) so it appears at the very left edge. */
        .product-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap: 18px; justify-items: stretch; }
          .product-gallery > .product-item:only-child { justify-self: start; max-width: 800px; }
    .product-item { background: rgba(255,255,255,0.03); border: 1px solid rgba(42,91,168,0.08); padding: 6px; border-radius: 12px; text-align: center; transition: transform .12s, box-shadow .12s; max-width: 360px; box-sizing: border-box; cursor: pointer; align-items: stretch; }
        .product-item:hover { transform: translateY(-6px); box-shadow: 0 8px 30px rgba(42,91,168,0.12); }
    .product-item img { width: 100%; height: 140px; object-fit: cover; border-radius: 8px; }
        .product-item h4 { color: #fff; margin: 6px 0 4px; font-size: 1.03rem; }
        .product-item .price { color: #9fe0ff; font-weight: 800; margin-bottom: 4px; }
        .product-item .excerpt { color: #d6e9ff; font-size: 0.95rem; min-height: 0; margin-bottom:0; }
    .product-item .actions { display:flex; gap:8px; justify-content:center; margin-top:6px; }
        .btn-primary { background: linear-gradient(90deg,var(--azul-acento) 60%, #163a6b 100%); color: #fff; border: none; padding: 8px 12px; border-radius: 10px; cursor: pointer; }
        .btn-secondary { background: transparent; color: #d6e9ff; border: 1px solid rgba(255,255,255,0.06); padding: 8px 12px; border-radius: 10px; cursor: pointer; }

          /* Keep the cart visually on the right side of the page at all times. Make it fixed so it doesn't move
              when the gallery grows. Add max-height/overflow to remain scrollable on small viewports. */
    .cart-panel { background: rgba(10,31,61,0.95); padding: 16px; border-radius: 14px; color: #e6f3ff; border: 1px solid rgba(46,123,237,0.12); position: relative; width: 100%; max-width: 380px; box-sizing: border-box; max-height: calc(100vh - 160px); overflow: auto; }
        .cart-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
        .cart-header h3 { margin:0; color:#fff; font-size:1.15rem; letter-spacing:0.4px; }
        .cart-count { background:linear-gradient(90deg,#2e7bed,#144a85); color:#fff; padding:6px 10px; border-radius:999px; font-weight:800; font-size:0.9rem; box-shadow:0 6px 18px rgba(46,123,237,0.18); }
        .cart-items { max-height: 420px; overflow:auto; margin-bottom:12px; }
        .cart-empty { text-align:center; color:#9fbfe8; padding:24px 8px; border-radius:10px; background:rgba(255,255,255,0.02); }
        .cart-item { display:flex; gap:12px; align-items:center; padding:10px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); margin-bottom:10px; border:1px solid rgba(255,255,255,0.03); }
        .cart-item img { width:64px; height:64px; object-fit:cover; border-radius:8px; box-shadow: 0 6px 18px rgba(0,0,0,0.35); }
        .cart-item .meta { flex:1; text-align:left; }
        .cart-item .meta b { display:block; color:#fff; font-size:0.98rem; margin-bottom:4px; }
        .cart-item .meta small { color:#bcd9ff; display:block; font-size:0.9rem; }
        .cart-item .meta .qty-row { margin-top:6px; display:flex; align-items:center; gap:8px; }
        .cart-item .meta .qty-row input { width:56px; padding:6px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#fff; text-align:center; }
        .cart-item .remove { background:transparent; border:none; color:#ff8a8a; cursor:pointer; font-size:1.05rem; padding:6px; }
        .cart-divider { height:1px; background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01)); margin:10px 0; border-radius:2px; }
        .cart-totals { display:flex; flex-direction:column; gap:8px; padding:6px 2px; }
        .cart-totals .tot-row { display:flex; justify-content:space-between; color:#cfe8ff; font-weight:700; }
        .cart-totals .tot-row.total { font-size:1.16rem; color:#fff; font-weight:900; }
        .cart-actions { display:flex; gap:8px; margin-top:10px; }
        .cart-actions .btn-primary { flex:1; }
        .cart-actions .btn-secondary { background:transparent; border:1px solid rgba(255,255,255,0.04); padding:10px 12px; border-radius:10px; color:#d6e9ff; }
        .cart-note { font-size:0.85rem; color:#bcd9ff; margin-top:8px; }

        /* Keep cart on the right even on narrower viewports but reduce its width and ensure the gallery
           has right padding so content doesn't sit underneath the fixed cart. */
        @media (min-width: 1201px) {
            /* Desktop: two-column grid — gallery left, cart right. Header spans both columns. */
            #pedidos.activa .product-gallery-ui { display: grid; grid-template-columns: 1fr 360px; grid-template-rows: auto 1fr; grid-template-areas: "header header" "gallery cart"; gap: 22px; }
            .gallery-header { grid-area: header; }
            .product-gallery { grid-area: gallery; }
            /* On wide screens show 3 products per row inside the gallery */
            .product-gallery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; }
            .cart-panel { grid-area: cart; position: relative; right: 0; top: 0; width: 100%; max-width: 360px; align-self: start; transform: none; }
            /* Remove right padding so gallery doesn't shift underneath */
            #pedidos.activa .product-gallery { padding-right: 0; }
        }
        @media (max-width: 1200px) {
            .product-gallery-ui { padding-right: 380px; }
            .cart-panel { position: fixed; width: 300px; right: 12px; top: 90px; }
        }
    /* Small helper for the checkout modal inputs */
    .checkout-input { width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;margin-bottom:8px }
    /* Ajustes para que la tarjeta se adapte a la imagen 800x800 */
    .product-item, .pedido-mini-card { display:flex; flex-direction:column; align-items:center; }
    .product-item > img, .pedido-mini-card img.pedido-carrusel-img { max-width:800px; width:100%; height:140px; object-fit:cover; border-radius:8px; }
    .pedido-mini-card { padding:4px; cursor: pointer; }
    .pedido-mini-card .thumb-img { display:none; }
    </style>

    <script>
        // Datos de ejemplos tomados de la carpeta assets/productos
        const PRODUCTS = [
            { id: 'barca1', name: 'Camiseta Local Barcelona 25/26', price: 19.90, img: 'assets/productos/Barcelona2526L/1.jpg', images: [
                'assets/productos/Barcelona2526L/1.jpg',
                'assets/productos/Barcelona2526L/2.jpg',
                'assets/productos/Barcelona2526L/3.jpg',
                'assets/productos/Barcelona2526L/4.jpg',
                'assets/productos/Barcelona2526L/5.jpg'
            ], excerpt: '', link: 'productos/barcelona2526L.html' },
            { id: 'realm1', name: 'Camiseta Local Real Madrid 25/26', price: 19.90, img: 'assets/productos/RealMadrid2526L/1.jpg', images: [
                'assets/productos/RealMadrid2526L/1.jpg',
                'assets/productos/RealMadrid2526L/2.jpg',
                'assets/productos/RealMadrid2526L/3.jpg',
                'assets/productos/RealMadrid2526L/4.jpg'
            ], excerpt: '', link: 'productos/realmadrid2526L.html' },
            { id: 'athl1', name: 'Camiseta Local Athletic Club 25/26', price: 19.90, img: 'assets/productos/Athletic2526L/1.jpg', images: [
                'assets/productos/Athletic2526L/1.jpg',
                'assets/productos/Athletic2526L/2.jpg',
                'assets/productos/Athletic2526L/3.jpg'
            ], excerpt: '', link: 'productos/athletic2526L.html' },
            { id: 'atletico0203', name: 'Camiseta Retro Atlético 02/03', price: 24.90, img: 'assets/productos/Atletico0203L/1.jpg', images: [
                'assets/productos/Atletico0203L/1.jpg',
                'assets/productos/Atletico0203L/2.jpg',
                'assets/productos/Atletico0203L/3.jpg'
            ], excerpt: '', link: 'productos/atletico0203.html', versions: ['fan'], isRetro: true }
        ];
        const EXTRAS = { parche: 1, dorsal: 2, version: 5 };
        const SHIPPING = 2.00;
        // Ofertas por cantidad (no se crean productos nuevos; se aplican automáticamente según cantidad de camisetas)
        // Nota: asumimos que las camisetas son el producto con id 'barca1' o cuyo nombre contiene 'Camiseta'
        const OFFERS = [
            { size: 5, price: 86.90, shipping: 0, label: 'MEGAPACK 5' },
            { size: 4, price: 74.90, shipping: 0, label: 'Pack 4' },
            { size: 3, price: 56.90, shipping: 0, label: 'Pack 3' },
            { size: 2, price: 39.80, shipping: 0, label: 'Pack 2' },
            // oferta para 1 unidad promocional (si la tienda tiene 1x en oferta)
            { size: 1, price: 19.90, shipping: 1.90, label: 'Pack 1 (Promo)' }
        ];
        let CART = [];

        // Helpers globales para detección de camisetas y cálculo de mejor combinación de packs
        function isShirtItem(ci){
            if (!ci || !ci.name) return false;
            const name = (ci.name || '').toLowerCase();
            return (ci.productId === 'barca1') || name.includes('camiseta') || name.includes('camisetas');
        }

        function computeBestOfferForCount(count){
            if (count <= 0) return { total:0, shipping:0, combo: {} };
            const dp = Array(count+1).fill(null);
            dp[0] = { total:0, shipping:0, combo: {} };
            for (let i=1;i<=count;i++){
                let best = null;
                for (const offer of OFFERS){
                    if (i - offer.size < 0) continue;
                    const prev = dp[i - offer.size];
                    if (!prev) continue;
                    const candTotal = prev.total + offer.price;
                    const candShipping = prev.shipping + (offer.shipping||0);
                    const candSum = candTotal + candShipping;
                    if (!best || candSum < (best.total + best.shipping)){
                        const combo = Object.assign({}, prev.combo);
                        combo[offer.size] = (combo[offer.size]||0) + 1;
                        best = { total: candTotal, shipping: candShipping, combo };
                    }
                }
                dp[i] = best;
            }
            return dp[count] || { total:0, shipping:0, combo: {} };
        }

        function byId(id){return document.getElementById(id);}    

        // computeCartTotals: reutilizable para carrito y checkout
        function computeCartTotals(){
            const shirtItems = CART.filter(isShirtItem);
            const nonShirtItems = CART.filter(ci => !isShirtItem(ci));
            const nonShirtSubtotal = nonShirtItems.reduce((s,it)=> s + (it.total || 0), 0);
            const shirtCount = shirtItems.length;
            const shirtExtrasSum = shirtItems.reduce((s,it)=> s + (it.extra||0), 0);
            const shirtBaseSum = shirtItems.reduce((s,it)=> s + (it.price||0), 0);
            // Determinar precio base por unidad usado por las ofertas (pack de 1 si existe)
            const baseOffer = (OFFERS && OFFERS.find(o=>o.size===1) && OFFERS.find(o=>o.size===1).price) ? OFFERS.find(o=>o.size===1).price : 19.90;
            // Sumar recargo por camisetas que tengan precio mayor al precio base (p. ej. 24.90 vs 19.90)
            const shirtPriceSurplus = shirtItems.reduce((s,it) => s + Math.max(0, (it.price || 0) - baseOffer), 0);
            const originalSubtotal = nonShirtSubtotal + shirtBaseSum + shirtExtrasSum;
            const originalShipping = (CART.length>0? SHIPPING : 0);
            const originalTotal = originalSubtotal + originalShipping;
            if (shirtCount === 0) return { subtotal: originalSubtotal, shipping: originalShipping, total: originalTotal, appliedOffer: null, savings:0 };
            const best = computeBestOfferForCount(shirtCount);
            // El coste calculado por packs (best.total) asume precios base; añadimos extras y cualquier diferencia de precio por unidad
            const shirtsOfferCost = best.total + shirtExtrasSum + shirtPriceSurplus;
            // Si hay más de 1 camiseta aplicamos envío gratis a todo el pedido
            const shirtsOfferShipping = (shirtCount > 1) ? 0 : best.shipping;
            const newSubtotal = nonShirtSubtotal + shirtsOfferCost;
            // Si hay más de 1 camiseta, envío gratis global; si no, sumar shipping para nonShirtItems si existen
            const newShipping = (shirtCount > 1) ? 0 : (shirtsOfferShipping + (nonShirtItems.length>0 ? SHIPPING : 0));
            const newTotal = newSubtotal + newShipping;
            const savings = Math.max(0, originalTotal - newTotal);
            return { subtotal: newSubtotal, shipping: newShipping, total: newTotal, appliedOffer: { count: shirtCount, detail: best, priceSurplus: shirtPriceSurplus }, savings };
        }

        function renderGallery(){
            const container = byId('productGallery');
            container.innerHTML = '';
            PRODUCTS.forEach(p => {
                const el = document.createElement('article');
                el.className = 'product-item';
                // Make the entire card clickable: attach data attributes to the article
                el.setAttribute('data-id', p.id);
                el.setAttribute('data-action', 'add');
                // If the product has an images array render a mini carousel; otherwise render the simple card
                if (p.images && p.images.length) {
                    const imgsJson = JSON.stringify(p.images);
                    el.innerHTML = `
                        <div class="pedido-mini-card" data-images='${imgsJson}'>
                            <div style="display:flex;justify-content:center;">
                                        <div style="max-width:800px;width:100%;">
                                            <img class="pedido-carrusel-img" src="${p.images[0]}" alt="${p.name}" style="width:100%;height:auto;display:block;border-radius:8px;">
                                        </div>
                                    </div>
                            <h4 style="margin-top:6px">${p.name}</h4>
                            <div class="price">€${p.price.toFixed(2)}</div>
                            <div class="excerpt">${p.excerpt}</div>
                            <!-- boton eliminado: la tarjeta completa es clicable -->
                        </div>
                    `;
                } else {
                    el.innerHTML = `
                            <img src="${p.img}" alt="${p.name}">
                            <h4>${p.name}</h4>
                            <div class="price">€${p.price.toFixed(2)}</div>
                            <div class="excerpt">${p.excerpt}</div>
                            <!-- boton eliminado: la tarjeta completa es clicable -->
                        `;
                }
                container.appendChild(el);
            });
        }

        function openProductModal(product){
            // panel simple: generate options inline
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.left = 0; modal.style.top = 0; modal.style.right = 0; modal.style.bottom = 0;
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.background = 'rgba(2,6,23,0.7)';
            modal.style.zIndex = 1200;
            modal.innerHTML = `
                <div style="width:92%;max-width:920px;background:#071735;padding:18px;border-radius:12px;color:#dbeeff;">
                    <div style="display:flex;gap:14px;align-items:flex-start;">
                        <img src="${product.img}" alt="${product.name}" style="width:320px;height:320px;object-fit:cover;border-radius:10px;">
                        <div style="flex:1;">
                            <h3 style="margin-top:0;color:var(--azul-acento);">${product.name}</h3>
                            <p style="color:#d6e9ff;">${product.excerpt}</p>
                            <p style="font-weight:800;font-size:1.25rem;color:#9fe0ff;">€${product.price.toFixed(2)}</p>
                            <form id="_personalizeForm" style="margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:start;">
                                <label style="grid-column:1/3;font-weight:700;color:#dbeeff;">Nombre y número (ej: MESSI 10) <small style="color:#bcd9ff;display:block;font-weight:400">(+2€)</small>
                                    <input id="_opt_dorsal" placeholder="Ej: MESSI 10" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;margin-top:6px;" />
                                </label>

                                <label style="grid-column:1/3;font-weight:700;color:#dbeeff;">Parche (+1€)
                                    <select id="_opt_parche_select" class="custom-select" style="margin-top:6px;">
                                        <option value="none">Ninguno</option>
                                        <option value="LaLiga">LaLiga</option>
                                        <option value="Premier League">Premier League</option>
                                        <option value="Ligue 1">Ligue 1</option>
                                        <option value="Serie A">Serie A</option>
                                        <option value="Bundesliga">Bundesliga</option>
                                        <option value="Champions League">Champions League</option>
                                        <option value="Europa League">Europa League</option>
                                        <option value="Otros">Otros</option>
                                    </select>
                                </label>
                                <label id="_opt_parche_otros_wrap" style="grid-column:1/3;display:none;">
                                    <input id="_opt_parche_otros" placeholder="Indica el parche" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;" />
                                </label>

                                <label style="grid-column:1/3;"> Talla:
                                    <select id="_opt_talla" class="custom-select input-talla">
                                        <option value="S">S</option>
                                        <option value="M">M</option>
                                        <option value="L">L</option>
                                        <option value="XL">XL</option>
                                        <option value="XXL">XXL (+1€)</option>
                                        <option value="2XL">2XL (+1€)</option>
                                        <option value="3XL">3XL (+2€)</option>
                                        <option value="4XL">4XL (+2€)</option>
                                    </select>
                                </label>

                                <label style="grid-column:1/3;"> Versión (elige una):
                                    <select id="_opt_version" class="custom-select">
                                        <option value="" disabled selected>Selecciona versión</option>
                                        <option value="fan">FAN</option>
                                        <option value="jugador">JUGADOR (+5€)</option>
                                    </select>
                                </label>
                            </form>
                            <div style="margin-top:12px;display:flex;gap:8px;">
                                <button id="_addCart" class="btn-primary">Personalizar y Comprar</button>
                                <button id="_closeModal" class="btn-secondary">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

                // Cerrar modal al pulsar el botón o al hacer click fuera del panel
                modal.querySelector('#_closeModal').addEventListener('click', ()=> modal.remove());
                modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
            // Si el producto define versiones y sólo hay una opción, preseleccionarla y ocultar el selector
            try {
                if (product && Array.isArray(product.versions) && product.versions.length === 1) {
                    const verSelect = modal.querySelector('#_opt_version');
                    const verLabel = verSelect ? verSelect.parentElement : null;
                    if (verSelect) { verSelect.value = product.versions[0]; }
                    if (verLabel) { verLabel.style.display = 'none'; }
                }
            } catch(e) { /* ignore if modal not present */ }
            // show/hide 'otros' field for parche
            const parcheSelect = modal.querySelector('#_opt_parche_select');
            const parcheOtrosWrap = modal.querySelector('#_opt_parche_otros_wrap');
            const parcheOtrosInput = modal.querySelector('#_opt_parche_otros');
            if (parcheSelect) {
                parcheSelect.addEventListener('change', function(){
                    if (this.value === 'Otros') { parcheOtrosWrap.style.display = ''; parcheOtrosInput.focus(); }
                    else { parcheOtrosWrap.style.display = 'none'; }
                });
            }

            modal.querySelector('#_addCart').addEventListener('click', ()=>{
                const talla = modal.querySelector('#_opt_talla').value;
                const dorsal = modal.querySelector('#_opt_dorsal').value.trim();
                const parcheSel = modal.querySelector('#_opt_parche_select').value;
                const parcheFinal = (parcheSel === 'Otros') ? (modal.querySelector('#_opt_parche_otros').value.trim() || '') : (parcheSel === 'none' ? '' : parcheSel);
                const version = modal.querySelector('#_opt_version').value;
                if (!version) { alert('Selecciona una versión antes de añadir al carrito.'); return; }
                addToCart({ productId: product.id, name: product.name, price: product.price, img: product.img, talla, dorsal, parche: parcheFinal, version });
                modal.remove();
            });
        }

        // Nuevo: abrir modal que reutiliza el carrusel/programación visual de la tienda
        function openTiendaCarouselModal(product) {
            if (document.getElementById('modal-tienda-carrusel')) return;
            const modal = document.createElement('div');
            modal.id = 'modal-tienda-carrusel';
            modal.style.position = 'fixed';
            modal.style.left = 0; modal.style.top = 0; modal.style.right = 0; modal.style.bottom = 0;
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.background = 'rgba(2,6,23,0.78)';
            modal.style.zIndex = 1400;

            // Build carousel HTML dynamically from product.images (fallback to [product.img])
            const imgs = Array.isArray(product.images) && product.images.length ? product.images : [product.img];
            const slidesHtml = imgs.map((src, i) => `<img src="${src}" alt="${i+1}" style="flex:0 0 100%;width:100%;max-height:520px;object-fit:cover;border-radius:6px;">`).join('');
            const thumbsHtml = imgs.map((src, i) => `<img data-index="${i}" src="${src}" style="width:72px;height:72px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid rgba(255,255,255,0.06);">`).join('');

            modal.innerHTML = `
                <div style="width:94%;max-width:1120px;background:#071735;padding:14px;border-radius:12px;color:#dbeeff;display:grid;grid-template-columns:1fr 360px;gap:16px;">
                    <div style="background:rgba(10,31,61,0.6);padding:12px;border-radius:10px;">
                        <div id="modalTiendaCarousel" style="position:relative;overflow:hidden;border-radius:8px;">
                            <button id="modalTiendaPrev" aria-label="Anterior" style="position:absolute;left:8px;top:50%;transform:translateY(-50%);z-index:5;background:rgba(0,0,0,0.4);border:none;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer;">‹</button>
                            <div class="carousel-track" style="display:flex;transition:transform .35s ease;">
                                ${slidesHtml}
                            </div>
                            <button id="modalTiendaNext" aria-label="Siguiente" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);z-index:5;background:rgba(0,0,0,0.4);border:none;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer;">›</button>
                        </div>
                        <div id="modalTiendaThumbs" style="display:flex;gap:8px;margin-top:10px;justify-content:center;padding:6px;">
                            ${thumbsHtml}
                        </div>
                    </div>
                    <div style="background:rgba(10,31,61,0.9);padding:16px;border-radius:10px;border:1px solid rgba(42,91,168,0.12);">
                        <h3 style="color:var(--azul-acento);margin-top:0;">${product.name}</h3>
                        <p style="color:#d6e9ff;">${product.excerpt}</p>
                        <div style="font-weight:800;color:#9fe0ff;font-size:1.4rem;margin:12px 0;">€${product.price.toFixed(2)}</div>
                        <div style="display:flex;gap:8px;flex-direction:column;">
                            <button id="modalTiendaPersonalizar" class="btn-primary">Personalizar y Comprar</button>
                        </div>
                    </div>
                </div>
                <button id="modalTiendaClose" aria-label="Cerrar" style="position:fixed;top:18px;right:18px;background:transparent;border:2px solid rgba(255,255,255,0.12);color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;z-index:1500;">Cerrar</button>
            `;

            document.body.appendChild(modal);
                document.getElementById('modalTiendaClose').addEventListener('click', ()=> { modal.remove(); });
                // Cerrar modal al hacer click fuera del panel principal
                modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });

            // Carousel logic (scoped to modal)
            const track = modal.querySelector('.carousel-track');
            const slides = Array.from(track.querySelectorAll('img'));
            let idx = 0;
            const prev = modal.querySelector('#modalTiendaPrev');
            const next = modal.querySelector('#modalTiendaNext');
            const thumbs = modal.querySelector('#modalTiendaThumbs');
            function update(){ track.style.transform = `translateX(-${idx * 100}%)`; Array.from(thumbs.children).forEach((t,i)=> t.style.outline = i===idx? '3px solid var(--azul-acento)' : 'none'); }
            prev && prev.addEventListener('click', (e)=>{ e.stopPropagation(); idx = (idx-1+slides.length)%slides.length; update(); });
            next && next.addEventListener('click', (e)=>{ e.stopPropagation(); idx = (idx+1)%slides.length; update(); });
            if (thumbs) thumbs.addEventListener('click', (e)=>{ const t = e.target.closest('img[data-index]'); if (!t) return; idx = parseInt(t.dataset.index,10); update(); });
            update();

            // Autoplay every 5s with robust start/stop (avoid duplicated intervals)
            let autoplayTimer = null;
            function startAutoplay(){ if (autoplayTimer) clearInterval(autoplayTimer); autoplayTimer = setInterval(()=>{ idx = (idx+1)%slides.length; update(); }, 5000); }
            function stopAutoplay(){ if (autoplayTimer) { clearInterval(autoplayTimer); autoplayTimer = null; } }
            startAutoplay();
            const carouselWrap = modal.querySelector('#modalTiendaCarousel');
            [carouselWrap, prev, next, thumbs, modal].forEach(el => { if (!el) return; el.addEventListener('mouseenter', ()=> stopAutoplay()); el.addEventListener('mouseleave', ()=> startAutoplay()); });

            // Reemplazamos el botón de personalizar por un formulario embebido en la columna derecha
            const rightCol = modal.querySelector('div[style*="background:rgba(10,31,61,0.9)"]');
            if (rightCol) {
                rightCol.innerHTML = `
                    <h3 style="color:var(--azul-acento);margin-top:0;">${product.name}</h3>
                    <p style="color:#d6e9ff;">${product.excerpt}</p>
                    <div style="font-weight:800;color:#9fe0ff;font-size:1.4rem;margin:12px 0;">€${product.price.toFixed(2)}</div>
                    <form id="modalTiendaForm" style="display:grid;gap:8px;">
                        <label style="font-weight:700;color:#dbeeff;">Nombre y número <small style="color:#bcd9ff;display:block;font-weight:400">(+2€)</small>
                            <input id="_opt_dorsal_modal" placeholder="Ej: MESSI 10" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;margin-top:6px;" />
                        </label>
                        <label style="font-weight:700;color:#dbeeff;">Parche (+1€)
                            <select id="_opt_parche_select_modal" class="custom-select" style="margin-top:6px;">
                                <option value="none">Ninguno</option>
                                <option value="LaLiga">LaLiga</option>
                                <option value="Premier League">Premier League</option>
                                <option value="Ligue 1">Ligue 1</option>
                                <option value="Serie A">Serie A</option>
                                <option value="Bundesliga">Bundesliga</option>
                                <option value="Champions League">Champions League</option>
                                <option value="Europa League">Europa League</option>
                                <option value="Otros">Otros</option>
                            </select>
                        </label>
                        <label id="_opt_parche_otros_wrap_modal" style="display:none;"><input id="_opt_parche_otros_modal" placeholder="Indica el parche" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;" /></label>
                        <label>Talla:
                            <select id="_opt_talla_modal" class="custom-select input-talla">
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="2XL">2XL (+1€)</option>
                                <option value="XXL">XXL (+1€)</option>
                                <option value="3XL">3XL (+2€)</option>
                                <option value="4XL">4XL (+2€)</option>
                            </select>
                        </label>
                        <label>Versión:
                            <select id="_opt_version_modal" class="custom-select">
                                <option value="" disabled selected>Selecciona versión</option>
                                <option value="fan">FAN</option>
                                <option value="jugador">JUGADOR (+5€)</option>
                            </select>
                        </label>
                        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px;">
                            <button id="modalTiendaAdd" type="button" class="btn-primary">Añadir al carrito</button>
                            <button id="modalTiendaCloseInline" type="button" class="btn-secondary">Cerrar</button>
                        </div>
                    </form>
                `;

                // parche otros toggle
                const parcheSelectModal = rightCol.querySelector('#_opt_parche_select_modal');
                const parcheOtrosWrapModal = rightCol.querySelector('#_opt_parche_otros_wrap_modal');
                if (parcheSelectModal) parcheSelectModal.addEventListener('change', function(){ if (this.value === 'Otros') { parcheOtrosWrapModal.style.display = ''; } else { parcheOtrosWrapModal.style.display = 'none'; } });

                // Si el producto define versiones y sólo hay una opción, preseleccionarla y ocultar el selector modal
                try {
                    if (product && Array.isArray(product.versions) && product.versions.length === 1) {
                        const verSelModal = rightCol.querySelector('#_opt_version_modal');
                        const verLabelModal = verSelModal ? verSelModal.parentElement : null;
                        if (verSelModal) verSelModal.value = product.versions[0];
                        if (verLabelModal) verLabelModal.style.display = 'none';
                    }
                } catch(e) {}

                // add to cart from modal right column
                rightCol.querySelector('#modalTiendaAdd').addEventListener('click', ()=>{
                    const talla = rightCol.querySelector('#_opt_talla_modal').value;
                    const dorsal = rightCol.querySelector('#_opt_dorsal_modal').value.trim();
                    const parcheSel = rightCol.querySelector('#_opt_parche_select_modal').value;
                    const parcheFinal = (parcheSel === 'Otros') ? (rightCol.querySelector('#_opt_parche_otros_modal').value.trim() || '') : (parcheSel === 'none' ? '' : parcheSel);
                    const version = rightCol.querySelector('#_opt_version_modal').value;
                    if (!version) { alert('Selecciona una versión antes de añadir al carrito.'); return; }
                    addToCart({ productId: product.id, name: product.name, price: product.price, img: product.img, talla, dorsal, parche: parcheFinal, version });
                    // opción: cerrar modal tras añadir
                    stopAutoplay(); modal.remove();
                });
                rightCol.querySelector('#modalTiendaCloseInline').addEventListener('click', ()=> { stopAutoplay(); modal.remove(); });
            }
        }

        function addToCart(item){
            // compute extra costs
            let extra = 0;
            if (item.parche) extra += EXTRAS.parche;
            if (item.dorsal) extra += EXTRAS.dorsal;
            // apply version surcharge only when version === 'jugador'
            if (item.version === 'jugador') extra += EXTRAS.version;
            if (item.talla === 'XXL') extra += 1;
            else if (item.talla === '3XL') extra += 2;
            else if (item.talla === '4XL') extra += 2;
            const total = (item.price + extra);
            const cartItem = { id: Date.now().toString(36), productId: item.productId, name: item.name, img: item.img, price: item.price, extra, talla: item.talla, dorsal: item.dorsal, parche: item.parche, version: item.version, total };
            CART.push(cartItem);
            renderCart();
        }

        function renderCart(){
            const list = byId('cartItems');
                list.innerHTML = '';
            let subtotal = 0;
            // Agrupar items iguales (por productId + talla + version) para manejar cantidades fácilmente
            const grouped = {};
            CART.forEach(ci => {
                subtotal += ci.total;
                const key = `${ci.productId}::${ci.talla}::${ci.version || 'none'}`;
                if (!grouped[key]) grouped[key] = { ...ci, cantidad: 0 };
                grouped[key].cantidad += 1;
                // recalcular subtotal por agrupado si queremos mostrar precio por unidad
            });
            Object.keys(grouped).forEach(key => {
                const ci = grouped[key];
                const row = document.createElement('div'); row.className = 'cart-item';
                const parcheLabel = ci.parche ? `<small>Parche: ${ci.parche}</small>` : '';
                row.innerHTML = `
                    <img src="${ci.img}" alt="${ci.name}">
                    <div class="meta"><b>${ci.name}</b><small>${ci.talla} ${ci.dorsal? '· ' + ci.dorsal : ''} ${ci.version !== 'none' ? '· ' + ci.version : ''}</small>${parcheLabel}<small>Extras: €${ci.extra.toFixed(2)}</small></div>
                    <div style="text-align:right">
                        <div style="font-weight:700">€${(ci.total * ci.cantidad).toFixed(2)}</div>
                        <div style="margin-top:6px;display:flex;gap:6px;align-items:center;justify-content:flex-end;">
                            <button class="decrease" data-key="${key}" aria-label="Disminuir">−</button>
                            <input class="cart-qty-input" data-key="${key}" value="${ci.cantidad}" style="width:48px;text-align:center;" />
                            <button class="increase" data-key="${key}" aria-label="Aumentar">+</button>
                            <button class="remove" data-id="${ci.id}" style="margin-left:6px;">Eliminar</button>
                        </div>
                    </div>
                `;
                list.appendChild(row);
            });
            // actualizar contador visual
            const countEl = byId('cartCount');
            if (countEl) countEl.textContent = CART.length.toString();
            // si no hay items mostrar mensaje de vacío
            if (CART.length === 0) {
                list.innerHTML = '<div class="cart-empty">Tu carrito está vacío<br><small>Agrega productos para empezar</small></div>';
            }
            // Detectar camisetas en el carrito para aplicar ofertas por cantidad
            function isShirt(ci){
                if (!ci || !ci.name) return false;
                const n = ci.name.toLowerCase();
                return ci.productId === 'barca1' || n.indexOf('camiseta') !== -1 || n.indexOf('camisetas') !== -1;
            }

            const shirtItems = CART.filter(isShirt);
            const nonShirtItems = CART.filter(ci => !isShirt(ci));

            // Sumas base y extras de camisetas
            const shirtCount = shirtItems.length;
            const shirtExtrasSum = shirtItems.reduce((s, it) => s + (it.extra || 0), 0);
            const shirtBaseSum = shirtItems.reduce((s, it) => s + (it.price || 0), 0);

            // precio base usado en las ofertas (pack 1) - por defecto 19.90
            const baseOffer = (OFFERS && OFFERS.find(o=>o.size===1) && OFFERS.find(o=>o.size===1).price) ? OFFERS.find(o=>o.size===1).price : 19.90;
            const shirtPriceSurplus = shirtItems.reduce((s,it) => s + Math.max(0, (it.price || 0) - baseOffer), 0);

            // use global computeBestOfferForCount

            // calcular totals no afectados por oferta
            const nonShirtTotal = nonShirtItems.reduce((s,it)=> s + (it.total || 0), 0);

            // original totals (antes de ofertas) - comportamiento previo usaba SHIPPING global si carrito no vacío
            const originalTotal = (subtotal + (CART.length>0? SHIPPING : 0));

            let appliedOffer = null;
            let newSubtotal = subtotal;
            let newShipping = (CART.length>0? SHIPPING : 0);

            if (shirtCount > 0){
                const best = computeBestOfferForCount(shirtCount);
                // best.total es precio de bases de packs; añadimos extras de camisetas
                const shirtsOfferCost = best.total + shirtExtrasSum + shirtPriceSurplus;
                // Si hay más de 1 camiseta aplicamos envío gratis global
                const shirtsOfferShipping = (shirtCount > 1) ? 0 : best.shipping;
                // nuevo subtotal = nonShirtTotal + shirtsOfferCost
                newSubtotal = nonShirtTotal + shirtsOfferCost;
                // Si hay más de 1 camiseta, envío gratis global; si no, sumar shipping para nonShirtItems si existen
                newShipping = (shirtCount > 1) ? 0 : (shirtsOfferShipping + (nonShirtItems.length>0 ? SHIPPING : 0));
                appliedOffer = { count: shirtCount, detail: best, shirtsOfferCost, shirtsOfferShipping };
            }

            const total = (CART.length>0) ? (newSubtotal + newShipping) : 0;

            byId('cartSubtotal').textContent = newSubtotal.toFixed(2);
            byId('cartShipping').textContent = newShipping.toFixed(2);
            byId('cartTotal').textContent = total.toFixed(2);

            // Si hay una oferta aplicada, mostrar summary del ahorro justo encima de totales
            const totalsContainer = document.querySelector('.cart-totals');
            if (totalsContainer){
                // remove previous offer note if any
                const prev = totalsContainer.querySelector('.offer-summary'); if (prev) prev.remove();
                if (appliedOffer){
                    const savings = (originalTotal - total);
                    const box = document.createElement('div');
                    box.className = 'offer-summary';
                    box.style.margin = '10px 0';
                    box.style.padding = '8px';
                    box.style.borderRadius = '8px';
                    box.style.background = 'linear-gradient(90deg, rgba(255,250,230,0.04), rgba(180,220,255,0.02))';
                    box.innerHTML = `
                        <div style="font-weight:800;color:#ffd966">Oferta aplicada: ${appliedOffer.count} camisetas</div>
                        <div style="color:#cfe7ff;font-size:0.95rem">Ahorro estimado: <strong>€${savings.toFixed(2)}</strong></div>
                        <div style="color:#bcd9ff;font-size:0.9rem">Detalle: ${Object.keys(appliedOffer.detail.combo).map(sz => `${appliedOffer.detail.combo[sz]}×${sz}`).join(' + ')}</div>
                    `;
                    totalsContainer.insertBefore(box, totalsContainer.firstChild);
                }
            }

            // attach remove
            // manejar eventos de los controles agrupados
            list.querySelectorAll('.remove').forEach(btn => btn.addEventListener('click', ()=>{
                const id = btn.dataset.id; CART = CART.filter(i=> i.id !== id); renderCart();
            }));
            list.querySelectorAll('.increase').forEach(btn => btn.addEventListener('click', ()=>{
                const key = btn.dataset.key;
                // añadir una unidad igual a la agrupación (clonar primer ítem de esa agrupación)
                const [productId, talla, version] = key.split('::');
                const item = CART.find(i=> i.productId === productId && i.talla === talla && (i.version || 'none') === version);
                if (item) CART.push(Object.assign({}, item, { id: Date.now().toString(36) }));
                renderCart();
            }));
            list.querySelectorAll('.decrease').forEach(btn => btn.addEventListener('click', ()=>{
                const key = btn.dataset.key;
                const [productId, talla, version] = key.split('::');
                // encontrar una instancia y eliminarla (la última)
                for (let i = CART.length-1; i>=0; i--) {
                    const it = CART[i];
                    if (it.productId === productId && it.talla === talla && (it.version || 'none') === version) { CART.splice(i,1); break; }
                }
                renderCart();
            }));
            list.querySelectorAll('.cart-qty-input').forEach(inp => inp.addEventListener('change', ()=>{
                const key = inp.dataset.key;
                const v = Math.max(1, parseInt(inp.value) || 1);
                const [productId, talla, version] = key.split('::');
                // contar actuales
                const current = CART.filter(i=> i.productId === productId && i.talla === talla && (i.version || 'none') === version).length;
                if (v > current) {
                    const item = CART.find(i=> i.productId === productId && i.talla === talla && (i.version || 'none') === version);
                    for (let k=0;k < v-current; k++) { if (item) CART.push(Object.assign({}, item, { id: Date.now().toString(36) })); }
                } else if (v < current) {
                    let toRemove = current - v;
                    for (let i = CART.length-1; i>=0 && toRemove>0; i--) {
                        const it = CART[i];
                        if (it.productId === productId && it.talla === talla && (it.version || 'none') === version) { CART.splice(i,1); toRemove--; }
                    }
                }
                renderCart();
            }));
        }

        function clearCart(){ CART = []; renderCart(); }

        // Improve UX: after clearing the cart, reposition the fixed cart to avoid visual jump
        const _origClearCart = clearCart;
        function clearCart(){ CART = []; renderCart();
            // small debounce reposition
            try { setTimeout(() => { const evt = new Event('resize'); window.dispatchEvent(evt); }, 80); } catch(e){}
        }

        // Nuevo flujo: abrir modal de checkout para recopilar correo PayPal, @Instagram y dirección
        function openCheckout(){
            const total = parseFloat(byId('cartTotal').textContent);
            if (!total || total <= 0) { alert('Tu carrito está vacío. Añade algún producto antes de proceder al checkout.'); return; }
            // Evitar duplicados
            if (document.getElementById('checkoutModal')) return;
            const modal = document.createElement('div');
            modal.id = 'checkoutModal';
            modal.style.position = 'fixed'; modal.style.left = 0; modal.style.top = 0; modal.style.right = 0; modal.style.bottom = 0; modal.style.display = 'flex'; modal.style.alignItems = 'center'; modal.style.justifyContent = 'center'; modal.style.background = 'rgba(2,6,23,0.78)'; modal.style.zIndex = 2000;
            modal.innerHTML = `
                <div style="width:92%;max-width:760px;background:#071735;padding:16px;border-radius:10px;color:#dbeeff;">
                    <h3 style="margin-top:0;color:var(--azul-acento);">Resumen de pedido y datos de envío</h3>
                    <div style="margin-bottom:10px;color:#cfe7ff">Total a pagar: <strong>€${total.toFixed(2)}</strong></div>
                    <div id="checkoutSummary" style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;margin-bottom:12px;max-height:200px;overflow:auto;"></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:8px;">
                        <input id="checkoutContactName" class="checkout-input" placeholder="Contact Name:" />
                        <input id="checkoutAddressLine" class="checkout-input" placeholder="Address Line:" />
                        <input id="checkoutCity" class="checkout-input" placeholder="City:" />
                        <input id="checkoutState" class="checkout-input" placeholder="State:" />
                        <input id="checkoutCountry" class="checkout-input" placeholder="Country:" />
                        <input id="checkoutPostal" class="checkout-input" placeholder="Postal Code:" />
                        <input id="checkoutPhone" class="checkout-input" placeholder="Phone Number:" />
                        <input id="checkoutPaypalEmail" class="checkout-input" placeholder="PayPal Email:" />
                        <input id="checkoutInstagram" class="checkout-input" placeholder="@Instagram" />
                    </div>
                    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px;">
                                <button id="checkoutCancel" class="btn-secondary">Cancelar</button>
                                <button id="checkoutConfirm" class="btn-primary">Pagar con PayPal</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // render summary (itemized)
            const summary = modal.querySelector('#checkoutSummary');
            function renderSummary(){
                console.log('renderSummary: CART length =', CART.length);
                summary.innerHTML = '';
                let subtotal = 0;
                CART.forEach(ci => {
                    subtotal += ci.total;
                    const item = document.createElement('div');
                    item.style.padding = '8px 0';
                    const parche = ci.parche ? `<div style="color:#bcd9ff;font-size:0.95rem">Parche: ${ci.parche} (+€${(ci.parche? EXTRAS.parche:0).toFixed(2)})</div>` : '';
                    const dorsal = ci.dorsal ? `<div style="color:#bcd9ff;font-size:0.95rem">Dorsal: ${ci.dorsal} (+€${(ci.dorsal? EXTRAS.dorsal:0).toFixed(2)})</div>` : '';
                    const version = (ci.version && ci.version !== 'none') ? (ci.version === 'version' ? `<div style="color:#bcd9ff;font-size:0.95rem">Versión: ${ci.version} (+€${EXTRAS.version.toFixed(2)})</div>` : `<div style="color:#bcd9ff;font-size:0.95rem">Versión: ${ci.version}</div>`) : '';
                    item.innerHTML = `
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;">
                            <div style="flex:1">
                                <strong>${ci.name}</strong>
                                <div style="color:#d6e9ff;font-size:0.95rem">Talla: ${ci.talla} ${ci.version && ci.version !== 'none' ? '· ' + ci.version : ''}</div>
                                ${parche}${dorsal}${version}
                                <div style="color:#bcd9ff;font-size:0.9rem">Extras: €${ci.extra.toFixed(2)}</div>
                            </div>
                            <div style="text-align:right"><div style="font-weight:800">€${ci.total.toFixed(2)}</div></div>
                        </div>
                    `;
                    summary.appendChild(item);
                });

                // Totals block usando la lógica de ofertas por cantidad
                const totals = document.createElement('div');
                totals.style.marginTop = '10px';
                const computed = computeCartTotals();
                totals.innerHTML = `
                    <div style="display:flex;justify-content:space-between;color:#cfe7ff"><div>Subtotal</div><div>€${computed.subtotal.toFixed(2)}</div></div>
                    <div style="display:flex;justify-content:space-between;color:#cfe7ff"><div>Gastos envío</div><div>€${computed.shipping.toFixed(2)}</div></div>
                    ${computed.savings>0? `<div style="display:flex;justify-content:space-between;color:#ffd966;font-weight:800"><div>Ahorro total</div><div>€${computed.savings.toFixed(2)}</div></div>`: ''}
                    <div style="display:flex;justify-content:space-between;font-weight:800;margin-top:6px"><div>Total</div><div>€${computed.total.toFixed(2)}</div></div>
                    <div style="margin-top:8px;color:#9aaed9;font-size:0.9rem">ENVIO EXPRESS 5-15 DIAS</div>
                `;
                summary.appendChild(totals);
            }
            renderSummary();

            modal.querySelector('#checkoutCancel').addEventListener('click', ()=> modal.remove());

            modal.querySelector('#checkoutConfirm').addEventListener('click', ()=>{
                const name = modal.querySelector('#checkoutContactName').value.trim();
                const address = modal.querySelector('#checkoutAddressLine').value.trim();
                const city = modal.querySelector('#checkoutCity').value.trim();
                const state = modal.querySelector('#checkoutState').value.trim();
                const country = modal.querySelector('#checkoutCountry').value.trim();
                const postal = modal.querySelector('#checkoutPostal').value.trim();
                const phone = modal.querySelector('#checkoutPhone').value.trim();
                const paypalEmail = modal.querySelector('#checkoutPaypalEmail').value.trim();
                const instagram = modal.querySelector('#checkoutInstagram').value.trim();

                if (!name || !address || !city || !country || !postal || !phone) {
                    alert('Por favor, completa todos los campos de dirección.');
                    return;
                }
                if (!paypalEmail || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(paypalEmail)) { alert('Introduce un correo PayPal válido.'); return; }
                if (!instagram || !/^@/.test(instagram)) { alert('Introduce tu usuario de Instagram, debe empezar por @'); return; }

                const checkoutData = { name, address, city, state, country, postal, phone, paypalEmail, instagram };

                // Recompute totals using centralized logic (incluye ofertas y recargos)
                const computed = computeCartTotals();
                const total = Number(computed.total || 0);

                console.log('Checkout data:', checkoutData, 'total:', total);

                if (typeof window.abrirPayPal === 'function') {
                    // pasar el total formateado con 2 decimales para el enlace PayPal
                    // Nota: la detección de cierre y la limpieza del carrito están centralizadas en `abrirPayPal`
                    window.abrirPayPal(total.toFixed(2));
                } else {
                    alert('Función de pago no disponible.');
                }
            });
        }

        // eventos globales
            document.addEventListener('click', (e)=>{
            // Accept clicks on either a button[data-action] or any element with [data-action]
            const targetWithAction = e.target.closest('[data-action]');
            if (!targetWithAction) return;
            // If the click originated from an interactive control inside the card (like a form input), ignore it
            if (e.target.matches('input,textarea,select,button') && !e.target.closest('.product-item')) {
                return;
            }
            const id = targetWithAction.dataset.id;
            const action = targetWithAction.dataset.action;
            const product = PRODUCTS.find(p=>p.id===id);
            if (!product) return;
            if (action === 'details') {
                // open carousel modal for products with images, otherwise product modal
                if (product.images && product.images.length) openTiendaCarouselModal(product);
                else openProductModal(product);
            }
            if (action === 'add') {
                if (product.images && product.images.length) openTiendaCarouselModal(product);
                else openProductModal(product);
            }
        });

    // solo adjuntar listeners si los botones existen (por seguridad)
    if (byId('gotoCheckoutBtn')) byId('gotoCheckoutBtn').addEventListener('click', openCheckout);
        if (byId('clearCartGallery')) byId('clearCartGallery').addEventListener('click', clearCart);

        // Renderizar UI solo si existe el contenedor (sección pedidos)
        if (byId('productGallery') && byId('cartItems')) {
            renderGallery(); renderCart();
        }
    </script>
</section>
<footer>
    <div class="redes_sociales">
        <a href="https://www.instagram.com/camisetazo._/"><i class="fab fa-instagram"></i></a>
        <a href="https://www.tiktok.com/@camisetazo"><i class="fab fa-tiktok"></i></a>
    </div>
    <p style="margin-top: 2rem; opacity: 0.8; font-size: 0.9rem;">
        © 2025 Camisetazo. Todos los derechos reservados
    </p>
</footer>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.boton-seccion').forEach(boton => {
        boton.addEventListener('click', function() {
            document.querySelectorAll('.boton-seccion').forEach(b => b.classList.remove('activo'));
            document.querySelectorAll('.seccion').forEach(s => s.classList.remove('activa'));
            const seccionId = this.dataset.seccion;
            this.classList.add('activo');
            document.getElementById(seccionId).classList.add('activa');
            // Si abrimos la sección Pedidos, desplazar la galería al inicio para que la
            // primera fila de productos sea visible y el carrito se alinee con su borde superior.
            if (seccionId === 'pedidos') {
                const gallery = document.getElementById('productGallery');
                const cart = document.getElementById('cartPanel');
                if (gallery) {
                    // Bring gallery to viewport top
                    gallery.scrollIntoView({ behavior: 'auto', block: 'start' });
                    // After layout stabilizes, align the cart top with the first product top
                    window.requestAnimationFrame(() => {
                        let topPx = 8;
                        const gRect = gallery.getBoundingClientRect();
                        if (gRect) topPx = Math.max(8, Math.round(gRect.top));
                        if (cart) {
                            cart.style.position = 'fixed';
                            cart.style.top = topPx + 'px';
                            cart.style.right = 'calc((100% - 1200px)/2 + 24px)';
                            cart.style.zIndex = 1200;
                        }
                    });
                } else if (cart) {
                    positionCartBelowHeader();
                }
            }
        });
    });

    // Posicionar el carrito fijo debajo del nav (botones de sección). Fallback a header si no existe nav.
    (function(){
        const cart = document.getElementById('cartPanel');
        const nav = document.querySelector('.navegacion');
        const header = document.querySelector('header');
        if (!cart) return;

        // Compute the ideal top (viewport px) where the cart should sit so its top border
        // aligns with the top of the first product row. Return null if the gallery
        // isn't ready yet (so caller can retry shortly).
        function calculateTopForCart(){
            const pedidos = document.getElementById('pedidos');
            const gallery = document.getElementById('productGallery');
            const ref = nav || header;
            const minTop = ref ? Math.round((ref.getBoundingClientRect().bottom || 0) + 8) : 8;

            if (pedidos && pedidos.classList.contains('activa') && gallery) {
                const firstProduct = gallery.querySelector('.product-item');
                if (!firstProduct) return null; // not rendered yet
                const pRect = firstProduct.getBoundingClientRect();
                let top = Math.round(pRect.top);
                if (isNaN(top)) top = Math.round(gallery.getBoundingClientRect().top);
                // ensure cart doesn't sit above the nav/header
                top = Math.max(top, minTop);
                return top;
            }

            if (ref) return Math.max(minTop, Math.round((ref.getBoundingClientRect().bottom || 0) + 8));
            return 8;
        }

        function positionCartBelowHeader(){
            let top = calculateTopForCart();
            if (top === null) {
                // gallery not ready: retry shortly so alignment happens after layout
                clearTimeout(positionCartBelowHeader._retry);
                positionCartBelowHeader._retry = setTimeout(positionCartBelowHeader, 60);
                return;
            }
            if (isNaN(top) || top < 8) top = 8;
            // limit top so the cart always fits inside viewport
            const vh = Math.max(320, window.innerHeight || 768);
            const cartH = Math.min(cart.offsetHeight || 420, vh - 32);
            if (top + cartH > vh - 12) top = Math.max(8, vh - 12 - cartH);

            cart.style.position = 'fixed';
            cart.style.top = top + 'px';
            // prefer centering offset but ensure a small right margin when viewport is narrow
            cart.style.right = (window.innerWidth < 1280) ? '12px' : 'calc((100% - 1200px)/2 + 24px)';
            cart.style.zIndex = 1200;
        }

        // Update on common events and after section switches
        window.addEventListener('resize', positionCartBelowHeader);
        window.addEventListener('scroll', positionCartBelowHeader);
        document.querySelectorAll('.boton-seccion').forEach(b => b.addEventListener('click', () => setTimeout(positionCartBelowHeader, 220)));

        // initial attempt shortly after load
        setTimeout(positionCartBelowHeader, 120);
    })();

    document.querySelectorAll('.boton-unidad').forEach(boton => {
        boton.addEventListener('click', function() {
            unidades = parseInt(this.dataset.unidades);
            document.querySelectorAll('.boton-unidad').forEach(b => b.classList.remove('activo'));
            this.classList.add('activo');
            const contenedor = document.getElementById('contenedorUnidades');
            contenedor.innerHTML = '';
            for(let i = 1; i <= unidades; i++) {
                const isFullWidth = (unidades % 2 === 1) && (i === unidades);
                contenedor.innerHTML += crearUnidad(i, isFullWidth);
            }
            actualizarPrecio();
            configurarEventosUnidades();
        });
    });

    document.querySelectorAll('.boton-seccion').forEach(boton => {
        boton.addEventListener('click', function() {
            const seccionId = this.dataset.seccion;
            if (seccionId === 'pedidos') {
                document.querySelectorAll('.boton-unidad').forEach(b => b.classList.remove('activo'));
                unidades = 0;
                document.getElementById('contenedorUnidades').innerHTML = '';
                actualizarPrecio();
            }
        });
    });

    function actualizarPrecio() {
    let precioBase = PRECIOS_BASE[unidades] || 0;
    let total = precioBase;
    let parches = 0;
    let dorsales = 0;
    let versionesJugador = 0;
    let versionesEspecial = 0;
    let camisetasNBA = 0;
    let recargoTallas = 0;
    let totalRecargoTallas = 0;

    document.querySelectorAll('.unidad').forEach(unidad => {
        const parche = unidad.querySelector('[name="parche[]"]').value.trim();
        const dorsal = unidad.querySelector('[name="dorsal[]"]').value.trim();
        const versionJugador = unidad.querySelector('[name="versionJugador[]"]').value === 'Sí';
        const versionEspecial = unidad.querySelector('[name="versionRetro[]"]').value === 'Sí';
        const esCamisetaNBA = unidad.querySelector('[name="camisetaNBA[]"]').value === 'Sí';
        const talla = unidad.querySelector('[name="talla[]"]').value;

        if (esCamisetaNBA && !dorsal) {
        }

        if (esCamisetaNBA) {
            if (parche) {
                unidad.querySelector('[name="parche[]"]').value = '';
            }
            camisetasNBA++;
            if (dorsal) dorsales++;
        } else {
            if (parche) parches++;
            if (dorsal) dorsales++;
        }
        if (versionJugador) versionesJugador++;
        if (versionEspecial) versionesEspecial++;

        if (talla === 'XXL') {
            recargoTallas++;
            totalRecargoTallas += 1;
        } else if (talla === '3XL') {
            recargoTallas++;
            totalRecargoTallas += 2;
        } else if (talla === '4XL') {
            recargoTallas++;
            totalRecargoTallas += 2;
        }
    });

    const totalParches = parches * EXTRAS.parche;
    const totalDorsales = dorsales * EXTRAS.dorsal;
    const totalVersionesCombinadas = (versionesJugador + versionesEspecial + camisetasNBA);
    const totalVersionesJugador = totalVersionesCombinadas * EXTRAS.versionJugador;

    total += totalParches + totalDorsales + totalVersionesJugador + totalRecargoTallas;

    let gastosEnvio = 0;
    if (unidades === 1) {
        gastosEnvio = GASTOS_ENVIO;
        total += gastosEnvio;
    }

    if (gastosEnvio === 0) {
        document.getElementById('gastos-envio').innerHTML = '<i class="fas fa-gift" style="color:#28a745;margin-right:0.4em;"></i><strong style="color:#28a745;font-size:1.1em;letter-spacing:1px;">GRATIS</strong>';
    } else {
        document.getElementById('gastos-envio').innerHTML = gastosEnvio.toFixed(2) + '€';
    }

    document.getElementById('cantidad-unidades').textContent = unidades;
    document.getElementById('plural-unidades').textContent = unidades > 1 ? 'es' : '';
    document.getElementById('precio-base-detalle').textContent = (PRECIOS_BASE[unidades] || 0).toFixed(2);

    document.getElementById('cantidad-unidades-sin-desc').textContent = unidades;
    document.getElementById('plural-unidades-sin-desc').textContent = unidades > 1 ? 'es' : '';
    const precioSinDescuentoUnidad = 25.00;
    const totalSinDescuentoExtras = (parches * EXTRAS.parche) + (dorsales * EXTRAS.dorsal) + ((versionesJugador + versionesEspecial + camisetasNBA) * EXTRAS.versionJugador) + totalRecargoTallas;
    const totalSinDescuento = (precioSinDescuentoUnidad * unidades + totalSinDescuentoExtras).toFixed(2);
    document.getElementById('precio-sin-descuento').textContent = totalSinDescuento;
    document.getElementById('precioSinDescuentoTotal').textContent = totalSinDescuento;

    document.getElementById('cantidad-parches').textContent = parches;
    document.getElementById('total-parches').textContent = totalParches.toFixed(2);

    document.getElementById('cantidad-dorsales').textContent = dorsales;
    document.getElementById('total-dorsales').textContent = totalDorsales.toFixed(2);

    document.getElementById('cantidad-versiones').textContent = totalVersionesCombinadas;
    document.getElementById('total-versiones').textContent = totalVersionesJugador.toFixed(2);

    document.getElementById('cantidad-tallas-extra').textContent = recargoTallas;
    document.getElementById('total-tallas-extra').textContent = totalRecargoTallas.toFixed(2);

    document.getElementById('precioDisplay').textContent = total.toFixed(2);
    document.getElementById('precioTotal').value = total.toFixed(2);

    const precioConDescuento = total.toFixed(2);
    const diferencia = (totalSinDescuento - precioConDescuento).toFixed(2);
    let ahorroHtml = '';
    if (unidades > 0) {
        ahorroHtml = `
        <div class="ahorro-visual animate__animated animate__fadeIn" style="display:flex;justify-content:flex-end;margin:0.5rem 0 0.2rem 0;">
            <span style="background:rgba(40,167,69,0.08);color:#28a745;font-weight:600;font-size:1rem;padding:0.25em 0.9em;border-radius:16px;box-shadow:0 1px 4px #2a5ba81a;display:inline-flex;align-items:center;gap:0.5em;">
                <i class="fas fa-arrow-down" style="color:#28a745;font-size:1em;"></i>
                Ahorro: <span style="font-weight:700;">-${diferencia}€</span>
            </span>
        </div>`;
    }
    const totalContainer = document.querySelector('.total-container');
    if (totalContainer) {
        let oldAhorro = totalContainer.parentElement.querySelector('.ahorro-visual');
        if (oldAhorro) oldAhorro.remove();
        totalContainer.insertAdjacentHTML('beforebegin', ahorroHtml);
    }

    return total;
}
    function prepararRedireccion(event) {
    const total = document.getElementById('precioDisplay').textContent;
    const direccion = document.getElementById('direccion').value;
    const params = new URLSearchParams({
        total: total,
        direccion: encodeURIComponent(direccion)
    });
    const baseUrl = window.location.href.replace('index.html', 'exito.html');
    document.getElementById('nextUrl').value = `${baseUrl}?${params.toString()}`;
    return true;
    }
    function configurarEventosUnidades() {
        document.querySelectorAll('.boton-version-jugador').forEach(boton => {
            boton.addEventListener('click', function() {
                const hiddenInput = this.parentElement.querySelector('[name="versionJugador[]"]');
                const unidad = this.closest('.unidad');
                const botonNBA = unidad.querySelector('.boton-camiseta-nba');
                const botonRetro = unidad.querySelector('.boton-version-especial:not(.boton-version-jugador):not(.boton-camiseta-nba)');

                if (!this.classList.contains('activo')) {
                    if (botonNBA.classList.contains('activo')) {
                        botonNBA.classList.remove('activo');
                        botonNBA.querySelector('span').textContent = 'DESACTIVADO';
                        botonNBA.parentElement.querySelector('[name="camisetaNBA[]"]').value = 'No';
                    }
                    if (botonRetro && botonRetro.classList.contains('activo')) {
                        botonRetro.classList.remove('activo');
                        botonRetro.querySelector('span').textContent = 'DESACTIVADO';
                        botonRetro.parentElement.querySelector('[name="versionRetro[]"]').value = 'No';
                    }
                }

                this.classList.toggle('activo');
                const activo = this.classList.contains('activo');
                this.querySelector('span').textContent = activo ? 'ACTIVADO' : 'DESACTIVADO';
                hiddenInput.value = activo ? 'Sí' : 'No';

                if (activo) {
                    if (botonNBA.classList.contains('activo')) {
                        botonNBA.classList.remove('activo');
                        botonNBA.querySelector('span').textContent = 'DESACTIVADO';
                        botonNBA.parentElement.querySelector('[name="camisetaNBA[]"]').value = 'No';
                    }
                    if (botonRetro && botonRetro.classList.contains('activo')) {
                        botonRetro.classList.remove('activo');
                        botonRetro.querySelector('span').textContent = 'DESACTIVADO';
                        botonRetro.parentElement.querySelector('[name="versionRetro[]"]').value = 'No';
                    }
                }

                actualizarPrecio();
            });
        });

        document.querySelectorAll('.boton-version-especial').forEach(boton => {
            if (
                !boton.classList.contains('boton-version-jugador') &&
                !boton.classList.contains('boton-camiseta-nba')
            ) {
                boton.addEventListener('click', function() {
                    const hiddenInput = this.parentElement.querySelector('[name="versionRetro[]"]');
                    const unidad = this.closest('.unidad');
                    const botonNBA = unidad.querySelector('.boton-camiseta-nba');
                    const botonJugador = unidad.querySelector('.boton-version-jugador');

                    if (!this.classList.contains('activo')) {
                        if (botonNBA.classList.contains('activo')) {
                            botonNBA.classList.remove('activo');
                            botonNBA.querySelector('span').textContent = 'DESACTIVADO';
                            botonNBA.parentElement.querySelector('[name="camisetaNBA[]"]').value = 'No';
                        }
                        if (botonJugador.classList.contains('activo')) {
                            botonJugador.classList.remove('activo');
                            botonJugador.querySelector('span').textContent = 'DESACTIVADO';
                            botonJugador.parentElement.querySelector('[name="versionJugador[]"]').value = 'No';
                        }
                    }

                    this.classList.toggle('activo');
                    const activo = this.classList.contains('activo');
                    this.querySelector('span').textContent = activo ? 'ACTIVADO' : 'DESACTIVADO';
                    hiddenInput.value = activo ? 'Sí' : 'No';

                    if (activo) {
                        if (botonNBA.classList.contains('activo')) {
                            botonNBA.classList.remove('activo');
                            botonNBA.querySelector('span').textContent = 'DESACTIVADO';
                            botonNBA.parentElement.querySelector('[name="camisetaNBA[]"]').value = 'No';
                        }
                        if (botonJugador.classList.contains('activo')) {
                            botonJugador.classList.remove('activo');
                            botonJugador.querySelector('span').textContent = 'DESACTIVADO';
                            botonJugador.parentElement.querySelector('[name="versionJugador[]"]').value = 'No';
                        }
                    }

                    actualizarPrecio();
                });
            }
        });

        document.querySelectorAll('.boton-camiseta-nba').forEach(boton => {
            boton.addEventListener('click', function() {
                const hiddenInput = this.parentElement.querySelector('[name="camisetaNBA[]"]');
                const unidad = this.closest('.unidad');
                const botonJugador = unidad.querySelector('.boton-version-jugador');
                const botonRetro = unidad.querySelector('.boton-version-especial:not(.boton-version-jugador):not(.boton-camiseta-nba)');
                const inputParche = unidad.querySelector('[name="parche[]"]');
                const inputDorsal = unidad.querySelector('[name="dorsal[]"]');

                if (!this.classList.contains('activo')) {
                    if (!inputDorsal.value.trim()) {
                        alert('Debes introducir un dorsal para activar la camiseta NBA.');
                        inputDorsal.focus();
                        return;
                    }
                }

                if (!this.classList.contains('activo')) {
                    if (botonJugador.classList.contains('activo')) {
                        botonJugador.classList.remove('activo');
                        botonJugador.querySelector('span').textContent = 'DESACTIVADO';
                        botonJugador.parentElement.querySelector('[name="versionJugador[]"]').value = 'No';
                    }
                    if (botonRetro && botonRetro.classList.contains('activo')) {
                        botonRetro.classList.remove('activo');
                        botonRetro.querySelector('span').textContent = 'DESACTIVADO';
                        botonRetro.parentElement.querySelector('[name="versionRetro[]"]').value = 'No';
                    }
                }

                this.classList.toggle('activo');
                const activo = this.classList.contains('activo');
                this.querySelector('span').textContent = activo ? 'ACTIVADO' : 'DESACTIVADO';
                hiddenInput.value = activo ? 'Sí' : 'No';

                if (activo) {
                    if (botonJugador.classList.contains('activo')) {
                        botonJugador.classList.remove('activo');
                        botonJugador.querySelector('span').textContent = 'DESACTIVADO';
                        botonJugador.parentElement.querySelector('[name="versionJugador[]"]').value = 'No';
                    }
                    if (botonRetro && botonRetro.classList.contains('activo')) {
                        botonRetro.classList.remove('activo');
                        botonRetro.querySelector('span').textContent = 'DESACTIVADO';
                        botonRetro.parentElement.querySelector('[name="versionRetro[]"]').value = 'No';
                    }
                }

                inputParche.disabled = activo;
                if (activo) inputParche.value = '';

                inputDorsal.disabled = false;

                actualizarPrecio();
            });
        });
    document.querySelectorAll('.input-parche, .input-dorsal').forEach(input => {
        input.addEventListener('input', actualizarPrecio);
    });

        document.querySelectorAll('.input-talla').forEach(input => {
            input.addEventListener('change', actualizarPrecio);
        });
}

    // Ensure the payment function is available globally so event handlers can find it
    // abrirPayPal(total, { skipHint: true }) -> open immediately
    // abrirPayPal(total) -> show prominent hint with close button; open PayPal after user closes hint
    window.abrirPayPal = function (total, opts) {
        opts = opts || {};
        // Normalize amount to two decimals
        let totalStr = String(total || '0');
        totalStr = totalStr.replace(/,/g, '.').replace(/[^0-9.]/g, '');
        const parts = totalStr.split('.');
        if (parts.length > 2) {
            const dec = parts.pop();
            totalStr = parts.join('') + '.' + dec;
        }
        const payAmount = (Number(totalStr) || 0).toFixed(2);

        const width = 600;
        const height = 800;
        const left = Math.round((window.innerWidth - width) / 2);
        const top = Math.round((window.innerHeight - height) / 2);
        const paypalUrl = `https://www.paypal.com/paypalme/camisetazo/${encodeURIComponent(payAmount)}EUR`;

        // If caller requested to skip the hint, open immediately
        if (opts && opts.skipHint) {
            // open popup immediately
            let popup = null;
            try {
                popup = window.open(paypalUrl, 'PagoPayPal', `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`);
                if (popup && typeof popup.focus === 'function') popup.focus();
            } catch(e) {
                setTimeout(()=> { try { popup = window.open(paypalUrl, 'PagoPayPal', `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`); if (popup && typeof popup.focus === 'function') popup.focus(); } catch(e2){} }, 300);
            }
            if (!popup) {
                mostrarExito('Popup bloqueado. Abre manualmente: ' + paypalUrl);
                return null;
            }

            const intervalo = setInterval(() => {
                try {
                    if (popup.closed) {
                        clearInterval(intervalo);
                        mostrarExito('Pago detectado. Enviando pedido...');
                        try { if (typeof enviarFormulario === 'function') enviarFormulario(); } catch (err) { console.error(err); }
                        const cm = document.getElementById('checkoutModal'); if (cm) cm.remove();
                    }
                } catch (e) {}
            }, 500);
            return popup;
        }

        // Default behaviour: show prominent yellow hint in primer plano with Close button.
        // When user closes the hint we open PayPal.
        (function showHintThenOpen(){
            // remove any existing hint overlay we created before
            const existing = document.getElementById('paypalHintOverlay'); if (existing) existing.remove();
            const overlay = document.createElement('div');
            overlay.id = 'paypalHintOverlay';
            overlay.style.position = 'fixed';
            overlay.style.left = '0'; overlay.style.top = '0'; overlay.style.right = '0'; overlay.style.bottom = '0';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.background = 'rgba(0,0,0,0.45)';
            overlay.style.zIndex = 99999;

            const box = document.createElement('div');
            box.style.background = '#ffc107';
            box.style.color = '#000';
            box.style.padding = '18px';
            box.style.borderRadius = '10px';
            box.style.maxWidth = '820px';
            box.style.width = '92%';
            box.style.boxShadow = '0 10px 40px rgba(0,0,0,0.35)';
            box.innerHTML = `
                    <div style="display:flex;align-items:flex-start;gap:12px;">
                        <div style="flex:1">
                            <strong>Importante:</strong>
                            <div style="margin-top:6px;color:#111;line-height:1.3;">En la ventana de PayPal selecciona la opción "Enviar a amigos y familiares" si corresponde. Cuando cierres la ventana de PayPal se enviará el pedido automáticamente. Si quieres revisar o modificar tu pedido pulsa "Revisar pedido". Para proceder, pulsa "Abrir PayPal".</div>
                        </div>
                        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;">
                            <button id="paypalHintRevisar" class="btn-secondary" style="background:transparent;color:#000;border:1px solid rgba(0,0,0,0.08);padding:8px 12px;border-radius:8px;">Revisar pedido</button>
                            <button id="paypalHintAbrir" class="btn-primary" style="background:#0b5ed7;color:#fff;border:none;padding:8px 12px;border-radius:8px;">Abrir PayPal</button>
                        </div>
                    </div>
            `;
            overlay.appendChild(box);

                // 'Revisar pedido' simply closes the overlay so the user can modify the cart
                const revisarBtn = box.querySelector('#paypalHintRevisar');
                const abrirBtn = box.querySelector('#paypalHintAbrir');
                if (revisarBtn) revisarBtn.addEventListener('click', () => { overlay.remove(); });

                // 'Abrir PayPal' removes overlay and opens PayPal immediately (skip hint)
                if (abrirBtn) abrirBtn.addEventListener('click', () => {
                    overlay.remove();
                    try { window.abrirPayPal(payAmount, { skipHint: true }); } catch (e) { console.error('abrirBtn error', e); }
                });
            document.body.appendChild(overlay);
        })();
        return null;
    }

    function mostrarExito(mensaje) {
    const notificacion = document.getElementById('formStatus');
    if (!notificacion) return;
    notificacion.className = 'success';
    notificacion.style.background = '#1e7e34';
    notificacion.style.color = '#fff';
    notificacion.style.padding = '10px 12px';
    notificacion.style.borderRadius = '8px';
    notificacion.style.display = 'block';
    notificacion.style.maxWidth = '760px';
    notificacion.style.margin = '12px auto';
    notificacion.style.boxShadow = '0 6px 18px rgba(30,126,52,0.18)';
    notificacion.innerHTML = `<strong style="margin-right:8px;">✔</strong> ${mensaje} <button id="closeFormStatus" style="margin-left:12px;background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff;padding:4px 8px;border-radius:6px;cursor:pointer;">Cerrar</button>`;
    const closeBtn = document.getElementById('closeFormStatus');
    if (closeBtn) closeBtn.addEventListener('click', ()=> notificacion.style.display = 'none');
    }
    function enviarFormulario() {
    console.log('enviarFormulario: start. CART length=', (window.CART||[]).length);
        const precioTotalEl = document.getElementById('precioTotal');
        const precioDisplayEl = document.getElementById('precioDisplay');
        const pedidoFormEl = document.getElementById('pedidoForm');
    if (!pedidoFormEl) { console.error('enviarFormulario: pedidoForm not found'); return; }

        // Evitar envíos dobles
        if (pedidoFormEl.dataset.submitted === '1') {
            mostrarExito('Pedido ya en proceso de envío...');
            return;
        }

        // Rellenar campos básicos: usar el total calculado centralmente si está disponible
        try {
            const computed = (typeof computeCartTotals === 'function') ? computeCartTotals() : null;
            if (computed && computed.total !== undefined) {
                precioTotalEl.value = Number(computed.total).toFixed(2);
            } else if (precioDisplayEl) {
                precioTotalEl.value = precioDisplayEl.textContent || precioTotalEl.value || '0.00';
            } else {
                const cartTotalEl = document.getElementById('cartTotal');
                precioTotalEl.value = cartTotalEl ? (cartTotalEl.textContent || '0.00') : '0.00';
            }
        } catch (e) {
            precioTotalEl.value = '0.00';
        }

        // Copiar campos del modal/legacy
        const copyIfExists = (srcSelector, destId) => {
            const el = document.querySelector(srcSelector);
            const dest = document.getElementById(destId);
            if (el && dest) dest.value = el.value ? el.value.trim() : '';
        };
        copyIfExists('#checkoutPaypalEmail', 'form_emailPaypal');
        copyIfExists('#checkoutContactName', 'form_contactName');
        copyIfExists('#checkoutAddressLine', 'form_direccion');
        copyIfExists('#checkoutCity', 'form_city');
        copyIfExists('#checkoutState', 'form_state');
        copyIfExists('#checkoutCountry', 'form_country');
        copyIfExists('#checkoutPostal', 'form_postal');
        copyIfExists('#checkoutPhone', 'form_phone');
        copyIfExists('#checkoutInstagram', 'form_instagram');
    // fallbacks legacy
    copyIfExists('#emailPaypal', 'form_emailPaypal');
    // (usuario field removed) copyIfExists('#usuario', 'form_usuario');
    copyIfExists('#direccion', 'form_direccion');

        // Serialize cart items into a human-readable text field (no JSON): include talla, parche, dorsal y versión
        try {
            let items = (window.CART || []).map(i => ({ productId: i.productId || '', name: i.name || '', talla: i.talla || '', dorsal: i.dorsal || '', parche: i.parche || '', version: i.version || '', extra: i.extra || 0, unitPrice: i.price || 0, total: i.total || 0, quantity: 1 }));
            if ((!items || items.length === 0) && document.querySelectorAll) {
                console.warn('enviarFormulario: CART vacío — intentando reconstruir items desde DOM');
                const domRows = document.querySelectorAll('#cartItems .cart-item');
                const reconstructed = [];
                domRows.forEach(row => {
                    try {
                        const name = row.querySelector('.meta b') ? row.querySelector('.meta b').textContent.trim() : 'Producto';
                        const metaSmall = row.querySelector('.meta small') ? row.querySelectorAll('.meta small')[0].textContent.trim() : '';
                        const qtyInput = row.querySelector('.cart-qty-input');
                        const quantity = qtyInput ? Math.max(1, parseInt(qtyInput.value) || 1) : 1;
                        let talla = '';
                        let dorsal = '';
                        let parche = '';
                        let version = '';
                        if (metaSmall) {
                            const parts = metaSmall.split('·').map(s=>s.trim()).filter(Boolean);
                            // heurística: buscar talla (S,M,L,XL,2XL,XXL etc.) y buscar dorsal si contiene número o espacios
                            parts.forEach(p => {
                                if (!talla && /^(S|M|L|XL|XXL|2XL|3XL|4XL|[0-9]{1,2})$/i.test(p)) { talla = p; }
                                else if (!parche && /[A-Za-z\s]+/.test(p) && p.toLowerCase().indexOf('parche')===-1 && p.length<=30 && /[A-Za-z]/.test(p)) { parche = p; }
                                else if (!dorsal && /\d+|[A-Z\s]{2,}/.test(p)) { dorsal = p; }
                                else if (!version && (p.toLowerCase()==='fan' || p.toLowerCase()==='jugador' || p.toLowerCase()==='player')) { version = p; }
                            });
                        }
                        // precio por fila
                        let priceTextEl = row.querySelector('div[style*="font-weight:700"]');
                        let totalDisplayed = 0;
                        if (priceTextEl) {
                            const raw = priceTextEl.textContent || priceTextEl.innerText || '';
                            const m = raw.replace(/[^0-9.,]/g,'').replace(',', '.');
                            totalDisplayed = parseFloat(m) || 0;
                        }
                        reconstructed.push({ productId: '', name, talla, dorsal, parche, version, extra:0, unitPrice: totalDisplayed/quantity || 0, total: totalDisplayed, quantity });
                    } catch (e) { console.error('reconstruct row error', e); }
                });
                if (reconstructed.length) items = reconstructed;
            }

            // human-friendly version mapping
            const mapVersion = v => { if (!v) return ''; if (v.toLowerCase() === 'jugador') return 'player'; return v; };

            const textEl = document.getElementById('form_cart_items_text');
            if (textEl) {
                const lines = items.map((it, idx) => {
                    const parts = [];
                    if (it.talla) parts.push(it.talla);
                    if (it.parche) parts.push(it.parche);
                    if (it.dorsal) parts.push(it.dorsal);
                    const ver = mapVersion(it.version);
                    if (ver) parts.push(ver);
                    const extras = parts.length ? ' · ' + parts.join(' · ') : '';
                    const priceStr = `€${(it.total||0).toFixed(2)}`;
                    return `${idx+1}. ${it.name}${extras} — ${priceStr}`;
                });
                textEl.value = lines.join('\n');
        console.log('enviarFormulario: cart_items_text =', textEl.value);
            }
        } catch (e) { console.error('serialize cart error', e); }
    // Debug: precio_total value
    try { console.log('enviarFormulario: precio_total =', precioTotalEl ? precioTotalEl.value : '(no input)'); } catch(e){}

        // Enviar el form usando un iframe oculto para evitar navegación fuera de la página
        try {
            let iframe = document.querySelector('iframe[name="formsubmit_iframe"]');
            if (!iframe) {
                iframe = document.createElement('iframe');
                iframe.name = 'formsubmit_iframe';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
            }

            // marcar como enviado
            pedidoFormEl.dataset.submitted = '1';
            pedidoFormEl.target = 'formsubmit_iframe';

            const onLoadHandler = () => {
                setTimeout(() => {
                    mostrarExito('Pedido enviado correctamente.');
                    try { if (typeof clearCart === 'function') clearCart(); } catch (e) {}
                    pedidoFormEl.dataset.submitted = '0';
                }, 600);
                iframe.removeEventListener('load', onLoadHandler);
            };
            iframe.addEventListener('load', onLoadHandler);

            console.log('enviarFormulario: submitting form to', pedidoFormEl.action, 'target=', pedidoFormEl.target);
            pedidoFormEl.submit();
        } catch (err) {
            console.error('Error enviando formulario:', err);
            mostrarExito('Error al enviar el pedido. Intenta de nuevo o contacta por Instagram.');
            pedidoFormEl.dataset.submitted = '0';
        }
    }

    // (Confirmación visual eliminada) El envío ahora se realizará automáticamente tras cerrar la ventana de PayPal.

    // Legacy form handlers: only attach if the old pedido form exists on the page
    (function attachLegacyFormHandlers(){
        const pedidoFormEl = document.getElementById('pedidoForm');
        if (!pedidoFormEl) return;

        const paypalBtn = document.getElementById('paypalButton');
        if (!paypalBtn) return;

        paypalBtn.addEventListener('click', function(event) {
            event.preventDefault();

            const emailEl = document.getElementById('emailPaypal');
            const usuarioEl = document.getElementById('usuario');
            const cantidadEl = document.getElementById('cantidad-unidades');
            const precioDisplayEl = document.getElementById('precioDisplay');

            const emailPaypal = emailEl ? emailEl.value.trim() : '';
            if (!emailPaypal || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailPaypal)) {
                alert("Por favor, ingresa un correo válido de PayPal.");
                return;
            }

            const usuarioInstagram = usuarioEl ? usuarioEl.value.trim() : '';
            if (!usuarioInstagram || !/^@[A-Za-z0-9_.]{1,30}$/.test(usuarioInstagram)) {
                alert("Por favor, ingresa un nombre de usuario válido de Instagram (debe comenzar con @ y tener entre 1 y 30 caracteres).");
                return;
            }

            const cantidadUnidades = cantidadEl ? cantidadEl.textContent : '0';
            if (parseInt(cantidadUnidades) === 0) {
                alert("Debes seleccionar al menos una unidad.");
                return;
            }

            const total = precioDisplayEl ? parseFloat(precioDisplayEl.textContent) : NaN;
            if (isNaN(total) || total <= 0) {
                alert("El total a pagar no es válido.");
                return;
            }

            if (typeof window.abrirPayPal === 'function') window.abrirPayPal(total);
        });
    })();

document.querySelectorAll('.catalogo-card-clickable').forEach(card => {
    card.addEventListener('click', function(e) {
        if (
            e.target.closest('.futbol-dropdown-menu a') ||
            e.target.closest('.futbol-dropdown-btn')
        ) {
            return;
        }
        const link = card.getAttribute('data-link');
        if (link) {
            window.open(link, '_blank');
        }
    });
});

    actualizarPrecio();

});
</script>
<script src="scripts/scripts.js"></script>
<script defer src="https://analytics.vercel.com/script.js"></script>
</body>
</html>